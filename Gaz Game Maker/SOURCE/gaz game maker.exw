--  code generated by Win32Lib IDE v0.21.1 Build Sept-29-2006

constant TheProgramType="exw" 
 
include Win32Lib.ew
without warning
include Syntax.ew
include PicMenu.ew
include reg.ew
include LimitSize.ew
include gm_icon.E
include win32dib.ew
include richedit_icon.E

--------------------------------------------------------------------------------
--  Window Window1
constant Window1 = createEx( Window, "Gaz Game Maker", 0, Default, Default, 653, 412, 0, 0 )
constant Menu_101 = createEx( Menu, "File", Window1, 0, 0, 0, 0, 0, 0 )
constant MenuItem_102 = createEx( MenuItem, "New", Menu_101, 0, 0, 0, 0, 0, 0 )
constant MenuItem_104 = createEx( MenuItem, "Open", Menu_101, 0, 0, 0, 0, 0, 0 )
constant MenuItem_126 = createEx( MenuItem, "", Menu_101, 0, 0, 0, 0, 0, 0 )
constant MenuItem_108 = createEx( MenuItem, "Save", Menu_101, 0, 0, 0, 0, 0, 0 )
constant MenuItem_110 = createEx( MenuItem, "Save as", Menu_101, 0, 0, 0, 0, 0, 0 )
constant MenuItem_127 = createEx( MenuItem, "", Menu_101, 0, 0, 0, 0, 0, 0 )
constant MenuItem_111 = createEx( MenuItem, "Exit", Menu_101, 0, 0, 0, 0, 0, 0 )
constant Menu_131 = createEx( Menu, "Edit", Window1, 0, 0, 0, 0, 0, 0 )
constant MenuItem_add = createEx( MenuItem, "Add", Menu_131, 0, 0, 0, 0, 0, 0 )
setEnable( MenuItem_add, w32False )
constant MenuItem_information = createEx( MenuItem, "Information", Menu_131, 0, 0, 0, 0, 0, 0 )
setEnable( MenuItem_information, w32False )
constant MenuItem_delete = createEx( MenuItem, "Delete", Menu_131, 0, 0, 0, 0, 0, 0 )
setEnable( MenuItem_delete, w32False )
constant Menu_112 = createEx( Menu, "Add", Window1, 0, 0, 0, 0, 0, 0 )
constant MenuItem_113 = createEx( MenuItem, "Sprite", Menu_112, 0, 0, 0, 0, 0, 0 )
constant MenuItem_114 = createEx( MenuItem, "Sound", Menu_112, 0, 0, 0, 0, 0, 0 )
constant MenuItem_115 = createEx( MenuItem, "Object", Menu_112, 0, 0, 0, 0, 0, 0 )
constant MenuItem_116 = createEx( MenuItem, "Room", Menu_112, 0, 0, 0, 0, 0, 0 )
constant MenuItem_117 = createEx( MenuItem, "", Menu_112, 0, 0, 0, 0, 0, 0 )
constant MenuItem_128 = createEx( MenuItem, "Game Information", Menu_112, 0, 0, 0, 0, 0, 0 )
constant MenuItem_118 = createEx( MenuItem, "Game Settings", Menu_112, 0, 0, 0, 0, 0, 0 )
constant Menu_119 = createEx( Menu, "Run", Window1, 0, 0, 0, 0, 0, 0 )
constant MenuItem_120 = createEx( MenuItem, "Run Game", Menu_119, 0, 0, 0, 0, 0, 0 )
constant MenuItem_122 = createEx( MenuItem, "", Menu_119, 0, 0, 0, 0, 0, 0 )
constant MenuItem_121 = createEx( MenuItem, "Build Game", Menu_119, 0, 0, 0, 0, 0, 0 )
constant Menu_105 = createEx( Menu, "Help", Window1, 0, 0, 0, 0, 0, 0 )
constant MenuItem_106 = createEx( MenuItem, "Gaz Game Maker Help", Menu_105, 0, 0, 0, 0, 0, 0 )
constant MenuItem_130 = createEx( MenuItem, "", Menu_105, 0, 0, 0, 0, 0, 0 )
constant MenuItem_124 = createEx( MenuItem, "Programming Language Help", Menu_105, 0, 0, 0, 0, 0, 0 )
constant MenuItem_129 = createEx( MenuItem, "", Menu_105, 0, 0, 0, 0, 0, 0 )
constant MenuItem_123 = createEx( MenuItem, "Registration", Menu_105, 0, 0, 0, 0, 0, 0 )
constant MenuItem_125 = createEx( MenuItem, "", Menu_105, 0, 0, 0, 0, 0, 0 )
constant MenuItem_107 = createEx( MenuItem, "About", Menu_105, 0, 0, 0, 0, 0, 0 )
constant Popup_1 = createEx( Popup, "sprites", Window1, 0, 1, 0, 0, 0, 0 )
constant PopupItem_102 = createEx( MenuItem, "Sprite Information", Popup_1, 0, 0, 0, 0, 0, 0 )
constant PopupItem_103 = createEx( MenuItem, "Delete Sprite", Popup_1, 0, 0, 0, 0, 0, 0 )
constant Popup_2 = createEx( Popup, "add sprite", Window1, 0, 4, 0, 0, 0, 0 )
constant PopupItem_105 = createEx( MenuItem, "Add Sprite", Popup_2, 0, 0, 0, 0, 0, 0 )
constant Popup_3 = createEx( Popup, "objects", Window1, 0, 6, 0, 0, 0, 0 )
constant PopupItem_107 = createEx( MenuItem, "Object Information", Popup_3, 0, 0, 0, 0, 0, 0 )
constant PopupItem_108 = createEx( MenuItem, "Delete Object", Popup_3, 0, 0, 0, 0, 0, 0 )
constant Popup_4 = createEx( Popup, "Add Object", Window1, 0, 9, 0, 0, 0, 0 )
constant PopupItem_110 = createEx( MenuItem, "Add Object", Popup_4, 0, 0, 0, 0, 0, 0 )
constant Popup_5 = createEx( Popup, "rooms", Window1, 0, 11, 0, 0, 0, 0 )
constant PopupItem_112 = createEx( MenuItem, "Room Information", Popup_5, 0, 0, 0, 0, 0, 0 )
constant PopupItem_113 = createEx( MenuItem, "Delete Room", Popup_5, 0, 0, 0, 0, 0, 0 )
constant Popup_6 = createEx( Popup, "add room", Window1, 0, 14, 0, 0, 0, 0 )
constant PopupItem_114 = createEx( MenuItem, "Add Room", Popup_6, 0, 0, 0, 0, 0, 0 )
constant Popup_7 = createEx( Popup, "sounds", Window1, 0, 16, 0, 0, 0, 0 )
constant PopupItem_116 = createEx( MenuItem, "Sound Information", Popup_7, 0, 0, 0, 0, 0, 0 )
constant PopupItem_117 = createEx( MenuItem, "Delete Sound", Popup_7, 0, 0, 0, 0, 0, 0 )
constant Popup_8 = createEx( Popup, "add sound", Window1, 0, 19, 0, 0, 0, 0 )
constant PopupItem_119 = createEx( MenuItem, "Add Sound", Popup_8, 0, 0, 0, 0, 0, 0 )
constant Timer1 = 2000
sequence IDEFlags
IDEFlags = classDefaults( Window, { {1, {WS_SYSMENU}},{2, {0}} } )
constant CWindow1 = createEx( Window, "", Window1, 0, 36, 168, 290, w32or_all({WS_CHILD, WS_CLIPSIBLINGS, WS_THICKFRAME}), 0 )
openWindow(CWindow1, Normal)
moveZOrder( CWindow1, HWND_TOP)
constant ToolBar1 = createEx( ToolBar, "", Window1, 0, -34, 653, 34, 0, 0 )
constant PushButton198 = createEx( PictureButton, "", ToolBar1, 0, 0, 30, 30, 0, 0 )
constant PushButton200 = createEx( PictureButton, "", ToolBar1, 30, 0, 30, 30, 0, 0 )
constant PushButton201 = createEx( PictureButton, "", ToolBar1, 60, 0, 30, 30, 0, 0 )
constant PushButton203 = createEx( PictureButton, "", ToolBar1, 90, 0, 30, 30, 0, 0 )
constant PushButton5 = createEx( PictureButton, "", ToolBar1, 125, 0, 30, 30, 0, 0 )
constant PushButton189 = createEx( PictureButton, "", ToolBar1, 155, 0, 30, 30, 0, 0 )
constant PushButton106 = createEx( PictureButton, "", ToolBar1, 185, 0, 30, 30, 0, 0 )
constant PushButton153 = createEx( PictureButton, "", ToolBar1, 215, 0, 30, 30, 0, 0 )
constant PushButton549 = createEx( PictureButton, "", ToolBar1, 245, 0, 30, 30, 0, 0 )
constant PushButton215 = createEx( PictureButton, "", ToolBar1, 275, 0, 30, 30, 0, 0 )
constant PushButton209 = createEx( PictureButton, "", ToolBar1, 310, 0, 30, 30, 0, 0 )
constant PushButton240 = createEx( PictureButton, "", ToolBar1, 340, 0, 30, 30, 0, 0 )
constant PushButton233 = createEx( PictureButton, "", ToolBar1, 375, 0, 30, 30, 0, 0 )
constant TreeView1 = createEx( TreeView, "", CWindow1, 6, 0, 150, 200, w32or_all({{TVS_HASLINES,TVS_HASBUTTONS,TVS_LINESATROOT,TVS_SHOWSELALWAYS}}), 0 )
constant closefolder = addIcon( extractIcon("clsdfold.ico") )
constant openfolder  = addIcon( extractIcon("openfold.ico") )
setHint( PushButton198,"New Game")
setHint( PushButton200,"Open Game")
setHint( PushButton201,"Save Game")
setHint( PushButton203,"Save As Game")
setHint( PushButton5,"Add a Sprite")
setHint( PushButton189,"Add a Sound")
setHint( PushButton106,"Add a Object")
setHint( PushButton153,"Add a Room")
setHint( PushButton549,"Game Information")
setHint( PushButton215,"Game Settings")
setHint( PushButton209,"Run Game")
setHint( PushButton240,"Build Game")
setHint( PushButton233,"About")
---------------------------GENERATED BY IDE--------------------
procedure IDEaddXPM(integer IDEctrl, sequence IDEXPM)
--add emulated xpms to button
-- convert the xpm to a dib
atom dib
integer result
    -- transparent colors are converted to the button color
    setTransparentColor( getSysColor( COLOR_BTNFACE ) )
    -- create to dib
    dib = createDIB( xpmToEuBmp(IDEXPM) )
    result = sendMessage(IDEctrl, BM_SETIMAGE, IMAGE_BITMAP, dib)
end procedure
IDEaddXPM(PushButton198,new_xpm)
IDEaddXPM(PushButton200,open_xpm)
IDEaddXPM(PushButton201,save_xpm)
IDEaddXPM(PushButton203,save_as_xpm)
IDEaddXPM(PushButton5,sprite_xpm)
IDEaddXPM(PushButton189,sound_xpm)
IDEaddXPM(PushButton106,object_xpm)
IDEaddXPM(PushButton153,room_xpm)
IDEaddXPM(PushButton549,help2_xpm)
IDEaddXPM(PushButton215,settings_xpm)
IDEaddXPM(PushButton209,run_xpm)
IDEaddXPM(PushButton240,clock_run_xpm)
IDEaddXPM(PushButton233,help_xpm)
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window2
IDEFlags = classDefaults(Window, { {1, {WS_SYSMENU}},{2, {0}} } )
constant Window2 = createEx( Window, "Sprite Information", Window1, Default, Default, 513, 339, 0, 0 )
constant group_spr_bounding_box = createEx( Group, "Bounding Box", Window2, 180, 0, 160, 140, 0, 0 )
constant group_spr_preview = createEx( Group, "Preview", Window2, 350, 0, 150, 190, 0, 0 )
constant LText46 = createEx( LText, "Name:", Window2, 0, 10, 40, 20, 0, 0 )
constant textbox_spr_name = createEx( EditText, "", Window2, 40, 10, 130, 20, 0, 0 )
constant select_spr_automatic = createEx( Radio, "Automatic", group_spr_bounding_box, 40, 20, 80, 20, 0, 0 )
constant pb_spr_preview = createEx( Pixmap, "", group_spr_preview, 10, 20, 130, 160, 0, 0 )
constant LText47 = createEx( LText, "Width:", Window2, 0, 40, 40, 20, 0, 0 )
constant textbox_spr_width = createEx( EditText, "", Window2, 40, 40, 40, 20, w32or_all({ES_READONLY}), 0 )
constant LText48 = createEx( LText, "Height:", Window2, 90, 40, 40, 20, 0, 0 )
constant textbox_spr_height = createEx( EditText, "", Window2, 130, 40, 40, 20, w32or_all({ES_READONLY}), 0 )
constant select_spr_fullimage = createEx( Radio, "Full Image", group_spr_bounding_box, 40, 40, 80, 20, 0, 0 )
constant select_spr_manual = createEx( Radio, "Manual", group_spr_bounding_box, 40, 60, 80, 20, 0, 0 )
constant LText52 = createEx( LText, "Number of subimages:", Window2, 10, 70, 120, 20, 0, 0 )
constant textbox_spr_number_of_subimages = createEx( EditText, "", Window2, 130, 70, 40, 20, w32or_all({ES_READONLY}), 0 )
constant LText56 = createEx( LText, "Left:", group_spr_bounding_box, 0, 80, 30, 20, 0, 0 )
constant textbox_spr_left = createEx( EditText, "", group_spr_bounding_box, 30, 80, 40, 20, 0, 0 )
constant LText57 = createEx( LText, "Right:", group_spr_bounding_box, 70, 80, 40, 20, 0, 0 )
constant textbox_spr_right = createEx( EditText, "", group_spr_bounding_box, 110, 80, 40, 20, 0, 0 )
constant LText54 = createEx( LText, "Show:", Window2, 0, 100, 40, 20, 0, 0 )
constant textbox_spr_show = createEx( EditText, "", Window2, 40, 100, 40, 20, w32or_all({ES_READONLY}), 0 )
constant LText58 = createEx( LText, "Top:", group_spr_bounding_box, 0, 110, 30, 20, 0, 0 )
constant textbox_spr_top = createEx( EditText, "", group_spr_bounding_box, 30, 110, 40, 20, 0, 0 )
constant LText59 = createEx( LText, "Bottom:", group_spr_bounding_box, 70, 110, 40, 20, 0, 0 )
constant textbox_spr_bottom = createEx( EditText, "", group_spr_bounding_box, 110, 110, 40, 20, 0, 0 )
constant button_spr_back = createEx( PushButton, "back", Window2, 10, 130, 70, 20, 0, 0 )
constant button_spr_next = createEx( PushButton, "next", Window2, 100, 130, 70, 20, 0, 0 )
constant group_spr_transprant_image = createEx( Group, "Transprant image", Window2, 180, 150, 160, 70, 0, 0 )
constant PushButton8 = createEx( PushButton, "Load Image", Window2, 40, 160, 90, 20, 0, 0 )
constant select_spr_transprant = createEx( CheckBox, "Transprant", group_spr_transprant_image, 10, 20, 130, 20, 0, 0 )
constant pb_spr_transprant_color = createEx( Bitmap, "", group_spr_transprant_image, 10, 40, 20, 20, 0, 0 )
constant LText34 = createEx( LText, "Transprant Color", group_spr_transprant_image, 30, 40, 110, 20, 0, 0 )
constant PushButton440 = createEx( PushButton, "Edit sprite", Window2, 40, 200, 90, 20, 0, 0 )
constant label_spr_fname = createEx( LText, "", Window2, 350, 200, 150, 80, 0, 0 )
constant group_spr_offset = createEx( Group, "Offset", Window2, 180, 230, 160, 50, 0, 0 )
constant LText60 = createEx( LText, "X:", group_spr_offset, 10, 20, 20, 20, 0, 0 )
constant textbox_spr_x = createEx( EditText, "", group_spr_offset, 30, 20, 40, 20, 0, 0 )
constant LText61 = createEx( LText, "Y:", group_spr_offset, 80, 20, 20, 20, 0, 0 )
constant textbox_spr_y = createEx( EditText, "", group_spr_offset, 100, 20, 40, 20, 0, 0 )
constant PushButton7 = createEx( PushButton, "OK", Window2, 40, 280, 90, 20, 0, 0 )
constant button_spr_delete = createEx( PushButton, "Delete", Window2, 180, 310, 70, 20, 0, 0 )
constant button_spr_add_sub_image = createEx( PushButton, "Add Sub Image", Window2, 260, 310, 90, 20, 0, 0 )
constant button_spr_save_sub_image = createEx( PushButton, "Save Sub Image", Window2, 360, 310, 90, 20, 0, 0 )
setHint( PushButton8,"Load the sprite from a file")
setHint( PushButton440,"Edit the sprite")
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window3
constant Window3 = createEx( Window, "Object Infomation", Window1, Default, Default, 330, 308, 0, 0 )
constant LText85 = createEx( LText, "Name:", Window3, 0, 10, 40, 20, 0, 0 )
constant textbox_obj_name = createEx( EditText, "", Window3, 40, 10, 112, 20, 0, 0 )
constant LText83 = createEx( RText, "Create:", Window3, 200, 10, 50, 20, 0, 0 )
constant button_object_create = createEx( PushButton, "Code", Window3, 250, 10, 60, 20, 0, 0 )
constant LText89 = createEx( LText, "Sprite:", Window3, 0, 40, 40, 20, 0, 0 )
constant textbox_obj_sprite_name = createEx( EditText, "", Window3, 40, 40, 80, 20, w32or_all({ES_READONLY}), 0 )
constant button_obj_sprite_select = createEx( PictureButton, "", Window3, 120, 40, 24, 24, 0, 0 )
constant LText97 = createEx( RText, "Destory:", Window3, 200, 40, 50, 20, 0, 0 )
constant button_object_destroy = createEx( PushButton, "Code", Window3, 250, 40, 60, 20, 0, 0 )
constant buffer_sprite_preview = createEx( Pixmap, "", Window3, 10, 70, 32, 32, 0, 0 )
constant LText93 = createEx( RText, "Step:", Window3, 210, 70, 40, 20, 0, 0 )
constant button_object_step = createEx( PushButton, "Code", Window3, 250, 70, 60, 20, 0, 0 )
constant LText96 = createEx( RText, "Keyboard:", Window3, 190, 100, 60, 20, 0, 0 )
constant button_object_keyboard = createEx( PushButton, "Code", Window3, 250, 100, 60, 20, 0, 0 )
constant LText94 = createEx( RText, "Keyboard Up:", Window3, 170, 130, 80, 20, 0, 0 )
constant button_object_keyboard_up = createEx( PushButton, "Code", Window3, 250, 130, 60, 20, 0, 0 )
constant select_obj_visible = createEx( CheckBox, "Visible:", Window3, 0, 160, 60, 20, 0, 0 )
constant select_obj_solid = createEx( CheckBox, "Solid:", Window3, 80, 160, 50, 20, 0, 0 )
constant LText95 = createEx( RText, "Keyboard Down:", Window3, 160, 160, 90, 20, 0, 0 )
constant button_object_keyboard_down = createEx( PushButton, "Code", Window3, 250, 160, 60, 20, 0, 0 )
constant LText81 = createEx( RText, "Collision:", Window3, 200, 190, 50, 20, 0, 0 )
constant button_object_collision = createEx( PushButton, "Code", Window3, 250, 190, 60, 20, 0, 0 )
constant combox_obj_collision = createEx( DropDownList, "", Window3, 184, 220, 108, 20*6, 0, 0 )
constant PushButton91 = createEx( PushButton, "OK", Window3, 40, 240, 70, 30, 0, 0 )
constant LText92 = createEx( RText, "Drawing:", Window3, 200, 250, 50, 20, 0, 0 )
constant button_object_draw = createEx( PushButton, "Code", Window3, 250, 250, 60, 20, 0, 0 )
IDEaddXPM(button_obj_sprite_select,select_xpm)
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window4
IDEFlags = classDefaults(Window, { {1, {WS_SYSMENU}},{2, {WS_EX_DLGMODALFRAME}} } )
constant Window4 = createEx( Window, "Code Editor", Window3, Default, Default, 400, 446, {WS_THICKFRAME, WS_SYSMENU, WS_MINIMIZEBOX, WS_MAXIMIZEBOX}, {WS_EX_DLGMODALFRAME} )
constant Popup_401 = createEx( Popup, "Code editor", Window4, 0, 1, 0, 0, 0, 0 )
constant PopupItem_402 = createEx( MenuItem, "Undo", Popup_401, 0, 0, 0, 0, 0, 0 )
constant PopupItem_403 = createEx( MenuItem, "", Popup_401, 0, 0, 0, 0, 0, 0 )
constant PopupItem_404 = createEx( MenuItem, "Cut", Popup_401, 0, 0, 0, 0, 0, 0 )
constant PopupItem_405 = createEx( MenuItem, "Copy", Popup_401, 0, 0, 0, 0, 0, 0 )
constant PopupItem_406 = createEx( MenuItem, "Paste", Popup_401, 0, 0, 0, 0, 0, 0 )
constant PopupItem_407 = createEx( MenuItem, "", Popup_401, 0, 0, 0, 0, 0, 0 )
constant PopupItem_408 = createEx( MenuItem, "Select All", Popup_401, 0, 0, 0, 0, 0, 0 )
constant StatusBar452 = createEx( StatusBar, "", Window4, 0, 0, 0, 0, 0, 0 )
constant ToolBar450 = createEx( ToolBar, "", Window4, 0, -34, 400, 34, 0, 0 )
constant PushButton451 = createEx( PictureButton, "", ToolBar450, 0, 0, 30, 30, 0, 0 )
constant PushButton454 = createEx( PictureButton, "", ToolBar450, 35, 0, 30, 30, 0, 0 )
constant PushButton455 = createEx( PictureButton, "", ToolBar450, 65, 0, 30, 30, 0, 0 )
constant PushButton457 = createEx( PictureButton, "", ToolBar450, 100, 0, 30, 30, 0, 0 )
constant PushButton459 = createEx( PictureButton, "", ToolBar450, 135, 0, 30, 30, 0, 0 )
constant PushButton460 = createEx( PictureButton, "", ToolBar450, 165, 0, 30, 30, 0, 0 )
constant PushButton461 = createEx( PictureButton, "", ToolBar450, 195, 0, 30, 30, 0, 0 )
constant PushButton553 = createEx( PictureButton, "", ToolBar450, 230, 0, 30, 30, 0, 0 )
constant lable_code_editor_info = createEx( LText, "", StatusBar452, 0, 3, 150, 20, 0, 0 )
setHint( PushButton451,"Close, Save Changes")
setHint( PushButton454,"Load the script for a text file")
setHint( PushButton455,"Save the script to a text file")
setHint( PushButton457,"Undo")
setHint( PushButton459,"Cut")
setHint( PushButton460,"Copy")
setHint( PushButton461,"Paste")
setHint( PushButton553,"Show The Help File")
IDEaddXPM(PushButton451,ok_xpm)
IDEaddXPM(PushButton454,open_xpm)
IDEaddXPM(PushButton455,save_xpm)
IDEaddXPM(PushButton457,undo_xpm)
IDEaddXPM(PushButton459,cut_xpm)
IDEaddXPM(PushButton460,copy_xpm)
IDEaddXPM(PushButton461,paste_xpm)
IDEaddXPM(PushButton553,help2_xpm)
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window5
IDEFlags = classDefaults(Window, { {1, {WS_SYSMENU}},{2, {WS_EX_DLGMODALFRAME}} } )
constant Window5 = createEx( Window, "Room Information", Window1, Default, Default, 799, 604, {WS_DLGFRAME, WS_SYSMENU}, {WS_EX_DLGMODALFRAME} )
IDEFlags = classDefaults( Window, { {1, {WS_SYSMENU}},{2, {0}} } )
constant CWindow2 = createEx( Window, "", Window5, 150, 40, 620, 510, {WS_CHILD, WS_CLIPSIBLINGS, WS_DLGFRAME}, 0 )
openWindow(CWindow2, Normal)
moveZOrder( CWindow2, HWND_TOP)
constant ToolBar118 = createEx( ToolBar, "", Window5, 0, -34, 799, 34, 0, 0 )
constant PushButton556 = createEx( PictureButton, "", ToolBar118, 0, 0, 30, 30, 0, 0 )
constant PushButton521 = createEx( PictureButton, "", ToolBar118, 35, 0, 30, 30, 0, 0 )
constant PushButton523 = createEx( PictureButton, "", ToolBar118, 70, 0, 30, 30, 0, 0 )
constant PushButton524 = createEx( PictureButton, "", ToolBar118, 100, 0, 30, 30, 0, 0 )
constant PushButton525 = createEx( PictureButton, "", ToolBar118, 130, 0, 30, 30, 0, 0 )
constant PushButton526 = createEx( PictureButton, "", ToolBar118, 160, 0, 30, 30, 0, 0 )
constant button_room_grid = createEx( TogglePicture, "", ToolBar118, 195, 0, 30, 30, 0, 0 )
constant LText530 = createEx( LText, "Snapx", ToolBar118, 235, 0, 40, 30, 0, 0 )
constant textbox_room_snapx = createEx( EditText, "", ToolBar118, 275, 0, 30, 30, w32or_all({#2000}), 0 )
constant LText532 = createEx( LText, "Snapy", ToolBar118, 305, 0, 40, 30, 0, 0 )
constant textbox_room_snapy = createEx( EditText, "", ToolBar118, 345, 0, 30, 30, w32or_all({#2000}), 0 )
constant LText125 = createEx( LText, "Name:", Window5, 0, 6, 40, 20, 0, 0 )
constant textbox_room_name = createEx( EditText, "", Window5, 50, 6, 100, 20, 0, 0 )
constant bar_room_height = createEx( VScroll, "VScroll122", Window5, 770, 6, 20, 500, 0, 0 )
constant room_buffer = createEx( Pixmap, "buffer", CWindow2, 110, 20, 390, 450, 0, 0 )
constant LText126 = createEx( LText, "Room Caption:", Window5, 0, 36, 80, 20, 0, 0 )
constant textbox_room_caption = createEx( EditText, "", Window5, 10, 56, 140, 20, 0, 0 )
constant LText123 = createEx( LText, "Room Width:", Window5, 10, 86, 70, 20, 0, 0 )
constant textbox_room_width = createEx( EditText, "", Window5, 90, 86, 60, 20, w32or_all({#2000}), 0 )
constant LText124 = createEx( LText, "Room Heiight:", Window5, 10, 116, 80, 20, 0, 0 )
constant textbox_room_height = createEx( EditText, "", Window5, 90, 116, 60, 20, w32or_all({#2000}), 0 )
constant LText140 = createEx( LText, "Room Speed:", Window5, 10, 146, 80, 20, 0, 0 )
constant textbox_room_speed = createEx( EditText, "", Window5, 90, 146, 60, 20, w32or_all({#2000}), 0 )
constant group_room_background = createEx( Group, "Backgound", Window5, 10, 176, 140, 130, 0, 0 )
constant select_room_background_color = createEx( Radio, "Color:", group_room_background, 10, 20, 50, 20, 0, 0 )
constant bitmap_room_background_color = createEx( Bitmap, "Color", group_room_background, 70, 20, 60, 20, 0, 0 )
constant select_room_background_image = createEx( Radio, "Image:", group_room_background, 10, 40, 50, 20, 0, 0 )
constant bitmap_room_background_image = createEx( Bitmap, "image", group_room_background, 70, 50, 60, 20, 0, 0 )
constant group_room_background_style = createEx( Group, "", group_room_background, 10, 70, 70, 50, 0, 0 )
constant select_room_background_style_normal = createEx( Radio, "Normal", group_room_background_style, 10, 10, 60, 20, 0, 0 )
constant select_room_background_style_tile = createEx( Radio, "Tile", group_room_background_style, 10, 30, 40, 20, 0, 0 )
constant select_room_view_enable = createEx( CheckBox, "View Enable:", Window5, 10, 306, 90, 20, 0, 0 )
constant group_room_view = createEx( Group, "View", Window5, 10, 326, 140, 80, 0, 0 )
constant LText136 = createEx( LText, "View Width:", group_room_view, 0, 20, 70, 20, 0, 0 )
constant textbox_room_view_width = createEx( EditText, "", group_room_view, 70, 20, 50, 20, w32or_all({#2000}), 0 )
constant LText137 = createEx( LText, "View Height:", group_room_view, 0, 50, 70, 20, 0, 0 )
constant textbox_room_view_height = createEx( EditText, "", group_room_view, 70, 50, 50, 20, w32or_all({#2000}), 0 )
constant textbox_room_object_name = createEx( EditText, "", Window5, 10, 406, 110, 20, w32or_all({ES_READONLY}), 0 )
constant button_room_object_select = createEx( PictureButton, "", Window5, 120, 406, 24, 24, 0, 0 )
constant buffer_object_preview = createEx( Pixmap, "", Window5, 10, 426, 32, 32, 0, 0 )
constant PushButton158 = createEx( PushButton, "OK", Window5, 30, 476, 90, 30, 0, 0 )
constant bar_room_width = createEx( HScroll, "HScroll121", Window5, 0, 516, 770, 20, 0, 0 )
setHint( PushButton556,"Close, Save Changes")
setHint( PushButton521,"Clear the room")
setHint( PushButton523,"Move all instance to the left")
setHint( PushButton524,"Move all instance to the right")
setHint( PushButton525,"Move all instance up")
setHint( PushButton526,"Move all instance down")
setHint( button_room_grid,"Toggle whether or not to show the grid lines")
IDEaddXPM(PushButton556,ok_xpm)
IDEaddXPM(PushButton521,new_xpm)
IDEaddXPM(PushButton523,moveleft_xpm)
IDEaddXPM(PushButton524,moveright_xpm)
IDEaddXPM(PushButton525,move_up_xpm)
IDEaddXPM(PushButton526,move_down_xpm)
IDEaddXPM(button_room_grid,grid_xpm)
IDEaddXPM(button_room_object_select,select_xpm)
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window6
constant Window6 = createEx( Window, "Sound Information", Window1, Default, Default, 196, 300, 0, 0 )
constant LText181 = createEx( LText, "Name:", Window6, 10, 10, 40, 20, 0, 0 )
constant textbox_snd_name = createEx( EditText, "", Window6, 50, 10, 120, 20, 0, 0 )
constant PushButton184 = createEx( PushButton, "Load Sound", Window6, 50, 40, 90, 20, 0, 0 )
constant button_snd_save = createEx( PushButton, "Save Sound", Window6, 50, 70, 90, 20, 0, 0 )
constant group_snd_sound = createEx( Group, "Sound", Window6, 10, 90, 170, 130, 0, 0 )
constant lable_snd_filename = createEx( LText, "", group_snd_sound, 10, 20, 150, 60, 0, 0 )
constant PushButton185 = createEx( PushButton, "Play", group_snd_sound, 10, 90, 70, 30, 0, 0 )
constant PushButton187 = createEx( PushButton, "Stop", group_snd_sound, 90, 90, 70, 30, 0, 0 )
constant PushButton183 = createEx( PushButton, "OK", Window6, 50, 230, 90, 30, 0, 0 )
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window7
constant Window7 = createEx( Window, "Game Settings", Window1, Default, Default, 285, 257, 0, 0 )
constant TabControl540 = createEx( TabControl, "TabControl540", Window7, 10, 10, 260, 180, 0, 0 )
constant TabItem541 = createEx( TabItem, "Graphics", TabControl540, 0, 0, 0, 0, 0, 0 )
constant TabItem542 = createEx( TabItem, "Keys", TabControl540, 0, 0, 0, 0, 0, 0 )
constant select_settings_debug_collision = createEx( CheckBox, "Debug Collision", TabItem541, 10, 30, 100, 20, 0, 0 )
setCheck( select_settings_debug_collision, w32True )
constant select_settings_escape_key = createEx( CheckBox, "Esc Key ends the game", TabItem542, 10, 30, 140, 20, 0, 0 )
setCheck( select_settings_escape_key, w32True )
constant select_settings_draw_score = createEx( CheckBox, "Draw Score", TabItem541, 120, 30, 90, 20, 0, 0 )
setCheck( select_settings_draw_score, w32True )
constant select_settings_debug_caption = createEx( CheckBox, "Debug Caption", TabItem541, 10, 50, 100, 20, 0, 0 )
constant select_settings_game_help = createEx( CheckBox, "F1 Key Show Game Information", TabItem542, 10, 50, 190, 20, 0, 0 )
constant select_settings_draw_lives = createEx( CheckBox, "Draw Lives", TabItem541, 120, 50, 90, 20, 0, 0 )
setCheck( select_settings_draw_lives, w32True )
constant select_settings_show_cursor = createEx( CheckBox, "Show Cursor", TabItem541, 10, 70, 90, 20, 0, 0 )
constant select_settings_debug_window = createEx( CheckBox, "F2 Key Show Debug Window", TabItem542, 10, 70, 170, 20, 0, 0 )
constant select_settings_draw_health = createEx( CheckBox, "Draw Health", TabItem541, 120, 70, 90, 20, 0, 0 )
setCheck( select_settings_draw_health, w32True )
constant select_settings_caption_fullscreen = createEx( CheckBox, "Show caption in full screen", TabItem541, 10, 90, 150, 20, 0, 0 )
setCheck( select_settings_caption_fullscreen, w32True )
constant select_settings_save_screen = createEx( CheckBox, "F3 Key Screen Shoot", TabItem542, 10, 90, 150, 20, 0, 0 )
constant select_settings_start_fullscreen = createEx( CheckBox, "Start in fullscreen", TabItem541, 10, 110, 150, 20, 0, 0 )
constant select_settings_swith_screen = createEx( CheckBox, "F4 Key Swith Screen", TabItem542, 10, 110, 150, 20, 0, 0 )
constant select_settings_can_pause = createEx( CheckBox, "F5 Key Can Pause The Game", TabItem542, 10, 130, 170, 20, 0, 0 )
setCheck( select_settings_can_pause, w32True )
constant PushButton216 = createEx( PushButton, "OK", Window7, 90, 200, 90, 20, 0, 0 )
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window8
IDEFlags = classDefaults(Window, { {1, {WS_SYSMENU}},{2, {0}} } )
constant Window8 = createEx( Window, "About", Window1, Default, Default, 376, 304, {WS_POPUP, WS_DLGFRAME}, 0 )
setWindowBackColor( Window8,14544117 )
constant LText539 = createEx( LText, "", Window8, 70, 0, 290, 20, 0, 0 )
constant Icon228 = createEx( Icon, "About", Window8, 30, 20, 30, 30, 0, 0 )
setIcon( Icon228,"gm.ico")
constant LText230 = createEx( LText, "Gaz Game Maker Version 0.2.4 Date:8/2/07", Window8, 70, 30, 240, 20, 0, 0 )
constant LText231 = createEx( LText, "Writen In Euphoria By Gareth Mc diad", Window8, 90, 50, 200, 20, 0, 0 )
constant LText232 = createEx( LText, "Copyrights 2007 Gareth Mc Daid", Window8, 100, 70, 170, 20, 0, 0 )
constant LText310 = createEx( LText, "Web-Site  bioware.freewebsitehosting.com", Window8, 80, 90, 210, 20, 0, 0 )
setTextColor( LText310,16711680)
repaintFG( LText310 )
constant LText311 = createEx( LText, "E-mail gareth_mcdaid@yahoo.co.uk", Window8, 90, 110, 180, 20, 0, 0 )
constant LText292 = createEx( LText, "Thanks to:", Window8, 70, 130, 70, 20, 0, 0 )
constant LText293 = createEx( LText, "Robert Craig, for Euphoria.", Window8, 90, 150, 150, 20, 0, 0 )
constant LText294 = createEx( LText, "David Cuny and Derek Parnell, for Win32Lib.", Window8, 90, 170, 240, 20, 0, 0 )
constant LText295 = createEx( LText, "Judith Evans, for Enhanced IDE.", Window8, 90, 190, 170, 20, 0, 0 )
constant LText296 = createEx( LText, "???, for xControl.", Window8, 90, 210, 100, 20, 0, 0 )
constant LText297 = createEx( LText, "Tommy Carlier, for Win32Dib.", Window8, 90, 230, 180, 20, 0, 0 )
constant LText298 = createEx( LText, "Davi Tassinari de Figueiredo, for Registry Wrappers.", Window8, 90, 250, 260, 20, 0, 0 )
constant PushButton299 = createEx( PushButton, "Close", Window8, 130, 270, 90, 20, 0, 0 )
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window9
IDEFlags = classDefaults(Window, { {1, {WS_SYSMENU}},{2, {0}} } )
constant Window9 = createEx( Window, "", Window1, Default, Default, 355, 64, {WS_POPUP, WS_DLGFRAME}, 0 )
constant lable_text = createEx( LText, "", Window9, 10, 0, 150, 20, 0, 0 )
setScrollRange( lable_text, 0, 100)
constant pb_bar = createEx( ProgressBar, "", Window9, 10, 20, 330, 30, w32or_all({PBS_SMOOTH}), 0 )
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window10
constant Window10 = createEx( Window, "Registration", Window1, Default, Default, 223, 168, 0, 0 )
constant Timer2 = 2001
constant LText271 = createEx( LText, "Enter Registration Information ", Window10, 30, 10, 150, 20, 0, 0 )
constant LText269 = createEx( LText, "Name", Window10, 10, 40, 50, 20, 0, 0 )
constant register_name = createEx( EditText, "", Window10, 60, 40, 130, 20, 0, 0 )
constant LText270 = createEx( LText, "Key", Window10, 10, 70, 50, 20, 0, 0 )
constant register_key = createEx( EditText, "", Window10, 60, 70, 130, 20, 0, 0 )
constant PushButton272 = createEx( PushButton, "Ok", Window10, 10, 100, 90, 30, 0, 0 )
constant PushButton273 = createEx( PushButton, "Cancel", Window10, 110, 100, 90, 30, 0, 0 )
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window11
IDEFlags = classDefaults(Window, { {1, {WS_SYSMENU}},{2, {WS_EX_DLGMODALFRAME}} } )
constant Window11 = createEx( Window, "Sprite Editor", Window1, Default, Default, 609, 457, {WS_THICKFRAME, WS_SYSMENU, WS_MINIMIZEBOX, WS_MAXIMIZEBOX}, {WS_EX_DLGMODALFRAME} )
constant Menu_1101 = createEx( Menu, "File", Window11, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1102 = createEx( MenuItem, "New", Menu_1101, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1103 = createEx( MenuItem, "Create From File", Menu_1101, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1107 = createEx( MenuItem, "Add From File", Menu_1101, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1108 = createEx( MenuItem, "", Menu_1101, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1109 = createEx( MenuItem, "Save As Strip", Menu_1101, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1110 = createEx( MenuItem, "", Menu_1101, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1111 = createEx( MenuItem, "Create From Strip", Menu_1101, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1112 = createEx( MenuItem, "Add From Strip", Menu_1101, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1114 = createEx( MenuItem, "", Menu_1101, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1113 = createEx( MenuItem, "Close Save Changes", Menu_1101, 0, 0, 0, 0, 0, 0 )
constant Menu_1104 = createEx( Menu, "Transfrom", Window11, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1105 = createEx( MenuItem, "Flip H", Menu_1104, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1106 = createEx( MenuItem, "Flip V", Menu_1104, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1115 = createEx( MenuItem, "rotate 90", Menu_1104, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1116 = createEx( MenuItem, "rotate counter 90", Menu_1104, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1117 = createEx( MenuItem, "rotate 180", Menu_1104, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1128 = createEx( MenuItem, "rotate", Menu_1104, 0, 0, 0, 0, 0, 0 )
constant Menu_1118 = createEx( Menu, "Images", Window11, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1119 = createEx( MenuItem, "Color", Menu_1118, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1120 = createEx( MenuItem, "Blur", Menu_1118, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1121 = createEx( MenuItem, "Invert Colors", Menu_1118, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1122 = createEx( MenuItem, "sharpen", Menu_1118, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1123 = createEx( MenuItem, "Make gray", Menu_1118, 0, 0, 0, 0, 0, 0 )
constant Menu_1125 = createEx( Menu, "Aimations", Window11, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1126 = createEx( MenuItem, "set length", Menu_1125, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1127 = createEx( MenuItem, "Rotate", Menu_1125, 0, 0, 0, 0, 0, 0 )
constant Timer6 = 2002
IDEFlags = classDefaults( Window, { {1, {WS_SYSMENU}},{2, {0}} } )
constant CWindow3 = createEx( Window, "", Window11, 140, 40, 430, 350, w32or_all({WS_CHILD, WS_CLIPSIBLINGS, WS_DLGFRAME}), 0 )
openWindow(CWindow3, Normal)
moveZOrder( CWindow3, HWND_TOP)
IDEFlags = classDefaults( Window, { {1, {WS_SYSMENU}},{2, {0}} } )
constant CWindow4 = createEx( Window, "", Window11, 0, 70, 140, 320, w32or_all({WS_CHILD, WS_CLIPSIBLINGS, WS_DLGFRAME}), 0 )
openWindow(CWindow4, Normal)
moveZOrder( CWindow4, HWND_TOP)
constant ToolBar317 = createEx( ToolBar, "", Window11, 0, -34, 609, 34, 0, 0 )
constant PushButton563 = createEx( PictureButton, "", ToolBar317, 0, 0, 30, 30, 0, 0 )
constant PushButton417 = createEx( PictureButton, "", ToolBar317, 40, 0, 30, 30, 0, 0 )
constant PushButton418 = createEx( PictureButton, "", ToolBar317, 70, 0, 30, 30, 0, 0 )
constant PushButton420 = createEx( PictureButton, "", ToolBar317, 110, 0, 30, 30, 0, 0 )
constant PushButton422 = createEx( PictureButton, "", ToolBar317, 150, 0, 30, 30, 0, 0 )
constant PushButton423 = createEx( PictureButton, "", ToolBar317, 180, 0, 30, 30, 0, 0 )
constant PushButton425 = createEx( PictureButton, "", ToolBar317, 220, 0, 30, 30, 0, 0 )
constant bar_height = createEx( VScroll, "", Window11, 580, 6, 20, 340, 0, 0 )
constant checkbox_sprite_editor_preview = createEx( CheckBox, "Show Preview:", Window11, 10, 10, 120, 20, 0, 0 )
constant buffer_sprite_editor = createEx( Pixmap, "", CWindow3, 26, 16, 360, 220, 0, 0 )
constant buffer_sprite_editor_preview = createEx( Pixmap, "", CWindow4, 6, 6, 120, 200, {WS_THICKFRAME, WS_SYSMENU, WS_MINIMIZEBOX, WS_MAXIMIZEBOX}, 0 )
constant lable_sprite_editor_speed = createEx( RText, "Speed", CWindow4, 6, 216, 50, 20, 0, 0 )
constant textbox_sprite_editor_speed = createEx( EditText, "", CWindow4, 56, 216, 50, 20, w32or_all({#2000}), 0 )
constant button_sprite_editor_background = createEx( PushButton, "Backgound Color", CWindow4, 16, 246, 90, 30, 0, 0 )
setHint( PushButton563,"Close, Save Changes")
setHint( PushButton417,"Move the image to the left")
setHint( PushButton418,"Move the image to the right")
setHint( PushButton420,"Delete the image")
setHint( PushButton422,"Undo the last action")
setHint( PushButton423,"Redo the last action")
setHint( PushButton425,"Edit the image")
IDEaddXPM(PushButton563,ok_xpm)
IDEaddXPM(PushButton417,moveleft_xpm)
IDEaddXPM(PushButton418,moveright_xpm)
IDEaddXPM(PushButton420,trash_xpm)
IDEaddXPM(PushButton422,undo_xpm)
IDEaddXPM(PushButton423,redo_xpm)
IDEaddXPM(PushButton425,pen_mode_xpm)
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window12
constant Window12 = createEx( Window, "Image Editor", Window1, Default, Default, 570, 600, 0, 0 )
constant Menu_1201 = createEx( Menu, "File", Window12, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1202 = createEx( MenuItem, "Save as", Menu_1201, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1203 = createEx( MenuItem, "", Menu_1201, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1207 = createEx( MenuItem, "Close save changes", Menu_1201, 0, 0, 0, 0, 0, 0 )
constant Menu_1204 = createEx( Menu, "Edit", Window12, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1205 = createEx( MenuItem, "Move left", Menu_1204, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1206 = createEx( MenuItem, "Move right", Menu_1204, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1208 = createEx( MenuItem, "Move up", Menu_1204, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1209 = createEx( MenuItem, "Move down", Menu_1204, 0, 0, 0, 0, 0, 0 )
constant Menu_1210 = createEx( Menu, "Transfrom", Window12, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1211 = createEx( MenuItem, "Flip H", Menu_1210, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1212 = createEx( MenuItem, "Flip V", Menu_1210, 0, 0, 0, 0, 0, 0 )
constant Menu_1213 = createEx( Menu, "Image", Window12, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1214 = createEx( MenuItem, "Clear", Menu_1213, 0, 0, 0, 0, 0, 0 )
constant CWindow5 = createEx( Window, "CWindow341", Window12, 100, 40, 430, 450, w32or_all({WS_CHILD}), 0 )
openWindow(CWindow5, Normal)
setWindowBackColor( CWindow5,8421504 )
constant StatusBar443 = createEx( StatusBar, "", Window12, 0, 0, 0, 0, 0, 0 )
constant ToolBar340 = createEx( ToolBar, "", Window12, 0, -34, 570, 34, 0, 0 )
constant PushButton434 = createEx( PictureButton, "", ToolBar340, 0, 0, 30, 30, 0, 0 )
constant PushButton436 = createEx( PictureButton, "", ToolBar340, 40, 0, 30, 30, 0, 0 )
constant PushButton437 = createEx( PictureButton, "", ToolBar340, 70, 0, 30, 30, 0, 0 )
constant PushButton438 = createEx( PictureButton, "", ToolBar340, 100, 0, 30, 30, 0, 0 )
constant PushButton439 = createEx( PictureButton, "", ToolBar340, 130, 0, 30, 30, 0, 0 )
constant LText345 = createEx( LText, "Left", Window12, 10, 6, 30, 20, 0, 0 )
constant LText346 = createEx( LText, "Right", Window12, 50, 6, 40, 20, 0, 0 )
constant bar_height_image = createEx( VScroll, "VScroll344", Window12, 540, 6, 20, 450, 0, 0 )
constant bitmap_color1 = createEx( Bitmap, "", Window12, 10, 36, 30, 30, 0, 0 )
constant bitmap_color2 = createEx( Bitmap, "", Window12, 50, 36, 30, 30, 0, 0 )
constant Buffer_image_editor = createEx( Pixmap, "", CWindow5, 6, 10, 310, 210, 0, 0 )
constant PushButton349 = createEx( PictureButton, "", Window12, 10, 76, 30, 30, 0, 0 )
constant PushButton352 = createEx( PictureButton, "", Window12, 50, 76, 30, 30, 0, 0 )
constant button_pen_mode = createEx( TogglePicture, "", Window12, 10, 106, 30, 30, 0, 0 )
constant button_fill_mode = createEx( TogglePicture, "", Window12, 50, 106, 30, 30, 0, 0 )
constant button_pick_mode = createEx( TogglePicture, "", Window12, 10, 136, 30, 30, 0, 0 )
constant button_spray_mode = createEx( TogglePicture, "", Window12, 50, 136, 30, 30, 0, 0 )
constant bar_width_image = createEx( HScroll, "HScroll343", Window12, 90, 466, 450, 20, 0, 0 )
constant lable_mouse_pos = createEx( LText, "0,0", StatusBar443, 0, 3, 110, 15, 0, 0 )
setHint( PushButton434,"Close, Save Changes")
setHint( PushButton436,"Move all pixels to the left")
setHint( PushButton437,"Move all pixels to the right")
setHint( PushButton438,"Move all pixels up")
setHint( PushButton439,"Move all pixels down")
setHint( bitmap_color1,"Current left mouse color,  Click to change it")
setHint( bitmap_color2,"Current right mouse color,  Click to change it")
setHint( PushButton349,"Zoom in")
setHint( PushButton352,"Zoom out")
setHint( button_pen_mode,"Draw on the image")
setHint( button_fill_mode,"Fill an area")
setHint( button_pick_mode,"Pick a color from the image")
setHint( button_spray_mode,"Spray paint on the image")
IDEaddXPM(PushButton434,ok_xpm)
IDEaddXPM(PushButton436,moveleft_xpm)
IDEaddXPM(PushButton437,moveright_xpm)
IDEaddXPM(PushButton438,move_up_xpm)
IDEaddXPM(PushButton439,move_down_xpm)
IDEaddXPM(PushButton349,zoom_in_xpm)
IDEaddXPM(PushButton352,zoom_out_xpm)
IDEaddXPM(button_pen_mode,pen_mode_xpm)
IDEaddXPM(button_fill_mode,fill_mode_xpm)
IDEaddXPM(button_pick_mode,pick_color_xpm)
IDEaddXPM(button_spray_mode,spray_mode_xpm)
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window13
constant Window13 = createEx( Window, "Create a new sprite", Window1, Default, Default, 199, 146, 0, 0 )
constant LText361 = createEx( RText, "Width:", Window13, 40, 20, 60, 20, 0, 0 )
constant textbox_width = createEx( EditText, "", Window13, 100, 20, 50, 20, w32or_all({#2000}), 0 )
constant LText362 = createEx( RText, "Height:", Window13, 40, 50, 60, 20, 0, 0 )
constant textbox_height = createEx( EditText, "", Window13, 100, 50, 50, 20, w32or_all({#2000}), 0 )
constant PushButton365 = createEx( PushButton, "OK", Window13, 10, 80, 70, 30, 0, 0 )
constant PushButton366 = createEx( PushButton, "Cancel", Window13, 110, 80, 70, 30, 0, 0 )
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window14
constant Window14 = createEx( Window, "Set Length", Window1, Default, Default, 184, 126, 0, 0 )
constant LText367 = createEx( LText, "Number of frames:", Window14, 10, 20, 90, 20, 0, 0 )
constant textbox_info = createEx( EditText, "", Window14, 110, 20, 60, 20, w32or_all({#2000}), 0 )
constant PushButton369 = createEx( PushButton, "OK", Window14, 10, 60, 70, 30, 0, 0 )
constant PushButton370 = createEx( PushButton, "Cancel", Window14, 100, 60, 70, 30, 0, 0 )
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window15
constant Window15 = createEx( Window, "Insert Image", Window1, Default, Default, 179, 161, 0, 0 )
constant LText371 = createEx( LText, "The image size is not equal to the current image what do you want me to do?", Window15, 0, 0, 170, 40, 0, 0 )
constant PushButton372 = createEx( PushButton, "Place at left top", Window15, 40, 50, 90, 30, 0, 0 )
constant PushButton373 = createEx( PushButton, "Don't insert", Window15, 40, 90, 90, 30, 0, 0 )
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window16
constant Window16 = createEx( Window, "Add from strip", Window1, Default, Default, 484, 409, 0, 0 )
constant Buffer_strip = createEx( Pixmap, "", Window16, 170, 0, 300, 350, 0, 0 )
constant LText378 = createEx( RText, "Number of images:", Window16, 10, 10, 90, 20, 0, 0 )
constant textbox_image_number = createEx( EditText, "", Window16, 100, 10, 50, 20, 0, 0 )
constant LText379 = createEx( RText, "Images per row:", Window16, 10, 40, 90, 20, 0, 0 )
constant textbox_images_per_row = createEx( EditText, "", Window16, 100, 40, 50, 20, 0, 0 )
constant LText380 = createEx( RText, "Image width:", Window16, 10, 70, 90, 20, 0, 0 )
constant textbox_image_width = createEx( EditText, "", Window16, 100, 70, 50, 20, 0, 0 )
constant LText381 = createEx( RText, "Image height:", Window16, 10, 100, 90, 20, 0, 0 )
constant textbox_image_height = createEx( EditText, "", Window16, 100, 100, 50, 20, 0, 0 )
constant PushButton376 = createEx( PushButton, "OK", Window16, 10, 340, 70, 30, 0, 0 )
constant PushButton377 = createEx( PushButton, "Cancel", Window16, 90, 340, 70, 30, 0, 0 )
constant HScroll375 = createEx( HScroll, "HScroll375", Window16, 170, 350, 300, 20, 0, 0 )
setVisible( HScroll375, w32False )
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window17
constant Window17 = createEx( Window, "Rotate Images", Window1, Default, Default, 188, 134, 0, 0 )
constant LText386 = createEx( RText, "Angle:", Window17, 30, 20, 60, 20, 0, 0 )
constant textbox_rotate = createEx( EditText, "", Window17, 90, 20, 50, 20, 0, 0 )
constant PushButton388 = createEx( PushButton, "OK", Window17, 20, 60, 70, 30, 0, 0 )
constant PushButton389 = createEx( PushButton, "Cancel", Window17, 100, 60, 70, 30, 0, 0 )
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window18
constant Window18 = createEx( Window, "Ainimation rotate", Window1, Default, Default, 193, 155, 0, 0 )
constant LText390 = createEx( RText, "Number of frames", Window18, 10, 10, 100, 20, 0, 0 )
constant textbox_ainimation_number = createEx( EditText, "", Window18, 110, 10, 50, 20, w32or_all({#2000}), 0 )
constant LText391 = createEx( RText, "Angel 0-360", Window18, 40, 40, 70, 20, 0, 0 )
constant textbox_ainimation_angle = createEx( EditText, "", Window18, 110, 40, 50, 20, w32or_all({#2000}), 0 )
constant PushButton394 = createEx( PushButton, "OK", Window18, 20, 80, 70, 30, 0, 0 )
constant PushButton395 = createEx( PushButton, "Cancel", Window18, 100, 80, 70, 30, 0, 0 )
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window19
IDEFlags = classDefaults(Window, { {1, {WS_SYSMENU}},{2, {WS_EX_DLGMODALFRAME}} } )
constant Window19 = createEx( Window, "Game Information", Window1, Default, Default, 490, 329, {WS_THICKFRAME, WS_SYSMENU, WS_MINIMIZEBOX, WS_MAXIMIZEBOX}, {WS_EX_DLGMODALFRAME} )
constant Menu_1901 = createEx( Menu, "File", Window19, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1905 = createEx( MenuItem, "Load File", Menu_1901, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1906 = createEx( MenuItem, "Save File", Menu_1901, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1912 = createEx( MenuItem, "", Menu_1901, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1913 = createEx( MenuItem, "Close Save Changes", Menu_1901, 0, 0, 0, 0, 0, 0 )
constant Menu_1902 = createEx( Menu, "Edit", Window19, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1903 = createEx( MenuItem, "Undo", Menu_1902, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1904 = createEx( MenuItem, "", Menu_1902, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1907 = createEx( MenuItem, "Cut", Menu_1902, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1908 = createEx( MenuItem, "Copy", Menu_1902, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1909 = createEx( MenuItem, "Paste", Menu_1902, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1910 = createEx( MenuItem, "", Menu_1902, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1911 = createEx( MenuItem, "Select All", Menu_1902, 0, 0, 0, 0, 0, 0 )
constant Menu_1914 = createEx( Menu, "Format", Window19, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1915 = createEx( MenuItem, "Bold", Menu_1914, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1916 = createEx( MenuItem, "Italic", Menu_1914, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1917 = createEx( MenuItem, "Underline", Menu_1914, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1918 = createEx( MenuItem, "", Menu_1914, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1919 = createEx( MenuItem, "Text Color", Menu_1914, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1920 = createEx( MenuItem, "Background Color", Menu_1914, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1921 = createEx( MenuItem, "", Menu_1914, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1922 = createEx( MenuItem, "Align Left", Menu_1914, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1923 = createEx( MenuItem, "Align Center", Menu_1914, 0, 0, 0, 0, 0, 0 )
constant MenuItem_1924 = createEx( MenuItem, "Align Right", Menu_1914, 0, 0, 0, 0, 0, 0 )
constant Popup_1901 = createEx( Popup, "Popup 1901", Window19, 0, 1, 0, 0, 0, 0 )
constant PopupItem_1902 = createEx( MenuItem, "Undo", Popup_1901, 0, 0, 0, 0, 0, 0 )
constant PopupItem_1903 = createEx( MenuItem, "", Popup_1901, 0, 0, 0, 0, 0, 0 )
constant PopupItem_1904 = createEx( MenuItem, "Cut", Popup_1901, 0, 0, 0, 0, 0, 0 )
constant PopupItem_1905 = createEx( MenuItem, "Copy", Popup_1901, 0, 0, 0, 0, 0, 0 )
constant PopupItem_1906 = createEx( MenuItem, "Paste", Popup_1901, 0, 0, 0, 0, 0, 0 )
constant PopupItem_1907 = createEx( MenuItem, "", Popup_1901, 0, 0, 0, 0, 0, 0 )
constant PopupItem_1908 = createEx( MenuItem, "Select All", Popup_1901, 0, 0, 0, 0, 0, 0 )
constant ToolBar463 = createEx( ToolBar, "", Window19, 0, -34, 490, 34, 0, 0 )
constant PushButton464 = createEx( PictureButton, "", ToolBar463, 0, 0, 30, 30, 0, 0 )
constant PushButton468 = createEx( PictureButton, "", ToolBar463, 35, 0, 30, 30, 0, 0 )
constant PushButton469 = createEx( PictureButton, "", ToolBar463, 65, 0, 30, 30, 0, 0 )
constant PushButton471 = createEx( PictureButton, "", ToolBar463, 95, 0, 30, 30, 0, 0 )
constant EditText69 = createEx( EditText, "8", ToolBar463, 130, 0, 50, 30, w32or_all({ES_READONLY}), 0 )
constant UpDown473 = createEx( UpDown, "UpDown473", ToolBar463, 180, 0, 0, 0, w32or_all({UDS_ALIGNRIGHT,UDS_SETBUDDYINT,UDS_ARROWKEYS}), 0 )
setScrollRange( UpDown473, 8, 80)
constant PushButton71 = createEx( TogglePicture, "", ToolBar463, 190, 0, 30, 30, 0, 0 )
constant PushButton72 = createEx( TogglePicture, "", ToolBar463, 220, 0, 30, 30, 0, 0 )
constant PushButton73 = createEx( TogglePicture, "", ToolBar463, 250, 0, 30, 30, 0, 0 )
constant PushButton77 = createEx( TogglePicture, "", ToolBar463, 285, 0, 30, 30, 0, 0 )
constant PushButton78 = createEx( TogglePicture, "", ToolBar463, 315, 0, 30, 30, 0, 0 )
constant PushButton79 = createEx( TogglePicture, "", ToolBar463, 345, 0, 30, 30, 0, 0 )
constant PushButton485 = createEx( PictureButton, "", ToolBar463, 380, 0, 30, 30, 0, 0 )
constant PushButton486 = createEx( PictureButton, "", ToolBar463, 410, 0, 30, 30, 0, 0 )
constant richedit_help = createEx( RichEdit, "", Window19, 10, 6, 460, 220, 0, 0 )
integer IDEok
IDEok=sendMessage( richedit_help,1091,0,16777215 )
setHint( Window19,"Align Left")
setHint( PushButton464,"Close, Save Changes")
setHint( PushButton468,"Cut")
setHint( PushButton469,"Copy")
setHint( PushButton471,"Paste")
setHint( PushButton71,"Bold")
setHint( PushButton72,"Italic")
setHint( PushButton73,"Underline")
setHint( PushButton77,"Align Left")
setHint( PushButton78,"Center")
setHint( PushButton79,"Align Right")
setHint( PushButton485,"Text Color")
setHint( PushButton486,"Background Color")
IDEaddXPM(PushButton464,ok_xpm)
IDEaddXPM(PushButton468,cut2_xpm)
IDEaddXPM(PushButton469,copy2_xpm)
IDEaddXPM(PushButton471,paste2_xpm)
IDEaddXPM(PushButton71,bold_xpm)
IDEaddXPM(PushButton72,underline_xpm)
IDEaddXPM(PushButton73,itac_xpm)
IDEaddXPM(PushButton77,a_left_xpm)
IDEaddXPM(PushButton78,a_center_xpm)
IDEaddXPM(PushButton79,a_right_xpm)
IDEaddXPM(PushButton485,font_color_xpm)
IDEaddXPM(PushButton486,bkg_xpm)
---------------------------------------------------------
--------------------------------------------------------------------------------
--  Window Window20
constant Window20 = createEx( Window, "Move all instances", Window5, Default, Default, 188, 128, 0, 0 )
constant LText535 = createEx( LText, "Amount to move:", Window20, 40, 10, 90, 20, 0, 0 )
constant EditText538 = createEx( EditText, "", Window20, 40, 30, 90, 20, w32or_all({#2000}), 0 )
constant PushButton536 = createEx( PushButton, "OK", Window20, 10, 60, 70, 30, 0, 0 )
constant PushButton537 = createEx( PushButton, "Cancel", Window20, 100, 60, 70, 30, 0, 0 )
---------------------------------------------------------
--------------------------------------------------------------------------------
--being  ggame information
atom temp_background_color, temp_font_color
temp_background_color=16777215
temp_font_color=0
--end  game information
--=================================SPRITE EDITOR================================
integer sprite_window_width,sprite_window_height,image_width,image_height,select_image,
sprite_window_left,sprite_window_top
sprite_window_width=0
sprite_window_height=0
image_width=32
image_height=32
select_image=1
sprite_window_left=0
sprite_window_top=0
integer preview_image_single,preview_window_width,preview_window_height,preview_speed
atom background_color
preview_window_width=0
preview_window_height=0
preview_speed=30
object dib
dib=0
sequence images
images=
{
newDib(image_width,image_height)
}
--=================================================================
constant gaz=limitsize("", CWindow1, 150, 300, 300, 800, 0, 0 )
constant edittext_code=syntax ( "", Window4, 0, 0, 390, 360, w32or_all({WS_HSCROLL,WS_VSCROLL}), 0 )

sequence TestSeq1 TestSeq1 = { "to","if", "end", "then","for","by","while","self","other","do","global1","global2","global3","global4","global5","global6" }
sequence TestSeq2 TestSeq2 = { "random", "floor", "key_check", "place_empty", "instance_create",
"instance_create_move", "sprite_change","instance_destory","jump_to_start","game_end","view_center",
"reverse_dir","room_next","play_sound","grid","draw_text","string","instance_number","warp_object",
"outside_room","boundary","brush_color","brush_style","pen_color","font_color","rgb","draw_line",
"draw_rectangle","draw_roundrect","draw_ellipse","get_string","get_integer","show_message" ,"is_real",
"is_string","string_width","char","string_remove","string_copy","string_insert","string_char_at",
"string_remove_char","string_length","room_back","room_goto","game_load","game_save","create_pixel" }
sequence TestSeq3 TestSeq3 = {"x","y","dir","speed","image_single","image_speed","bbox_left","bbox_right",
"bbox_top","bbox_bottom","hdir","vdir","score","lives","health","room_width","room_height","mouse_button",
"mousex","mousey","view_left","view_top","view_width","view_height","background_color","current_room",
"last_room","keyboard_last","keyboard_key","solid","visible" }
sequence TestSeq4 TestSeq4 = {"vk_left","vk_right","vk_up","vk_down","vk_space","c_white","c_black",
"c_red","c_green","c_blue","c_brown","c_yellow","c_gray" }

constant
wordlist1 = synAddWords( edittext_code, TestSeq1, #000000 ),
wordlist2 = synAddWords( edittext_code, TestSeq2, #FF0000 ),
wordlist3 = synAddWords( edittext_code, TestSeq3, #FF9900 ),
wordlist4 = synAddWords( edittext_code, TestSeq4, #FF00FF )

constant app_key="HKEY_LOCAL_MACHINE\\Software\\ggmreg"
object data,registered_name,key
integer registered
integer count
count=0
registered =0
registered_name=""
if regKeyExists(app_key)=1 then
  data=regQueryValue(app_key,"registered","")
  if compare(data,"ggmyesreg")=0 then
	registered=1  -- change back when
	key=regQueryValue(app_key,"name","")
	registered_name=key
    for i=1 to length(key) do
       --registered_name&=key[i]-i-floor(key[i]/i)
    end for
  end if
else
  data=regSetValue(app_key,"registered","")
end if

procedure file_to_sequence(sequence infile, sequence outfile)
 integer fn,char,count
 sequence buffer
 buffer={}
 count=0
 fn=open(infile,"rb")
 while 1 do
    char=getc(fn)
    if char=-1 then
      exit
    end if
    buffer&=char
 end while
close(fn)
-- turn into sequence include file
fn=open(outfile,"w")
puts(fn,"global sequence filedata\n")
puts(fn,"filedata={")
  for i=1 to length(buffer) do
    if count=0 then
      puts(fn,"{")
      print(fn,buffer[i])
      puts(fn,",")
      count+=1
    elsif count=255 then
      print(fn,buffer[i])
      puts(fn,"},"&'\n')
      count=0
    else
    count+=1
    print(fn,buffer[i])
    if i!=length(buffer) then
      puts(fn,",")
    end if
    end if
  end for
puts(fn,"}}")
close(fn)
end procedure

procedure sequence_to_file(sequence data, sequence outfile)
integer fn
  fn=open(outfile,"wb")
  for i=1 to length(data) do
    puts(fn,data[i])
  end for
  close(fn)
end procedure

constant Buffer  = create( Pixmap, "", 0, 0, 0, 100, 100, 0 )

procedure color_to_color(integer width, integer height)
atom color,temp
  color=getPixel(Buffer,0,0)
  for i=0 to height-1 do
  	 for j=0 to width-1 do
  	 	temp=getPixel(Buffer,j,i)
  	 	if temp=color then
          setPixel(Buffer,j,i,rgb(255,255,255))	
  	 	end if
  	 end for
  end for
end procedure

--=================================INCLUDE ZIP==========================================-
procedure show_message(sequence msg)
integer ok
ok=message_box(msg,  "info",MB_ICONINFORMATION)
end procedure
integer
    resourceStart
sequence
    resourceFile,
    resName,
    resSize,
    resOffset,
    handleMax,
    handleOffset
function readNum( integer handle )
    sequence s
    s = gets( handle )
    s = value( s )
    if s[1] != GET_SUCCESS then
        return 0
    else
        return s[2]
    end if
end function
function readString( integer handle )
    sequence s
    s = gets( handle )
    return s[1..length(s)-1]
end function
procedure readResFile( sequence s )
    integer count, handle, here, ignore
    handle = open( s, "rb" )
    ignore = seek( handle, resourceStart )
    count = readNum( handle )
    for i = 1 to count do
        resName = append( resName, readString( handle ) )
        resSize = append( resSize, readNum( handle ) )
        resOffset = append( resOffset, where( handle ) )
        here = where( handle )
        if seek( handle, here + resSize[i] ) then
            show_message("Error: End of Resource File!\n")
        end if
    end for
close(handle)
end procedure
procedure open_res(sequence fname)
    resourceStart  = 0
    resourceFile    = {}
    resName = {}
    resSize = {}
    resOffset = {}
    handleMax={}
    handleOffset={}
    handleMax       = repeat( 0, 250 )
    handleOffset    = repeat( 0, 250 )
resourceFile = fname
readResFile( fname)
end procedure
procedure zip_file(sequence outName ,sequence  resFiles)
integer outFile,inFile
object data
openWindow(Window9,Modal)
setText(lable_text,"Saveing...")
setScrollRange ( pb_bar, 0, length(resFiles) )
outFile = open( outName, "wb" )
printf( outFile, "%d\n", length( resFiles ) )
for i = 1 to length( resFiles ) do
    setScrollPos ( pb_bar, i )
    puts( outFile, resFiles[i] & "\n" )
    data = dir( resFiles[i] )
    if length( data ) = 0 then
        abort(0)
    end if
    data = data[1][D_SIZE]
    printf( outFile, "%d\n", {data} )
    inFile = open( resFiles[i], "rb" )
    for j = 1 to data do
        puts( outFile, getc( inFile ) )
    end for
    close( inFile )
end for
close( outFile )
closeWindow(Window9)
end procedure
function ropen( sequence res, sequence mode )
    integer handle, at
        at = find( res, resName )
        if at = 0 then
            abort(0)
        end if
        handle = open( resourceFile, mode )
        if handle = -1 then
            return -1
        end if
        handleOffset[handle] = resOffset[at]
        handleMax[handle] = handleOffset[handle] + resSize[at] - 1
        if seek( handle, handleOffset[handle] ) then
            show_message("zip err")
        end if
    return handle
end function
function reof( integer handle )
    return where( handle ) > handleMax[handle]
end function
procedure unzip_file(sequence name,sequence path)
integer handle,fn
sequence data,temp
object line
openWindow(Window9,Modal)
setText(lable_text,"Loading...")
open_res(name)
setScrollRange ( pb_bar, 0, length(resName)+5 )
for i=1 to length(resName) do
  doEvents(0)
  setScrollPos ( pb_bar, i )
  data={}
  handle = ropen(resName[i],"rb")
  while not reof( handle ) do
    line=gets( handle )
    if atom(line)=1 then
      show_message("zip err")
    else
	if length(line)>1 then
      temp=line[1..length(line)-2]
      temp&=line[length(line)]
      data=append(data, temp )
	else
     data=append(data, line[1] )
    end if
    end if
  end while
  close(handle)
  fn=open(path&resName[i],"w")
  for j=1 to length(data) do
    puts(fn,data[j])
  end for
  close(fn)
end for
end procedure

--================================================================================

integer game_maker_save_changes
sequence game_maker_save_path,game_maker_save_name
game_maker_save_changes=0
game_maker_save_name=""
game_maker_save_path=""


sequence key_buffer,delete_list
key_buffer={}
delete_list={}

sequence sprite_info,sprite_window_images,sprite_window_filenames
integer sprite_number,sprite_window_index,sprite_window_image_index,
sprite_window_image_width,sprite_window_image_height,temp_index,item_index,
sprite_window_closed,sprite_window_save_changes
atom sprite_window_transprant_color,clicktime,newclicktime

temp_index=0
item_index=0
clicktime=0
newclicktime=0

constant SPR_NAME=1
constant SPR_FILENAMES=2
constant SPR_IMAGES=3
constant SPR_BBOX_LEFT=4
constant SPR_BBOX_RIGHT=5
constant SPR_BBOX_TOP=6
constant SPR_BBOX_BOTTOM=7
constant SPR_BBOX_MODE=8
constant SPR_WIDTH=9
constant SPR_HEIGHT=10
constant SPR_TRANSPRANT=11
constant SPR_TRANSPRANT_COLOR=12
constant SPR_OFFSETX=13
constant SPR_OFFSETY=14

constant SPR_DATA_LENGTH=14

sprite_info={}
sprite_number=0
sprite_window_index=0
sprite_window_images={}
sprite_window_filenames={}
sprite_window_image_index=0
sprite_window_image_width=0
sprite_window_image_height=0
sprite_window_transprant_color=0
sprite_window_closed=0
sprite_window_save_changes=0

sequence object_info,object_window_code
integer object_number,object_window_index,object_window_code_index,
object_window_closed,object_window_save_changes,code_editor_save_changes

constant OBJ_NAME=1
constant OBJ_VISIBLE=2
constant OBJ_SOLID=3
constant OBJ_SPRITE=4
constant OBJ_CODE=5
constant OBJ_CODE_LENGTH=8
constant OBJ_DATA_LENGTH=5

constant OBJ_CREATE=1
constant OBJ_DESTORY=2
constant OBJ_STEP=3
constant OBJ_KEYBOARD=4
constant OBJ_KEYBOARD_UP=5
constant OBJ_KEYBOARD_DOWN=6
constant OBJ_COLLISION=7
constant OBJ_DRAW=8

constant OBJ_COLLISION_NAME=1
constant OBJ_COLLISION_CODE=2

object_info={}
object_number=0
object_window_index=0
object_window_code={}
object_window_code_index=0
object_window_closed=0
object_window_save_changes=0
code_editor_save_changes=0

sequence room_info,room_window_background_filename,room_window_pack
integer room_number,room_window_index,room_window_background_color,
room_window_width,room_window_height,room_buffer_offsetx,
room_buffer_offsety,
room_buffer_left,room_buffer_top,room_buffer_height,room_buffer_width,
room_window_snapx,room_window_snapy,room_window_closed,room_buffer_can_focus,
room_window_save_changes,room_window_move_mode
atom room_window_background_image,room_window_object_image


constant ROOM_NAME=1
constant ROOM_CAPTION=2
constant ROOM_WIDTH=3
constant ROOM_HEIGHT=4
constant ROOM_SPEED=5
constant ROOM_BACKGROUND_COLOR=6
constant ROOM_BACKGROUND_IMAGE=7
constant ROOM_BACKGROUND_FILENAME=8
constant ROOM_BACKGROUND_MODE=9
constant ROOM_VIEW=10
constant ROOM_VIEW_WIDTH=11
constant ROOM_VIEW_HEIGHT=12
constant ROOM_SNAPX=13
constant ROOM_SNAPY=14
constant ROOM_BACKGROUND_STYLE=15
constant ROOM_PACK=16
constant ROOM_DATA_LENGTH=16

constant ROOM_PACK_OBJECT=1
constant ROOM_PACK_SPRITE=2
constant ROOM_PACK_X=3
constant ROOM_PACK_Y=4
constant ROOM_PACK_WIDTH=5
constant ROOM_PACK_HEIGHT=6
constant ROOM_PACK_OFFSETX=7
constant ROOM_PACK_OFFSETY=8
constant ROOM_PACK_IMAGE=9
constant ROOM_PACK_TRANSPRANT_COLOR=10  --new


room_info={}
room_number=0
room_window_index=0
room_window_background_color=0
room_window_background_image=0
room_window_background_filename=""
room_window_width=0
room_window_height=0
room_buffer_offsetx=0
room_buffer_offsety=0
room_buffer_left=0
room_buffer_top=0
room_buffer_height=0
room_buffer_width=0
room_window_snapx=0
room_window_snapy=0
room_window_closed=0
room_window_pack={}
room_buffer_can_focus=0
room_window_save_changes=0
room_window_move_mode=0

sequence sound_info,sound_window_filename
integer sound_number,sound_window_index,sound_window_closed,
sound_window_save_changes

constant SND_NAME=1
constant SND_FILENAME=2
constant SND_DATA_LENGTH=2

sound_info={}
sound_number=0
sound_window_index=0
sound_window_closed=0
sound_window_filename=""
sound_window_save_changes=0

function remove_sequence(sequence info,integer num)
sequence temp
temp={}
  for i=1 to length(info) do
     if i=num then
     else
       temp=append(temp,info[i])
     end if
  end for
  return temp
end function

function real(object v)
sequence val
if sequence(v) then
val=value(v)
return val[2]
else
return v	
end if
end function

procedure info_m(sequence msg)
integer ok
ok=message_box(msg,  "info",MB_ICONINFORMATION)
end procedure

function getd(integer fn)
object data
 data=gets(fn)
 if sequence(data) then
   return data[1..length(data)-1]
 else
	return 0
 end if
end function

procedure key_add(integer scancode)
integer find1
find1=0
  for i=1 to length(key_buffer) do
    if key_buffer[i]=scancode then
      find1=1
      exit
    end if
  end for
if find1=0 then
  key_buffer=append(key_buffer,scancode)
end if
end procedure

procedure key_remove(integer scancode)
  for i=1 to length(key_buffer) do
     if key_buffer[i]=scancode then
       key_buffer=remove_sequence(key_buffer,i)
       exit
     end if
  end for
end procedure

function key_check(integer scancode)
  for i=1 to length(key_buffer) do
    if key_buffer[i]=scancode then
      return 1
    end if
  end for
return 0
end function

function file_exsist(sequence fname)
  integer fn
  fn=open(fname,"r")
  if fn!=-1  then
    close(fn)
  	return 1
  end if
  return 0
end function

function get_file_path_part(sequence fname)
    for i=length(fname) to 1 by -1 do
    	if fname[i]='\\' then
    		return fname[1..i]
    	end if
    end for
	--return ""
end function

function get_file_name_part(sequence fname)
    for i=length(fname) to 1 by -1 do
    	if fname[i]='\\' then
    	   for j=length(fname) to i by -1 do
    	   	  if fname[j]='.' then
    	   	  	return fname[i+1..j-1]
    	   	  end if
    	   end for
    	   return fname[i+1..length(fname)]
    	end if
    end for
	--return ""
end function

function get_file_fullname_part(sequence fname)
    for i=length(fname) to 1 by -1 do
    	if fname[i]='\\' then
    	   return fname[i+1..length(fname)]
    	end if
    end for
	--return ""
end function

sequence working_d
working_d=command_line()
working_d=get_file_path_part(working_d[1])
room_window_object_image=loadBitmapFromFile( working_d&"\\object.bmp" )-- fix

procedure centerwindow(integer win)
integer width,height,window_width,window_height
sequence size
    size=getCtlSize(win)
    window_width=size[1]
    window_height=size[2]
    width=w32Func(xGetSystemMetrics,{SM_CXSCREEN})
    height=w32Func(xGetSystemMetrics,{SM_CYSCREEN})
    setRect( win,floor((width/2))-floor((window_width/2)) ,floor((height/2))-floor((window_height/2))-32, window_width, window_height, 0 )
end procedure
--======================================Gaz Game Maker WINDOW========================================

procedure new_game_maker()
sequence folders
atom openfolder2,closefolder2
eraseItems( TreeView1 )
sprite_info={}
sprite_number=0
object_info={}
object_number=0
room_info={}
room_number=0
sound_info={}
sound_number=0
game_maker_save_changes=0
game_maker_save_name=""
game_maker_save_path=""
setCheck(select_settings_debug_collision,1)
setCheck(select_settings_escape_key,1)
setCheck(select_settings_debug_caption, 1 )
--setCheck(select_settings_auto_bbox, 1 )
setCheck(select_settings_show_cursor, 1 )
setCheck(select_settings_draw_score, 1 )
setCheck(select_settings_draw_health, 1)
setCheck(select_settings_draw_lives, 1 )
--setCheck(select_settings_loading_screen,1)
setCheck(select_settings_can_pause, 1)
--setCheck(select_settings_compile_code, 1 )
setCheck(select_settings_caption_fullscreen, 1 )
setCheck(select_settings_debug_window, 1 )
setCheck(select_settings_save_screen, 1 )
setCheck(select_settings_swith_screen, 1 )
setCheck(select_settings_game_help, 1 )
setCheck(select_settings_start_fullscreen, 1 )
openfolder2 = addIcon( extractIcon({"c:\\windows\\system32\\shell32.dll", 5,0}) )
closefolder2 = addIcon( extractIcon({"c:\\windows\\system32\\shell32.dll", 4,0}) )
folders = {}
folders &= addTVItem( TreeView1, closefolder2,openfolder2, "Sprites" , 0 )
folders &= addTVItem( TreeView1, closefolder2,openfolder2, "Sounds" , 0 )
folders &= addTVItem( TreeView1, closefolder2,openfolder2, "Objects" , 0 )
folders &= addTVItem( TreeView1, closefolder2,openfolder2, "Rooms" , 0 )
closefolder2=addXpm(tv_help_xpm)
folders &= addTVItem( TreeView1, closefolder2,closefolder2, "Game Information" , 0 )
closefolder2=addXpm(tv_settings_xpm)
folders &= addTVItem( TreeView1, closefolder2,closefolder2, "Game Settings" , 0 )
--being  ggame information
temp_background_color=16777215
openfolder2=sendMessage( richedit_help,1091,0, temp_background_color )
temp_font_color=0
setText(richedit_help,"")
--end  game information
setText(Window1,"Gaz Game Maker")
end procedure

procedure load_datafile_game_maker(sequence fname)
integer fn,c,temp
sequence rich
  fn=open(fname,"r")
  setCheck(select_settings_debug_collision, real(gets(fn)) )
  setCheck(select_settings_escape_key, real(gets(fn)) )
  setCheck(select_settings_debug_caption, real(gets(fn)) )
  --setCheck(select_settings_auto_bbox, real(gets(fn)) )
  temp=real(gets(fn))
  setCheck(select_settings_show_cursor, real(gets(fn)) )
  setCheck(select_settings_draw_score, real(gets(fn)) )
  setCheck(select_settings_draw_health, real(gets(fn)) )
  setCheck(select_settings_draw_lives, real(gets(fn)) )
  --setCheck(select_settings_loading_screen, real(gets(fn)) )
  temp=real(gets(fn))
  setCheck(select_settings_can_pause, real(gets(fn)) )
  --setCheck(select_settings_compile_code, real(gets(fn)) )
  temp=real(gets(fn))
  setCheck(select_settings_caption_fullscreen, real(gets(fn)) )
  -- new settings
  setCheck(select_settings_debug_window, real(gets(fn)) )
  setCheck(select_settings_save_screen, real(gets(fn)) )
  setCheck(select_settings_swith_screen, real(gets(fn)) )
  setCheck(select_settings_game_help, real(gets(fn)) )
  -- new settings 29/01/07
  setCheck(select_settings_start_fullscreen, real(gets(fn)) )
  -- add the game information to the end
        rich = {}
        c = 0
        while c != -1 do
            c = getc( fn )
            rich &= c
        end while
        close(fn)
        rich = rich[1..length(rich)-1]
        -- Select all the existing text
        setIndex(richedit_help, {1,0})
        -- Replace the selection with the file data.
        putStream( richedit_help, StreamRTF , rich )
        for i=length(rich) to 1 by -1 do
           if rich[i]=0 then
             if length(rich[i+1..length( rich)])>0 then
               rich= value ( rich[i+1..length( rich)]  )
           	   temp_background_color= rich[2]
           	   fn=sendMessage( richedit_help,1091,0, temp_background_color )
             else
               temp_background_color=16777215
               fn=sendMessage( richedit_help,1091,0, temp_background_color )
             end if
           	 exit
           end if
        end for

end procedure

procedure save_datafile_game_maker(sequence fname)
integer fn
sequence temp
  fn=open(fname,"w")
  puts(fn,sprint(isChecked(select_settings_debug_collision))&"\n")
  puts(fn,sprint(isChecked(select_settings_escape_key))&"\n")
  puts(fn,sprint(isChecked(select_settings_debug_caption))&"\n")
  --puts(fn,sprint(isChecked(select_settings_auto_bbox))&"\n")
  puts(fn,"0\n")
  puts(fn,sprint(isChecked(select_settings_show_cursor))&"\n")
  puts(fn,sprint(isChecked(select_settings_draw_score))&"\n")
  puts(fn,sprint(isChecked(select_settings_draw_health))&"\n")
  puts(fn,sprint(isChecked(select_settings_draw_lives))&"\n")
  --puts(fn,sprint(isChecked(select_settings_loading_screen))&"\n")
  puts(fn,"0\n")
  puts(fn,sprint(isChecked(select_settings_can_pause))&"\n")
  --puts(fn,sprint(isChecked(select_settings_compile_code))&"\n")
  puts(fn,"0\n")
  puts(fn,sprint(isChecked(select_settings_caption_fullscreen))&"\n")
  -- new settings
  puts(fn,sprint(isChecked(select_settings_debug_window))&"\n")
  puts(fn,sprint(isChecked(select_settings_save_screen))&"\n")
  puts(fn,sprint(isChecked(select_settings_swith_screen))&"\n")
  puts(fn,sprint(isChecked(select_settings_game_help))&"\n")
  -- new settings 29/01/07
  puts(fn,sprint(isChecked(select_settings_start_fullscreen))&"\n")
  -- add the game information to the end
  temp=getStream( richedit_help, StreamRTF)
  for i=1 to length(temp) do
  	puts(fn,temp[i])
  end for
  puts(fn,sprint(temp_background_color))
  close(fn)
end procedure

function get_treeview_name_index(sequence name)-- this dose not work not used
  for i=1 to 1000 do
  	 if compare(name,getItem(TreeView1,i))=0 then
  	 	return i
  	 end if
  end for
  return 0
end function

procedure updata_objects_sprite_name(integer index, sequence old_name, integer mode)
atom image
	if mode=1 then -- sprite changed
	  if compare(old_name,sprite_info[index][SPR_NAME])=0 then
     	  	
      else
         for i=1 to length(object_info) do
         	if compare(object_info[i][OBJ_SPRITE],old_name)=0 then
         	   object_info[i][OBJ_SPRITE]=sprite_info[index][SPR_NAME]
         	end if
         end for
	  end if	
	elsif mode=2 then -- sprite deleted
		for i=1 to length(object_info) do
         	if compare(object_info[i][OBJ_SPRITE],old_name)=0 then
         	   --if length(sprite_info)=0 then
         	   	  object_info[i][OBJ_SPRITE]=""
         	 -- need to updata the treeview for object
         	   --else  --object don't have to have a sprite
         	   --  object_info[i][OBJ_SPRITE]=sprite_info[1][SPR_NAME]
         	   --end if
         	end if
         end for
    elsif mode=3 then -- new sprite
      --if length(sprite_info)=1 then   --object don't have to have a sprite
      --  for i=1 to length(object_info) do
      --     if compare(object_info[i][OBJ_SPRITE],"")=0 then
      --     	  object_info[i][OBJ_SPRITE]=old_name
      --     end if
      --  end for
      --end if
	end if
end procedure

procedure updata_rooms_sprite_name(integer index, sequence old_name, integer mode)
	if mode=1 then -- sprite changed
         for i=1 to length(room_info) do
            for j=1 to length(room_info[i][ROOM_PACK]) do

              if compare(room_info[i][ROOM_PACK][j][ROOM_PACK_SPRITE],old_name)=0 then
              room_info[i][ROOM_PACK][j][ROOM_PACK_SPRITE]=sprite_info[index][SPR_NAME]      	
         	    if length(sprite_info[index][SPR_IMAGES])>0 then
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_IMAGE]=sprite_info[index][SPR_IMAGES][1]
                  room_info[i][ROOM_PACK][j][ROOM_PACK_OFFSETX]=real(sprite_info[index][SPR_OFFSETX])
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_OFFSETY]=real(sprite_info[index][SPR_OFFSETY])
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_WIDTH]=real(sprite_info[index][SPR_WIDTH])
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_HEIGHT]=real(sprite_info[index][SPR_HEIGHT])
         	      if sprite_info[index][SPR_TRANSPRANT]=1 then --new
         	        room_info[i][ROOM_PACK][j][ROOM_PACK_TRANSPRANT_COLOR]=sprite_info[index][SPR_TRANSPRANT_COLOR] --new
         	      else --new
         	        room_info[i][ROOM_PACK][j][ROOM_PACK_TRANSPRANT_COLOR]=-1 --new
         	      end if --new
         	    else
           	      room_info[i][ROOM_PACK][j][ROOM_PACK_IMAGE]=room_window_object_image
           	      room_info[i][ROOM_PACK][j][ROOM_PACK_OFFSETX]=0
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_OFFSETY]=0
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_WIDTH]=16
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_HEIGHT]=16
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_TRANSPRANT_COLOR]=-1 --new
         	    end if         	  	
         	  end if
            end for
         end for
	elsif mode=2 then -- sprite deleted
		for i=1 to length(room_info) do
            for j=1 to length(room_info[i][ROOM_PACK]) do
              if compare(room_info[i][ROOM_PACK][j][ROOM_PACK_SPRITE],old_name)=0 then
                --if length(sprite_info)=0 then
         	   	  room_info[i][ROOM_PACK][j][ROOM_PACK_SPRITE]=""
                  room_info[i][ROOM_PACK][j][ROOM_PACK_OFFSETX]=0
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_OFFSETY]=0
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_WIDTH]=16
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_HEIGHT]=16
           	      room_info[i][ROOM_PACK][j][ROOM_PACK_IMAGE]=room_window_object_image
         	    --else
         	    --  room_info[i][ROOM_PACK][j][ROOM_PACK_SPRITE]=sprite_info[1][SPR_NAME]
                --  if length(sprite_info[1][SPR_IMAGES])>0 then
         	    --  room_info[i][ROOM_PACK][j][ROOM_PACK_IMAGE]=sprite_info[1][SPR_IMAGES][1]
                --  room_info[i][ROOM_PACK][j][ROOM_PACK_OFFSETX]=real(sprite_info[1][SPR_OFFSETX])
         	    --  room_info[i][ROOM_PACK][j][ROOM_PACK_OFFSETY]=real(sprite_info[1][SPR_OFFSETY])
         	    --  room_info[i][ROOM_PACK][j][ROOM_PACK_WIDTH]=real(sprite_info[1][SPR_WIDTH])
         	    --  room_info[i][ROOM_PACK][j][ROOM_PACK_HEIGHT]=real(sprite_info[1][SPR_HEIGHT])
         	    --  else
           	    --  room_info[i][ROOM_PACK][j][ROOM_PACK_IMAGE]=room_window_object_image
           	    --  room_info[i][ROOM_PACK][j][ROOM_PACK_OFFSETX]=0
         	    --  room_info[i][ROOM_PACK][j][ROOM_PACK_OFFSETY]=0
         	    --  room_info[i][ROOM_PACK][j][ROOM_PACK_WIDTH]=16
         	    -- room_info[i][ROOM_PACK][j][ROOM_PACK_HEIGHT]=16
         	    --  end if
         	    --end if       	
         	  end if
            end for
         end for
    elsif mode=3 then -- new sprite
      --if length(sprite_info)=1 then
      --  for i=1 to length(room_info) do
      --      for j=1 to length(room_info[i][ROOM_PACK]) do
      --        if compare(room_info[i][ROOM_PACK][j][ROOM_PACK_SPRITE],"")=0 then
      --           room_info[i][ROOM_PACK][j][ROOM_PACK_SPRITE]=old_name
      --           room_info[i][ROOM_PACK][j][ROOM_PACK_IMAGE]=room_window_object_image
      --     	     room_info[i][ROOM_PACK][j][ROOM_PACK_OFFSETX]=0
      --   	     room_info[i][ROOM_PACK][j][ROOM_PACK_OFFSETY]=0
      --   	     room_info[i][ROOM_PACK][j][ROOM_PACK_WIDTH]=16
      --   	     room_info[i][ROOM_PACK][j][ROOM_PACK_HEIGHT]=16
      --        end if
      --      end for
      --   end for
      --end if
	end if
end procedure

procedure updata_rooms_object_name(integer index, sequence old_name, integer mode)
	if mode=1 then
         for i=1 to length(room_info) do
            for j=1 to length(room_info[i][ROOM_PACK]) do
              if compare(room_info[i][ROOM_PACK][j][ROOM_PACK_OBJECT],old_name)=0 then
                room_info[i][ROOM_PACK][j][ROOM_PACK_OBJECT]=object_info[index][OBJ_NAME]      	
                for k=1 to length(sprite_info) do
                	if compare(object_info[index][OBJ_SPRITE], sprite_info[k][SPR_NAME])=0 then
                      room_info[i][ROOM_PACK][j][ROOM_PACK_SPRITE]=object_info[index][OBJ_SPRITE]
                if length(sprite_info[k][SPR_IMAGES])>0 then
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_IMAGE]=sprite_info[k][SPR_IMAGES][1]
                  room_info[i][ROOM_PACK][j][ROOM_PACK_OFFSETX]=real(sprite_info[k][SPR_OFFSETX])
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_OFFSETY]=real(sprite_info[k][SPR_OFFSETY])
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_WIDTH]=real(sprite_info[k][SPR_WIDTH])
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_HEIGHT]=real(sprite_info[k][SPR_HEIGHT])
         	      if sprite_info[k][SPR_TRANSPRANT]=1 then --new
         	        room_info[i][ROOM_PACK][j][ROOM_PACK_TRANSPRANT_COLOR]=sprite_info[k][SPR_TRANSPRANT_COLOR] --new
         	      else --new
         	        room_info[i][ROOM_PACK][j][ROOM_PACK_TRANSPRANT_COLOR]=-1 --new
         	      end if --new
         	    else
           	      room_info[i][ROOM_PACK][j][ROOM_PACK_IMAGE]=room_window_object_image
           	      room_info[i][ROOM_PACK][j][ROOM_PACK_OFFSETX]=0
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_OFFSETY]=0
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_WIDTH]=16
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_HEIGHT]=16
         	      room_info[i][ROOM_PACK][j][ROOM_PACK_TRANSPRANT_COLOR]=-1 --new
         	    end if
         	          exit
                	end if
                end for
         	  end if
            end for
         end for
	elsif mode=2 then
        for i=1 to length(room_info) do
            for j=1 to length(room_info[i][ROOM_PACK]) do
              for k=1 to length(room_info[i][ROOM_PACK]) do
              	if compare(room_info[i][ROOM_PACK][k][ROOM_PACK_OBJECT],old_name)=0 then
                   room_info[i][ROOM_PACK]=remove_sequence(room_info[i][ROOM_PACK],k)
                  exit
                end if
              end for
            end for
         end for
	end if
end procedure
--======================================SOUND WINDOW=======================================
function sound_exsist(sequence name)
  for i=1 to length(sound_info) do
  	 if compare(sound_info[i][SND_NAME],name)=0 then
  	 	return i
  	 end if
  end for
return 0
end function

procedure add_sound()
  sound_info=append(sound_info,
  {
  "sound"&sprint(sound_number), -- name
  ""
  }
  )
  sound_number+=1
  game_maker_save_changes=1
end procedure

procedure delete_sound()
sequence name
integer temp
    name=getTVSelectedText( TreeView1 )
	temp=deleteItem( TreeView1, getTVIndex(TreeView1) )
	sound_info=remove_sequence(sound_info,sound_exsist(name))
	game_maker_save_changes=1
end procedure

procedure sound_window_load()
integer item
atom image
setTransparentColor( rgb(255,255,255) )
image=addXpm(tv_wav_xpm)
   for i=1 to length(sound_info) do
   	  item=addTVItem( TreeView1, image,image, sound_info[i][SND_NAME] , 2 )
   end for
end procedure

procedure load_datafile_sound(sequence fname)
integer fn,sound_length,data_length
sequence temp,sounds
sounds={}
  fn=open(fname,"r")
  sound_length=real(gets(fn))
  sound_number=real(gets(fn))
  data_length=real(gets(fn))
  for i=1 to sound_length do
  	for j=1 to data_length do
  	   if j=SND_FILENAME then
  	     sounds=append(sounds, "c:\\windows\\temp\\"&get_file_fullname_part( getd(fn) ) )
  	     delete_list=append(delete_list, get_file_fullname_part(sounds[SND_FILENAME]) )
  	   elsif j=SND_NAME then
  	     sounds=append(sounds,getd(fn))
  	   end if
  	end for
  	sound_info=append(sound_info,sounds)
  	sounds={}
  end for
  sound_window_load()
  close(fn)
end procedure

procedure save_datafile_sound(sequence fname)
integer fn
  fn=open(fname,"w")
  print(fn,length(sound_info))
  puts(fn,'\n')
  print(fn,sound_number)
  puts(fn,'\n')
  print(fn,SND_DATA_LENGTH)
  puts(fn,'\n')
  for i=1 to length(sound_info) do
  	for j=1 to OBJ_DATA_LENGTH do
  	   if j=SND_FILENAME then
  	     puts(fn,sound_info[i][j]&'\n')
  	   elsif j=SND_NAME then
  	     puts(fn,sound_info[i][j]&'\n')
  	   end if
  	end for
  end for
  close(fn)
end procedure

procedure clear_sound_window()
	setText(textbox_snd_name,"")
	setText(lable_snd_filename,"")
	setVisible(group_snd_sound,0)
	setVisible(button_snd_save,0)
	sound_window_index=0
    sound_window_closed=0
    sound_window_filename=""
    sound_window_save_changes=0
end procedure

procedure close_sound_window()
  setTVText( getTVIndex ( TreeView1), getText(textbox_snd_name))
  repaintFG( Window1 )
  sound_info[sound_window_index][SND_NAME]=getText(textbox_snd_name)
  sound_info[sound_window_index][SND_FILENAME]=sound_window_filename
  game_maker_save_changes=1
end procedure

procedure open_sound_window(sequence name)
integer index,item
atom image
setTransparentColor( rgb(255,255,255) )
image=addXpm(tv_wav_xpm)
  clear_sound_window()
  openWindow(Window6,Modal)
  if length(name)>0 then
    index=sound_exsist(name)
    sound_window_index=index
    sound_window_filename=sound_info[index][SND_FILENAME]
    setText(textbox_snd_name,sound_info[index][SND_NAME])
    if length(sound_window_filename)>0 then
      setText(lable_snd_filename,  get_file_fullname_part(sound_window_filename)  )
      setVisible(group_snd_sound,1)
      setVisible(button_snd_save,1)
    end if
  else
    add_sound()
    item=addTVItem( TreeView1, image,image, sound_info[length(sound_info)][SND_NAME] , 2 )
    expandItem ( 2 )
    setIndex( TreeView1,item )
    setText(textbox_snd_name,sound_info[length(sound_info)][SND_NAME])
    sound_window_index=length(sound_info)
  end if
end procedure

--======================================ROOM WINDOW========================================
function room_exsist(sequence name)
  for i=1 to length(room_info) do
  	 if compare(room_info[i][ROOM_NAME],name)=0 then
  	 	return i
  	 end if
  end for
return 0
end function

procedure add_room()
	room_info=append(room_info,
	{
	"room"&sprint(room_number), -- name
	"", -- caption
	0,  -- width
	0,  -- height
	0,  -- speed
	0,  -- background color
	0,  -- background image
	"", -- background filename
	0,  -- background mode
    0,  -- view
    0,  -- view width
    0,  -- view height
    0,
    0,
    0,
    {}
	}
	)
	room_number+=1
	game_maker_save_changes=1
end procedure

procedure move_up_room()
sequence temp,name1,name2
integer index
	if length(room_info)>1 then -- if theres moor than one room
	    index=room_exsist(getTVSelectedText( TreeView1 ))
		if index>1 then
		  name1=room_info[index][ROOM_NAME]
	      name2=room_info[index-1][ROOM_NAME]
	      setTVText( item_index-1, name1 )
          setTVText( item_index, name2 )
		  temp=room_info[index-1]  -- save
	      room_info[index-1]=room_info[index]
	      room_info[index]=temp
	      setIndex( TreeView1, item_index-1)
	      repaintWindow( Window1 )
	      game_maker_save_changes=1
        end if
	end if
end procedure

procedure move_down_room()
sequence temp,name1,name2
integer index
	if length(room_info)>1 then -- if theres moor than one room
	    index=room_exsist(getTVSelectedText( TreeView1 ))
		if index<length(room_info) then
		  name1=room_info[index][ROOM_NAME]
	      name2=room_info[index+1][ROOM_NAME]
	      setTVText( item_index+1, name1 )
          setTVText( item_index, name2 )
		  temp=room_info[index+1]  -- save
	      room_info[index+1]=room_info[index]
	      room_info[index]=temp
	      setIndex( TreeView1, item_index+1)
	      repaintWindow( Window1 )
	      game_maker_save_changes=1
        end if
	end if
end procedure

procedure copy_room()
integer index,item,item2
sequence temp
atom openfolder2,closefolder2
atom image
image=addXpm(tv_room_xpm)
  index=room_exsist(getTVSelectedText( TreeView1 ))
  temp=room_info
  room_info={}
  for i=1 to length(temp) do
     if i=index then
       room_info=append(room_info, temp[i])
       room_info=append(room_info, temp[i])
       room_info[i+1][ROOM_NAME]="room"&sprint(room_number)
       room_number+=1
     else
	   room_info=append(room_info, temp[i])
     end if
  end for
  openfolder2 = addIcon( extractIcon({"c:\\windows\\system32\\shell32.dll", 5,0}) )
  closefolder2 = addIcon( extractIcon({"c:\\windows\\system32\\shell32.dll", 4,0}) )
  index=deleteItem( TreeView1, 4 )
  item2= addTVItem( TreeView1, closefolder2,openfolder2, "Rooms" , 0 )
  for i=1 to length(room_info) do
    item=addTVItem( TreeView1, image,image, room_info[i][ROOM_NAME] , item2 )
    if index+1=i then
      index=item
    end if
  end for
  setIndex( TreeView1, index)
  game_maker_save_changes=1
end procedure

procedure delete_room()
sequence name
integer temp
    name=getTVSelectedText( TreeView1 )
	temp=deleteItem( TreeView1, getTVIndex(TreeView1) )
	room_info=remove_sequence(room_info,room_exsist(name))
	game_maker_save_changes=1
end procedure

integer room_popup_menu
sequence room_popup_items,room_selected_item

room_selected_item=""
room_popup_menu=0
room_popup_items={}

integer Timer4
Timer4=0

procedure draw_room_object_preview()
atom image1
integer width,height
image1=0
    for i=1 to length(object_info) do
    	if compare(object_info[i][OBJ_NAME],room_selected_item)=0 then
    	  for j=1 to length(sprite_info) do
    	  	if compare(sprite_info[j][SPR_NAME],object_info[i][OBJ_SPRITE])=0 then
    	  	  if length(sprite_info[j][SPR_IMAGES])>0 then
         	   image1=sprite_info[j][SPR_IMAGES][1]
         	    width=sprite_info[j][SPR_WIDTH]
         	    height=sprite_info[j][SPR_HEIGHT]
              end if
    	  	  exit	
    	  	end if
    	  end for
    	  exit
    	end if
    end for

    setPenColor( buffer_object_preview, rgb(255,255,255) )
    drawRectangle( buffer_object_preview, 1, 0, 0, 32, 32 )
    if image1>0 then
      stretchBlt( buffer_object_preview,  -- copy to TheWindow
                  0, 0,     -- put at {10,10} in TheWindow
                  32, 32,    -- cause it to be this size
                  image1,       -- copy from loaded bitmap
                  0, 0,        -- upper left hand corner is {0,0}
                  width, height,     -- copy a 40x40 pixel portion
                  SRCCOPY )   -- replace destination with image
    end if
    bitBlt( Window5,10,460,buffer_object_preview,0,0,32,32,SRCCOPY )
end procedure

procedure room_popup_menu_selected(integer self, integer event, sequence params)
  for i=1 to length(room_popup_items) do
  	 if room_popup_items[i]=self then
  	 	room_selected_item=object_info[i][OBJ_NAME]
  	 	setText(textbox_room_object_name,room_selected_item)
  	 	draw_room_object_preview()
  	 	exit
  	 end if
  end for	
end procedure

procedure room_create_popup_menu()
atom image
  room_popup_items={}
  room_selected_item=""
  room_popup_menu=picmenu("",Window5,1,1,0,0,0,0)
  for i=1 to length(object_info) do
     if length(object_info[i][OBJ_SPRITE])>0 then
      for j=1 to length(sprite_info) do
      	if compare(object_info[i][OBJ_SPRITE],sprite_info[j][SPR_NAME])=0 then
      	  if length(sprite_info[j][SPR_IMAGES])>0 then
      	    setSize(Buffer,16,16)
            stretchBlt( Buffer,
                  0, 0,
                  16, 16,
                  sprite_info[j][SPR_IMAGES][1],
                  0, 0,
                  sprite_info[j][SPR_WIDTH], sprite_info[j][SPR_HEIGHT],
                  SRCCOPY )

            image=copyToTrueColorBitmapFile( Buffer, "c:\\windows\\temp\\temp.bmp", 0, 0, 16, 16 )
            image=loadBitmapFromFile("c:\\windows\\temp\\temp.bmp")
            room_popup_items=append(room_popup_items, picmenuitem(object_info[i][OBJ_NAME],room_popup_menu,0,0,0,0,0,image) )
            setHandler( room_popup_items[length(room_popup_items)], w32HClick, routine_id("room_popup_menu_selected"))	
          else
            room_popup_items=append(room_popup_items, picmenuitem(object_info[i][OBJ_NAME],room_popup_menu,0,0,0,0,0,"") )
            setHandler( room_popup_items[length(room_popup_items)], w32HClick, routine_id("room_popup_menu_selected"))
          end if
          exit
      	end if
      end for
     else
       room_popup_items=append(room_popup_items, picmenuitem(object_info[i][OBJ_NAME],room_popup_menu,0,0,0,0,0,"") )
       setHandler( room_popup_items[length(room_popup_items)], w32HClick, routine_id("room_popup_menu_selected"))
     end if
  end for
end procedure

procedure clear_room_window()
    room_window_index=0
    room_window_background_color=rgb(255,255,255)
    room_window_width=640
    room_window_height=500

    room_buffer_offsetx=0
    room_buffer_offsety=0
    room_buffer_left=0
    room_buffer_top=0
    room_buffer_width=608 --608
    room_buffer_height=496 -- 496
    setSize(room_buffer,608 ,496)
    room_window_snapx=16
    room_window_snapy=16
    room_window_background_image=0
    room_window_background_filename=""
    room_window_pack={}
    room_buffer_can_focus=1
    room_window_save_changes=0

    setVisible(group_room_background_style,0)
    setCheck(select_room_background_color,1)
    setCheck(select_room_background_image,0)

    setCheck(select_room_background_style_normal,1)
    setCheck(select_room_background_style_tile,0)

    setCheck(select_room_view_enable,0)
    setVisible(group_room_view,0)

    setText(textbox_room_width,"640")
  	setText(textbox_room_height,"480")
  	setText(textbox_room_speed,"30")
  	setText(textbox_room_caption,"")
  	setText(textbox_room_snapx,"16")
  	setText(textbox_room_snapy,"16")
  	setText(textbox_room_view_width,"0")
  	setText(textbox_room_view_height,"0")

    setScrollRange ( bar_room_width, 0, room_window_width )
	setScrollRange ( bar_room_height, 0, room_window_height )
	setWindowScrollRange ( bar_room_width, SB_HORZ, 0, room_window_width,  room_buffer_width)
	setWindowScrollRange ( bar_room_height, SB_VERT, 0, room_window_height, room_buffer_height)
    room_create_popup_menu()
    setText(textbox_room_object_name,"")
    if length(object_info)>0 then
      room_selected_item=object_info[1][OBJ_NAME]
      setText(textbox_room_object_name,room_selected_item)
    end if
    setCheck(button_room_grid,1)
end procedure

procedure close_room_window()
   setTVText( getTVIndex ( TreeView1), getText(textbox_room_name))
   repaintFG( Window1 )
   room_info[room_window_index][ROOM_NAME]=getText(textbox_room_name)
   room_info[room_window_index][ROOM_WIDTH]=room_window_width
   room_info[room_window_index][ROOM_HEIGHT]=room_window_height
   room_info[room_window_index][ROOM_VIEW]=isChecked(select_room_view_enable)
   room_info[room_window_index][ROOM_CAPTION]=getText(textbox_room_caption)
   room_info[room_window_index][ROOM_SPEED]=getText(textbox_room_speed)
   room_info[room_window_index][ROOM_VIEW_WIDTH]=getText(textbox_room_view_width)
   room_info[room_window_index][ROOM_VIEW_HEIGHT]=getText(textbox_room_view_height)
   room_info[room_window_index][ROOM_SNAPX]=room_window_snapx
   room_info[room_window_index][ROOM_SNAPY]=room_window_snapy
   room_info[room_window_index][ROOM_BACKGROUND_COLOR]=room_window_background_color
   room_info[room_window_index][ROOM_BACKGROUND_STYLE]=isChecked(select_room_background_style_tile)
   room_info[room_window_index][ROOM_BACKGROUND_MODE]=isChecked(select_room_background_image)
   if isChecked(select_room_background_image) then -- new 29/01/07
   	 room_info[room_window_index][ROOM_BACKGROUND_FILENAME]=room_window_background_filename
   	    room_info[room_window_index][ROOM_BACKGROUND_IMAGE]=room_window_background_image
   else-- new 29/01/07
      room_info[room_window_index][ROOM_BACKGROUND_FILENAME]=""-- new 29/01/07
      room_info[room_window_index][ROOM_BACKGROUND_IMAGE]=0 -- this cause is a memory leak
   end if-- new 29/01/07
   room_info[room_window_index][ROOM_PACK]=room_window_pack
   game_maker_save_changes=1
end procedure

procedure change_size_room_window()
	room_window_width=real(getText(textbox_room_width))
	room_window_height=real(getText(textbox_room_height))
	if room_window_width<room_buffer_width or room_window_height<room_buffer_height then
	   setSize(room_buffer,room_window_width,room_window_height)
	   repaintWindow( CWindow2 )
	else
	   setSize(room_buffer,room_buffer_width,room_buffer_height)
	end if
	setScrollRange ( bar_room_width, 0, room_window_width )
	setScrollRange ( bar_room_height, 0, room_window_height )
	setWindowScrollRange ( bar_room_width, SB_HORZ, 0, room_window_width,  room_buffer_width)
	setWindowScrollRange ( bar_room_height, SB_VERT, 0, room_window_height, room_buffer_height)
	
end procedure

procedure open_room_window(sequence name)
  integer index,item
  atom image
  setTransparentColor( rgb(255,255,255) )
  image=addXpm(tv_room_xpm)
  clear_room_window()
  if length(name)>0 then
    index=room_exsist(name)
    room_window_index=index

    room_window_background_image=room_info[room_window_index][ROOM_BACKGROUND_IMAGE]
    room_window_background_filename=room_info[room_window_index][ROOM_BACKGROUND_FILENAME]
    room_window_background_color=room_info[room_window_index][ROOM_BACKGROUND_COLOR]
    room_window_snapx=room_info[room_window_index][ROOM_SNAPX]
    room_window_snapy=room_info[room_window_index][ROOM_SNAPY]
    room_window_pack=room_info[room_window_index][ROOM_PACK]
    change_size_room_window()

    setText(textbox_room_name,name)
    setText(textbox_room_snapx,room_info[room_window_index][ROOM_SNAPX])
  	setText(textbox_room_snapy,room_info[room_window_index][ROOM_SNAPY])
    setText(textbox_room_width,room_info[room_window_index][ROOM_WIDTH])
  	setText(textbox_room_height,room_info[room_window_index][ROOM_HEIGHT])
  	setText(textbox_room_speed,room_info[room_window_index][ROOM_SPEED])
  	setText(textbox_room_caption,room_info[room_window_index][ROOM_CAPTION])
  	
    if room_info[room_window_index][ROOM_BACKGROUND_STYLE]=1 then -- tile
      setCheck(select_room_background_style_normal,0)
      setCheck(select_room_background_style_tile,1)
    else -- normal
      setCheck(select_room_background_style_normal,1)
      setCheck(select_room_background_style_tile,0)
    end if
    if room_info[room_window_index][ROOM_BACKGROUND_MODE]=1 then -- iamge
      setVisible(group_room_background_style,1)
      setCheck(select_room_background_color,0)
      setCheck(select_room_background_image,1)
    else-- color
      setCheck(select_room_background_color,1)
      setCheck(select_room_background_image,0)
    end if
  	setCheck(select_room_view_enable,room_info[room_window_index][ROOM_VIEW])
    setVisible(group_room_view,room_info[room_window_index][ROOM_VIEW])
    setText(textbox_room_view_width,room_info[room_window_index][ROOM_VIEW_WIDTH])
  	setText(textbox_room_view_height,room_info[room_window_index][ROOM_VIEW_HEIGHT])
  else
    add_room()
    item=addTVItem( TreeView1, image,image, room_info[length(room_info)][ROOM_NAME] , 4 )
    expandItem ( 4 )
    setIndex( TreeView1,item )
    room_window_index=length(room_info)
  	setText(textbox_room_name,room_info[length(room_info)][ROOM_NAME])
  	room_info[room_window_index][ROOM_NAME]=getText(textbox_room_name)
    room_info[room_window_index][ROOM_WIDTH]=room_window_width
    room_info[room_window_index][ROOM_HEIGHT]=room_window_height
    room_info[room_window_index][ROOM_VIEW]=isChecked(select_room_view_enable)
    room_info[room_window_index][ROOM_CAPTION]=getText(textbox_room_caption)
    room_info[room_window_index][ROOM_SPEED]=getText(textbox_room_speed)
    room_info[room_window_index][ROOM_VIEW_WIDTH]=getText(textbox_room_view_width)
    room_info[room_window_index][ROOM_VIEW_HEIGHT]=getText(textbox_room_view_height)
    room_info[room_window_index][ROOM_SNAPX]=room_window_snapx
    room_info[room_window_index][ROOM_SNAPY]=room_window_snapy
    room_info[room_window_index][ROOM_BACKGROUND_COLOR]=room_window_background_color
    room_info[room_window_index][ROOM_BACKGROUND_STYLE]=isChecked(select_room_background_style_tile)
    room_info[room_window_index][ROOM_BACKGROUND_MODE]=isChecked(select_room_background_image)
    room_info[room_window_index][ROOM_BACKGROUND_IMAGE]=room_window_background_image
    room_info[room_window_index][ROOM_BACKGROUND_FILENAME]=room_window_background_filename
  end if
  openWindow(Window5,Modal)
end procedure

procedure change_bar_room_window()
	room_buffer_left=getScrollPos( bar_room_width )
	room_buffer_top=getScrollPos( bar_room_height )
end procedure

procedure load_room_image()
sequence fname
integer cop1
  if room_window_background_image=0 then
    room_buffer_can_focus=0
    fname = getOpenFileName( Window2, "", {"Bmp Files","*.bmp"} )
    room_buffer_can_focus=1
    if length(fname)>0 then
     room_window_background_image=loadBitmapFromFile( fname )
     room_window_background_filename=fname
     cop1=copyFile(fname, "c:\\windows\\temp\\"&get_file_fullname_part(fname),0)
     delete_list=append(delete_list,get_file_fullname_part(fname))
    else
       setVisible(group_room_background_style,0)
       setCheck(select_room_background_color,1)
       setCheck(select_room_background_image,0)
       refreshWindow(group_room_background)
    end if
  end if
end procedure

procedure draw_room_window()
sequence size
integer width,height,x,y,offsetx,offsety
atom image,color

    setPenColor( room_buffer, room_window_background_color )
    drawRectangle( room_buffer, 1, 0, 0, room_buffer_width, room_buffer_height )

  if isChecked(select_room_background_color)=1 then
  	setPenColor( bitmap_room_background_color, room_window_background_color )
    drawRectangle( bitmap_room_background_color, 1, 0, 0, 80, 40 )
  else
    setPenColor( bitmap_room_background_image, rgb(255,255,255))
    drawRectangle( bitmap_room_background_image, 1, 0, 0, 80, 40 )
  if room_window_background_image !=0 then  -- found bug in the backgrounds this fixed it
    if isChecked(select_room_background_style_normal)=1 then
      drawBitmap( room_buffer, room_window_background_image ,room_buffer_offsetx-room_buffer_left, room_buffer_offsety-room_buffer_top )
    else
    size=getExtent( room_window_background_image )
    width=size[1]
    height=size[2]
      for i=room_buffer_top to room_buffer_top+room_buffer_height by height do
        for j=room_buffer_left to room_buffer_left+room_buffer_width by width do
           if j>(room_buffer_left-width) and j<room_buffer_left+room_buffer_width and i>(room_buffer_top-height) and i<room_buffer_top+room_buffer_height then
              drawBitmap( room_buffer, room_window_background_image,room_buffer_offsetx+j-room_buffer_left,room_buffer_offsety+i-room_buffer_top)
           end if
        end for
       end for
    end if
  end if
  end if

  for i=1 to length(room_window_pack) do
   	  offsetx=room_window_pack[i][7]
   	  offsety=room_window_pack[i][8]
   	  x=room_window_pack[i][3]-offsetx
   	  y=room_window_pack[i][4]-offsety
   	  x-=room_buffer_left
   	  y-=room_buffer_top
   	  x+=room_buffer_offsetx
   	  y+=room_buffer_offsety
   	  width=room_window_pack[i][5]
   	  height=room_window_pack[i][6]
   	  color=room_window_pack[i][10]--new
   	  if x+width>=room_buffer_offsetx and x<=room_buffer_offsetx+room_buffer_width and y+height>=room_buffer_offsety and y<=room_buffer_offsety+room_buffer_height then
   	    if color=-1 then--new
   	       drawBitmap( room_buffer, room_window_pack[i][9],x,y)
   	    else--new
   	      setTransparentColor( color )
   	      transBlt( room_buffer,x,y,room_window_pack[i][9])
   	    end if
   	  end if 	
  end for

setPenMode( room_buffer, R2_NOT )

if room_window_snapx>3 and isChecked(button_room_grid)=1 then
  setPenColor( room_buffer, 0 )
  for i=0 to room_window_width by room_window_snapx do
     x=room_buffer_offsetx+i-room_buffer_left
     y=room_buffer_offsety-room_window_snapy
     width=room_buffer_offsetx+i-room_buffer_left
     height=room_buffer_offsety+room_buffer_height
     if x+room_window_snapx>=room_buffer_offsetx and x-room_window_snapx<=room_buffer_offsetx+room_buffer_width and y+height+room_window_snapy>=room_buffer_offsety and y-room_window_snapy<=room_buffer_offsety+room_buffer_height then
     	 drawLine(room_buffer,x,y,width,height)
     end if
  end for
end if

if room_window_snapy>3 and isChecked(button_room_grid)=1 then
  setPenColor( room_buffer, 0 )
  for i=0 to room_window_height by room_window_snapy do

       x=room_buffer_offsetx-room_window_snapx
       y=room_buffer_offsety+i-room_buffer_top
       width=room_buffer_offsetx+room_buffer_width
       height=room_buffer_offsety+i-room_buffer_top
       if x+room_window_snapx>=room_buffer_offsetx and x-room_window_snapx<=room_buffer_offsetx+room_buffer_width and y+height+room_window_snapy>=room_buffer_offsety and y-room_window_snapy<=room_buffer_offsety+room_buffer_height then
  	   drawLine(room_buffer,x,y,width,height)
  	 end if
  end for
end if
setPenMode( room_buffer, R2_COPYPEN )
  bitBlt( CWindow2,room_buffer_offsetx,room_buffer_offsety,room_buffer,0,0,1000,1000,SRCCOPY )
end procedure

function snap_to_grid(integer x,integer y)
if room_window_snapx>3 then
for i=0 to room_window_width by room_window_snapx do
  if x>=i and x<=i+room_window_snapx then
  	x=i
  	exit
  end if
end for
end if

if room_window_snapy>3 then
for i=0 to room_window_height by room_window_snapy do
  if y>=i and y<=i+room_window_snapy then
  	y=i
  	exit
  end if
end for
end if
  return {x,y}
end function

function get_sprite_image(sequence name)
  if length(name)>0 then
  	for i=1 to length(sprite_info) do
		if compare(sprite_info[i][SPR_NAME],name)=0 then
		  if length(sprite_info[i][SPR_IMAGES])>0 then
		  	return sprite_info[i][SPR_IMAGES][1]
		  else
		    return room_window_object_image
		  end if
		end if
	end for
  else
	 return room_window_object_image
  end if
	
end function

function get_sprite_transprant_color(sequence name)
  if length(name)>0 then
  	for i=1 to length(sprite_info) do
		if compare(sprite_info[i][SPR_NAME],name)=0 then
		  if sprite_info[i][SPR_TRANSPRANT]=1 then
		  	return sprite_info[i][SPR_TRANSPRANT_COLOR]
		  else
		    return -1
		  end if
		end if
	end for
  else
	 return -1
  end if	
end function

function get_object_sprite_name(sequence name)
  for i=1 to length(object_info) do
   	  if compare(name,object_info[i][OBJ_NAME])=0 then
   	  	 return object_info[i][OBJ_SPRITE]
   	  	 exit
   	  end if
   end for
   return ""
end function

function get_object_sprite_size()
  sequence sprite_name,object_name
  if length(room_selected_item)>0 then
    object_name=room_selected_item
  	sprite_name=get_object_sprite_name(object_name)
  	for i=1 to length(sprite_info) do
  	    if length(sprite_info[i][SPR_IMAGES])>0 then
  	      if compare(sprite_info[i][SPR_NAME],sprite_name)=0 then
		    return {sprite_info[i][SPR_WIDTH],sprite_info[i][SPR_HEIGHT]}
		  end if
		else
		  return {16,16}
  	    end if
	end for
  end if
  return {16,16}
end function

function get_object_sprite_offset()
  sequence sprite_name,object_name
  if length(room_selected_item)>0 then
    object_name=room_selected_item
  	sprite_name=get_object_sprite_name(object_name)
  	for i=1 to length(sprite_info) do
		if compare(sprite_info[i][SPR_NAME],sprite_name)=0 then
		  return {real(sprite_info[i][SPR_OFFSETX]),real(sprite_info[i][SPR_OFFSETY])}
		end if
	end for
  end if
  return {0,0}
end function

procedure add_object_to_room_pack(integer x, integer y,integer width,integer height, integer offsetx, integer offsety)
sequence sprite_name,object_name
atom image,color
    object_name=room_selected_item
  	sprite_name=get_object_sprite_name(object_name)
  	image=get_sprite_image(sprite_name)
  	color=get_sprite_transprant_color(sprite_name)
  	  room_window_pack=append(room_window_pack,
  	  {
  	  object_name,
  	  sprite_name,
  	  x,
  	  y,
  	  width,
  	  height,
  	  offsetx,
  	  offsety,
  	  image,
  	  color  	
  	  }
  	  )
end procedure

function check_meeting(integer x1, integer y1, integer width1, integer height1, integer offsetx1, integer offsety1)
integer x2,y2,width2,height2,offsetx2,offsety2
  x1-=offsetx1
  y1-=offsety1
  for i=1 to length(room_window_pack) do
  	   offsetx2=room_window_pack[i][7]
       offsety2=room_window_pack[i][8]
       x2=room_window_pack[i][3]-offsetx2
       y2=room_window_pack[i][4]-offsety2
       width2=room_window_pack[i][5]
       height2=room_window_pack[i][6]
       -- check to see if x or y is inside a object
       if x1>=x2 and x1<x2+width2 and y1>=y2 and y1<y2+height2 then
         return i
       elsif x1>=x2 and x1<x2+width2 and y1+height1>y2 and y1<y2+height2 then
         return i
       elsif x1+width1>x2 and x1<x2+width2 and y1+height1>y2 and y1<y2+height2 then
         return i
       end if
  end for
  return 0
end function

procedure add_object_to_room(integer x, integer y)
sequence size, offset
integer collision1
    if length(room_selected_item)>0 then-- check to see if there a object selected
       size=get_object_sprite_size()
       offset=get_object_sprite_offset()
       for i=1 to length(room_window_pack) do  -- new 26/01/07
       collision1=check_meeting(x,y,size[1],size[2],offset[1],offset[2])
       if collision1=0 then
       	  --add_object_to_room_pack(x,y,size[1],size[2],offset[1],offset[2])
       else
          if key_check(VK_SPACE)=1 then
          else
            room_window_pack=remove_sequence(room_window_pack,collision1)
          end if
          --add_object_to_room_pack(x,y,size[1],size[2],offset[1],offset[2])
       end if
       end for -- new 26/01/07
       add_object_to_room_pack(x,y,size[1],size[2],offset[1],offset[2]) -- new 26/01/07
    end if	
end procedure

procedure delete_object_form_room(integer x, integer y)
integer collision1
	collision1=check_meeting(x,y,1,1,0,0)
	if collision1 !=0 then
	  room_window_pack=remove_sequence(room_window_pack,collision1)
	 draw_room_window()
    end if
end procedure

procedure mouse_room_window(integer mousex, integer mousey, integer event)
sequence size
sequence asv
	if mousex>room_buffer_offsetx and mousex<room_buffer_offsetx+room_buffer_width
	and mousey>room_buffer_offsety and mousey<room_buffer_offsety+room_buffer_height then
	  if room_buffer_can_focus=1 then
        setFocus(CWindow2)
      end if
      if event=MouseMove then
      else
        if event=LeftDown then
          size=snap_to_grid((room_buffer_left+mousex)-room_buffer_offsetx , (room_buffer_top+mousey)-room_buffer_offsety)
          add_object_to_room(size[1],size[2] )
          draw_room_window()
        elsif event=LeftUp then

        elsif event=RightDown then
           delete_object_form_room(room_buffer_left+mousex , room_buffer_top+mousey)
        elsif event=RightUp then

        end if
      end if
	end if
end procedure

procedure save_datafile_room(sequence fname)
integer fn
  fn=open(fname,"w")
  print(fn,length(room_info))
  puts(fn,'\n')
  print(fn,room_number)
  puts(fn,'\n')
  print(fn,ROOM_DATA_LENGTH)
  puts(fn,'\n')
  for i=1 to length(room_info) do
  	for j=1 to ROOM_DATA_LENGTH do
  	   if j=ROOM_PACK then
  	     print(fn,length(room_info[i][ROOM_PACK]))
	     puts(fn,'\n')
  	     for k=1 to length(room_info[i][ROOM_PACK]) do
  	        for l=1 to 10 do
  	           if l=ROOM_PACK_IMAGE then
               else
	             if sequence(room_info[i][ROOM_PACK][k][l]) then
	               puts(fn,room_info[i][ROOM_PACK][k][l]&'\n')
	             else
	               print(fn,room_info[i][ROOM_PACK][k][l])
	               puts(fn,'\n')
	             end if
  	     	   end if
  	        end for
  	     end for
  	   elsif j=ROOM_BACKGROUND_IMAGE then
	   else
	     if sequence(room_info[i][j]) then
	       puts(fn,room_info[i][j]&'\n')
	     else
	       print(fn,room_info[i][j])
	       puts(fn,'\n')
	     end if
  	   end if
  	end for
  end for
  close(fn)
end procedure

procedure room_window_load()
integer item
atom image
setTransparentColor( rgb(255,255,255) )
image=addXpm(tv_room_xpm)
   for i=1 to length(room_info) do
   	  item=addTVItem( TreeView1, image,image, room_info[i][ROOM_NAME] , 4 )
   end for
end procedure

procedure load_datafile_room(sequence fname)
integer fn,room_length,data_length,room_pack_length
sequence rooms
rooms={}
room_length=0
data_length=0
room_pack_length=0
  fn=open(fname,"r")
  room_length=real(gets(fn))
  room_number=real(gets(fn))
  data_length=real(gets(fn))
  for i=1 to room_length do
  	for j=1 to data_length do
  	   if j=ROOM_PACK then
  	     room_pack_length=real(gets(fn))
  	     rooms=append( rooms, repeat( {"","",0,0,0,0,0,0,room_window_object_image,-1}, room_pack_length ) )
  	     for k=1 to room_pack_length do
  	        for l=1 to 10 do
  	           if l=ROOM_PACK_IMAGE then
  	              rooms[j][k][l] = get_sprite_image( rooms[j][k][ROOM_PACK_SPRITE] )
  	           elsif l=ROOM_PACK_SPRITE then
  	             rooms[j][k][l]=getd(fn)
  	           --elsif l=ROOM_PACK_TRANSPRANT_COLOR then --new
  	           -- rooms[j][k][l]=real(gets(fn)) --new
  	           elsif l=ROOM_PACK_OBJECT then
  	             rooms[j][k][l]=getd(fn)
               else
	             rooms[j][k][l]=real(gets(fn))
  	     	   end if
  	        end for
  	     end for
  	   elsif j=ROOM_BACKGROUND_IMAGE then
  	      rooms=append(rooms,0)
  	   elsif j=ROOM_BACKGROUND_FILENAME then
  	      rooms=append ( rooms, getd(fn) )
  	      if length(rooms[ROOM_BACKGROUND_FILENAME])>0 then
  	        delete_list=append(delete_list,  get_file_fullname_part( rooms[ROOM_BACKGROUND_FILENAME]) )
  	      	rooms[ROOM_BACKGROUND_IMAGE]=loadBitmapFromFile("c:\\windows\\temp\\"& get_file_fullname_part( rooms[ROOM_BACKGROUND_FILENAME]) )
  	      end if
  	   elsif j=ROOM_NAME then
  	      rooms=append ( rooms, getd(fn) )
  	   elsif j=ROOM_CAPTION then
  	      rooms=append ( rooms, getd(fn) )
	   else
	      rooms=append ( rooms, real(gets(fn)) )
  	   end if
  	end for
  	room_info=append(room_info,rooms)
  	rooms={}
  end for
  room_window_load()
  close(fn)
end procedure

--======================================OBJECT WINDOW========================================
function object_exsist(sequence name)
  for i=1 to length(object_info) do
  	 if compare(object_info[i][OBJ_NAME],name)=0 then
  	 	return i
  	 end if
  end for
return 0
end function

procedure add_object()
	object_info=append(object_info,
	{
	"object"&sprint(object_number),
	1,
	0,
	"",
	{ {}, {}, {}, {}, {}, {}, {}, {}}
	}
	)
	object_number+=1
	game_maker_save_changes=1
end procedure

procedure remove_collision_name(sequence name)
  for i=1 to length(object_info) do
    for k=1 to length(object_info[i][OBJ_CODE][OBJ_COLLISION]) do
  	 for j=1 to length(object_info[i][OBJ_CODE][OBJ_COLLISION]) do
  	 	if compare(object_info[i][OBJ_CODE][OBJ_COLLISION][j][OBJ_COLLISION_NAME],name)=0 then
  	 		object_info[i][OBJ_CODE][OBJ_COLLISION]=remove_sequence(object_info[i][OBJ_CODE][OBJ_COLLISION],j)
  	 		exit
  	 	end if
  	 end for   	
    end for
  end for
end procedure

procedure delete_object()
sequence name
integer temp
    name=getTVSelectedText( TreeView1 )
	temp=deleteItem( TreeView1, getTVIndex(TreeView1) )
	remove_collision_name(name)
	object_info=remove_sequence(object_info,object_exsist(name))
	updata_rooms_object_name(object_window_index, name, 2)
	game_maker_save_changes=1
end procedure

function change_text(sequence text)
integer find1
sequence temp
temp={}
find1=0
if length(text)>0 then
  for i=1 to length(text) do
  	if text[i]='\n' then
  	  text[i]='#'
  	  find1=1
  	end if
  end for
  if find1=0 then
  	text&="#"
  end if
end if
  return text
end function

function change_text_back(sequence text)
sequence temp
temp={}
if length(text)>0 then
  for i=1 to length(text) do
  	if text[i]='#' then
  	  text[i]='\n'
  	end if
  end for
  if length(text)=1 then
  	text=""
  end if
end if
  return text
end function

function get_object_sprite_index(sequence name)
  for i=1 to length(sprite_info) do
  	 if compare(sprite_info[i][SPR_NAME],name)=0 then
  	 	return i
  	 end if
  end for
return 0
end function

procedure object_window_load()
integer item,index
atom image
   for i=1 to length(object_info) do
      image= -1
      if length(object_info[i][OBJ_SPRITE])>0 then
      index=get_object_sprite_index(object_info[i][OBJ_SPRITE])
        if length(sprite_info[index][SPR_IMAGES])>0 then
        setSize(Buffer,sprite_info[index][SPR_WIDTH],sprite_info[index][SPR_HEIGHT])
        stretchBlt( Buffer,  -- copy to TheWindow
                  0, 0,     -- put at {10,10} in TheWindow
                  16, 16,    -- cause it to be this size
                  sprite_info[index][SPR_IMAGES][1],       -- copy from loaded bitmap
                  0, 0,        -- upper left hand corner is {0,0}
                  sprite_info[index][SPR_WIDTH], sprite_info[index][SPR_HEIGHT],     -- copy a 40x40 pixel portion
                  SRCCOPY )   -- replace destination with image
        color_to_color(16, 16)
        image=copyToTrueColorBitmapFile( Buffer, "c:\\windows\\temp\\temp.bmp", 0, 0, 16, 16 )
        setTransparentColor( 0 )
        image=addDIB ( loadBitmapFromFile("c:\\windows\\temp\\temp.bmp") )
   	    end if
      end if
   	  item=addTVItem( TreeView1, image,image, object_info[i][OBJ_NAME] , 3 )
   end for
end procedure

procedure load_datafile_object(sequence fname)
integer fn,object_length,data_length,collision_length
sequence temp,temp_object
temp_object={}
temp={}
  fn=open(fname,"r")
  object_length=real(gets(fn))
  object_number=real(gets(fn))
  data_length=real(gets(fn))
  for i=1 to object_length do
  	for j=1 to data_length do
  	   if j=OBJ_CODE then
  	    temp_object=append(temp_object,{ {},{},{},{},{},{},{},{} })
  	     for k=1 to OBJ_CODE_LENGTH do
  	     	if k=OBJ_COLLISION then
  	     	  collision_length=real(getd(fn))
  	     	   temp_object[j][k]=repeat({"",""},collision_length)
  	     	  for l=1 to collision_length do
  	     	    temp_object[j][k][l][1]=getd(fn)
  	     	    temp_object[j][k][l][2]=change_text_back(getd(fn))
  	     	  end for
  	     	else
  	     	  temp_object[j][k]=change_text_back(getd(fn))
  	     	end if
  	     end for
  	   elsif j=OBJ_NAME then
  	     temp_object=append(temp_object,getd(fn))
  	   elsif j=OBJ_SPRITE then
  	     temp_object=append(temp_object,getd(fn))
  	   else
    	 temp_object=append(temp_object,real(gets(fn)))
  	   end if
  	end for
  	object_info=append(object_info,temp_object)
  	temp_object={}
  end for
  object_window_load()
  close(fn)
end procedure

procedure save_datafile_object(sequence fname)
integer fn
  fn=open(fname,"w")
  print(fn,length(object_info))
  puts(fn,'\n')
  print(fn,object_number)
  puts(fn,'\n')
  print(fn,OBJ_DATA_LENGTH)
  puts(fn,'\n')
  for i=1 to length(object_info) do
  	for j=1 to OBJ_DATA_LENGTH do
  	   if j=OBJ_CODE then
  	     for k=1 to OBJ_CODE_LENGTH do
  	     	if k=OBJ_COLLISION then
  	     	  print(fn,length(object_info[i][j][OBJ_COLLISION]))
  	     	  puts(fn,'\n')
  	     	  for l=1 to length(object_info[i][j][OBJ_COLLISION]) do
  	     	  	puts(fn,object_info[i][j][OBJ_COLLISION][l][OBJ_COLLISION_NAME]&'\n')
  	     	  	puts(fn,change_text(object_info[i][j][OBJ_COLLISION][l][OBJ_COLLISION_CODE])&'\n')
  	     	  end for
  	     	else
  	     	  puts(fn,change_text(object_info[i][j][k])&'\n')
  	     	end if
  	     end for
	   else
	     if sequence(object_info[i][j]) then
	       puts(fn,object_info[i][j]&'\n')
	     else
	       print(fn,object_info[i][j])
	       puts(fn,'\n')
	     end if
  	   end if
  	end for
  end for
  close(fn)
end procedure

integer popup_menu
sequence popup_items,selected_item

selected_item=""
popup_menu=0
popup_items={}

integer Timer3
Timer3=3

procedure draw_sprite_preview()
atom image1
integer width,height
image1=0
    for i=1 to length(sprite_info) do
       if compare(sprite_info[i][SPR_NAME],selected_item)=0 then
         if length(sprite_info[i][SPR_IMAGES])>0 then
         	image1=sprite_info[i][SPR_IMAGES][1]
         	width=sprite_info[i][SPR_WIDTH]
         	height=sprite_info[i][SPR_HEIGHT]
         end if
         exit
       end if
    end for
    setPenColor( buffer_sprite_preview, rgb(255,255,255) )
    drawRectangle( buffer_sprite_preview, 1, 0, 0, 32, 32 )
    if image1>0 then
      stretchBlt( buffer_sprite_preview,  -- copy to TheWindow
                  0, 0,     -- put at {10,10} in TheWindow
                  32, 32,    -- cause it to be this size
                  image1,       -- copy from loaded bitmap
                  0, 0,        -- upper left hand corner is {0,0}
                  width, height,     -- copy a 40x40 pixel portion
                  SRCCOPY )   -- replace destination with image
    end if
    bitBlt( Window3,4,64,buffer_sprite_preview,0,0,32,32,SRCCOPY )
end procedure

procedure popup_menu_selected(integer self, integer event, sequence params)
  for i=1 to length(popup_items) do
  	 if popup_items[i]=self then
  	 	selected_item=sprite_info[i][SPR_NAME]
  	 	setText(textbox_obj_sprite_name,selected_item)
  	 	draw_sprite_preview()
  	 	exit
  	 end if
  end for	
end procedure

procedure create_popup_menu()
atom image
  popup_items={}
  selected_item=""
  popup_menu=picmenu("",Window3,1,1,0,0,0,0)
  for i=1 to length(sprite_info) do
     if length(sprite_info[i][SPR_IMAGES])>0 then
      setSize(Buffer,16,16)
      stretchBlt( Buffer,
                  0, 0,
                  16, 16,
                  sprite_info[i][SPR_IMAGES][1],
                  0, 0,
                  sprite_info[i][SPR_WIDTH], sprite_info[i][SPR_HEIGHT],
                  SRCCOPY )
      image=copyToTrueColorBitmapFile( Buffer, "c:\\windows\\temp\\temp.bmp", 0, 0, 16, 16 )
      image=loadBitmapFromFile("c:\\windows\\temp\\temp.bmp")
      popup_items=append(popup_items, picmenuitem(sprite_info[i][SPR_NAME],popup_menu,0,0,0,0,0,image) )
      setHandler( popup_items[length(popup_items)], w32HClick, routine_id("popup_menu_selected"))
     else
       popup_items=append(popup_items, picmenuitem(sprite_info[i][SPR_NAME],popup_menu,0,0,0,0,0,"") )
       setHandler( popup_items[length(popup_items)], w32HClick, routine_id("popup_menu_selected"))
     end if
  end for
end procedure

procedure clear_object_window()
	setCheck(select_obj_visible,1)
	setCheck(select_obj_solid,0)
	setText(textbox_obj_name,"")
	setText(edittext_code,"")
	eraseItems( combox_obj_collision )
	object_window_code={}
	object_window_index=0
	object_window_closed=0
	object_window_save_changes=0
  	create_popup_menu()
  	setDefaultFont (  button_object_create)
  	setDefaultFont (  button_object_destroy )
  	setDefaultFont (  button_object_step )
  	setDefaultFont (  button_object_keyboard )
  	setDefaultFont (  button_object_keyboard_up )
  	setDefaultFont (  button_object_keyboard_down )
  	setDefaultFont (  button_object_collision )
  	setDefaultFont (  button_object_draw )
end procedure

function get_collision_index(sequence name)
   for i=1 to length(object_window_code[OBJ_COLLISION]) do
   	  if compare(object_window_code[OBJ_COLLISION][i][OBJ_COLLISION_NAME],name)=0 then
   	  	return i
   	  end if
   end for
   return 0
end function

procedure updata_collision_names(sequence befor ,sequence now)
  for i=1 to length(object_info) do
  	 for j=1 to length(object_info[i][OBJ_CODE][OBJ_COLLISION]) do
  	 	if compare(object_info[i][OBJ_CODE][OBJ_COLLISION][j][OBJ_COLLISION_NAME],befor)=0 then
  	 		object_info[i][OBJ_CODE][OBJ_COLLISION][j][OBJ_COLLISION_NAME]=now
  	 	end if
  	 end for
  end for
end procedure

procedure updata_collision()
  for i=1 to length(object_info) do
     for k=1 to length(object_info[i][OBJ_CODE][OBJ_COLLISION]) do
      for j=1 to length(object_info[i][OBJ_CODE][OBJ_COLLISION]) do
  	 	if length(object_info[i][OBJ_CODE][OBJ_COLLISION][j][OBJ_COLLISION_CODE])=0 then
  	 		object_info[i][OBJ_CODE][OBJ_COLLISION]=remove_sequence(object_info[i][OBJ_CODE][OBJ_COLLISION],j)
  	 		exit
  	 	end if
  	  end for
     end for
  end for
end procedure

function check_object_names(sequence name)
   for i=1 to length(object_info) do
   	  if compare(name,object_info[i][OBJ_NAME])=0 then
   	  	 return 1
   	  end if
   end for
	return 0
end function

constant
    CrLf    = { '\r','\n'},
    Lf      = { '\n' }

function getrichtext()
   integer handle, ignore, lFound
   sequence lBuffer
   integer len,found
   sequence newtext
    found=0
    lBuffer = getRichText( edittext_code, {0, 0})
    --being new 29/01/07
    for i=1 to length(lBuffer) do
       if lBuffer[i]!=32 then
         if lBuffer[i]!=10 then
           if lBuffer[i]!=13 then
             if lBuffer[i]!=9 then
           	   found=1
       	       exit
       	     end if
           end if
         end if
       end if
    end for
    if found=0 then
      return ""
    end if
    --end new 29/01/07
    while 1 do
      lFound = match(CrLf, lBuffer)
      if lFound = 0 then
         exit
      end if
      lBuffer = lBuffer[1 .. lFound - 1] &
                Lf &
                lBuffer[lFound+length(CrLf) .. length(lBuffer)]
    end while
    while 1 do
      lFound = find(13, lBuffer)
      if lFound = 0 then
        exit
      end if
   lBuffer = lBuffer[1 .. lFound - 1] &
                Lf &
                lBuffer[lFound+1 .. length(lBuffer)]
    end while
    return lBuffer
end function

procedure close_object_window_code()
integer collison_index
  if object_window_code_index=OBJ_COLLISION then
    collison_index=get_collision_index(getItem(combox_obj_collision,getIndex(combox_obj_collision)))
    if collison_index>0 then
       -- replace
       object_window_code[OBJ_COLLISION][collison_index][OBJ_COLLISION_CODE]=getrichtext ( )

    else
       -- add new
      object_window_code[OBJ_COLLISION]=append(object_window_code[OBJ_COLLISION],
      {
      getItem(combox_obj_collision,getIndex(combox_obj_collision)),
      getrichtext ( )
      }
      )
    end if
  else
    object_window_code[object_window_code_index]=getrichtext ( )
    if length(object_window_code[object_window_code_index])=0 then
      if object_window_code_index=OBJ_CREATE then
      	setDefaultFont ( button_object_create)
      elsif object_window_code_index=OBJ_DESTORY then
      	setDefaultFont ( button_object_destroy)
      elsif object_window_code_index=OBJ_STEP then
      	setDefaultFont ( button_object_step)
      elsif object_window_code_index=OBJ_KEYBOARD then
      	setDefaultFont ( button_object_keyboard)
      elsif object_window_code_index=OBJ_KEYBOARD_UP then
      	setDefaultFont ( button_object_keyboard_up)
      elsif object_window_code_index=OBJ_KEYBOARD_DOWN then
        setDefaultFont ( button_object_keyboard_down)
      elsif object_window_code_index=OBJ_DRAW then
      	setDefaultFont ( button_object_draw)
      end if
    else
      if object_window_code_index=OBJ_CREATE then
      	setFont ( button_object_create, "Arial" , 9 ,Bold)
      elsif object_window_code_index=OBJ_DESTORY then
      	setFont ( button_object_destroy, "Arial" , 9 ,Bold)
      elsif object_window_code_index=OBJ_STEP then
      	setFont ( button_object_step, "Arial" , 9 ,Bold)
      elsif object_window_code_index=OBJ_KEYBOARD then
      	setFont ( button_object_keyboard, "Arial" , 9 ,Bold)
      elsif object_window_code_index=OBJ_KEYBOARD_UP then
      	setFont ( button_object_keyboard_up, "Arial" , 9 ,Bold)
      elsif object_window_code_index=OBJ_KEYBOARD_DOWN then
      	setFont ( button_object_keyboard_down, "Arial" , 9 ,Bold)
      elsif object_window_code_index=OBJ_DRAW then
      	setFont ( button_object_draw, "Arial" , 9 ,Bold)
      end if
    end if
  end if
  setText(edittext_code, "")
  code_editor_save_changes=0
  closeWindow(Window4)
end procedure

procedure open_object_window_code(integer index)
integer collison_index
  openWindow(Window4,Modal)
  setFocus(edittext_code)
  if index=OBJ_COLLISION then
    object_window_code_index=index
    collison_index=get_collision_index(getItem(combox_obj_collision,getIndex(combox_obj_collision)))
    if collison_index>0 then
      setText(edittext_code, object_window_code[index][collison_index][OBJ_COLLISION_CODE])
    end if
  else
    object_window_code_index=index
    setText(edittext_code, object_window_code[index])
  end if
end procedure

procedure close_object_window()
sequence old_name
atom image
  old_name=object_info[object_window_index][OBJ_NAME]
  object_info[object_window_index][OBJ_CODE]=object_window_code
  updata_collision()
  if compare(object_info[object_window_index][OBJ_NAME],getText(textbox_obj_name))=0 then
  	--there the same
  else
    -- there diffrent
    if check_object_names(getText(textbox_obj_name))=0 then
      updata_collision_names(object_info[object_window_index][OBJ_NAME],getText(textbox_obj_name))
      setTVText( getTVIndex ( TreeView1), getText(textbox_obj_name))
      repaintFG( Window1 )
      object_info[object_window_index][OBJ_NAME]=getText(textbox_obj_name)
    else
      -- erorr can't have same name has over object in the treeview
      info_m("error can't have the same name as a object in the treeview")
    end if
  end if
  object_info[object_window_index][OBJ_VISIBLE]=isChecked(select_obj_visible)
  object_info[object_window_index][OBJ_SOLID]=isChecked(select_obj_solid)
  object_info[object_window_index][OBJ_SPRITE]=selected_item
  if length(selected_item)>0 then
     for i=1 to length(sprite_info) do
       if compare(sprite_info[i][SPR_NAME],selected_item)=0 then
       	 if length(sprite_info[i][SPR_IMAGES])>0 then
       	   setSize(Buffer,16,16)
           stretchBlt( Buffer,  -- copy to TheWindow
                  0, 0,     -- put at {10,10} in TheWindow
                  16, 16,    -- cause it to be this size
                  sprite_info[i][SPR_IMAGES][1],       -- copy from loaded bitmap
                  0, 0,        -- upper left hand corner is {0,0}
                  sprite_info[i][SPR_WIDTH], sprite_info[i][SPR_HEIGHT],     -- copy a 40x40 pixel portion
                  SRCCOPY )   -- replace destination with image
           color_to_color(16, 16)
           image=copyToTrueColorBitmapFile( Buffer, "c:\\windows\\temp\\temp.bmp", 0, 0, 16, 16 )
           setTransparentColor( 0 )
           image=addDIB ( loadBitmapFromFile("c:\\windows\\temp\\temp.bmp") )
   	       setTVImages ( getTVIndex ( TreeView1), image, image )
         else
           setTVImages ( getTVIndex ( TreeView1), 0, 0 )
           --working on need to make a black dib
       	 end if
         exit
       end if

     end for
   else
      setTVImages ( getTVIndex ( TreeView1), 0, 0 )
      --working on need to make a black dib
   end if
  updata_rooms_object_name(object_window_index, old_name , 1)
  game_maker_save_changes=1
end procedure

procedure open_object_window(sequence name)
  integer index,item
  clear_object_window()
  openWindow(Window3,Modal)
  if length(name)>0 then
    index=object_exsist(name)
    object_window_index=index
    object_window_code=object_info[object_window_index][OBJ_CODE]
    setText(textbox_obj_name,object_info[object_window_index][OBJ_NAME])
    setCheck(select_obj_visible,object_info[object_window_index][OBJ_VISIBLE])
    setCheck(select_obj_solid,object_info[object_window_index][OBJ_SOLID])
    for i=1 to length(object_info) do--new 31/01/07 fix bug
  		addItem( combox_obj_collision, object_info[i][OBJ_NAME] )
  	end for
  	setIndex(combox_obj_collision,1)
    if length(object_info[object_window_index][OBJ_SPRITE])>0 then -- change the sprite list
      for i=1 to length(sprite_info) do
      	 if compare(sprite_info[i][SPR_NAME],object_info[object_window_index][OBJ_SPRITE])=0 then
      	 	selected_item=sprite_info[i][SPR_NAME]
      	 	exit
      	 end if
      end for
    else-- change the sprite list
      selected_item=""
    end if-- change the sprite list
   	  for j=1 to length(object_info[index][OBJ_CODE]) do
   	  	if j=OBJ_CREATE then
   	  	  if length(object_info[index][OBJ_CODE][j])>0 then
   	  	    setFont( button_object_create, "Arial" , 9 ,Bold)
   	  	  end if
   	  	elsif j=OBJ_DESTORY then
   	  	  if length(object_info[index][OBJ_CODE][j])>0 then
   	  	    setFont( button_object_destroy, "Arial" , 9 ,Bold)
   	  	  end if
   	  	elsif j=OBJ_STEP then
   	  	  if length(object_info[index][OBJ_CODE][j])>0 then
   	  	    setFont( button_object_step, "Arial" , 9 ,Bold)
   	  	  end if
   	  	elsif j=OBJ_KEYBOARD then
   	  	  if length(object_info[index][OBJ_CODE][j])>0 then
   	  	    setFont( button_object_keyboard, "Arial" , 9 ,Bold)
   	  	  end if
   	  	elsif j=OBJ_KEYBOARD_UP then
   	  	  if length(object_info[index][OBJ_CODE][j])>0 then
   	  	    setFont( button_object_keyboard_up, "Arial" , 9 ,Bold)
   	  	  end if
   	  	elsif j=OBJ_KEYBOARD_DOWN then
   	  	  if length(object_info[index][OBJ_CODE][j])>0 then
   	  	    setFont( button_object_keyboard_down, "Arial" , 9 ,Bold)
   	  	  end if
   	  	elsif j=OBJ_DRAW then
   	  	  if length(object_info[index][OBJ_CODE][j])>0 then
   	  	    setFont( button_object_draw, "Arial" , 9 ,Bold)
   	  	  end if
   	  	end if
   	  end for
  else
    add_object()
    item=addTVItem( TreeView1, -1,-1, object_info[length(object_info)][OBJ_NAME] , 3 )
    expandItem ( 3 )
    setIndex( TreeView1,item )
    object_window_index=length(object_info)
    object_window_code=object_info[length(object_info)][OBJ_CODE]
  	setText(textbox_obj_name,object_info[length(object_info)][OBJ_NAME])
  	for i=1 to length(object_info) do--new 31/01/07 fix bug
  		addItem( combox_obj_collision, object_info[i][OBJ_NAME] )
  	end for
  	setIndex(combox_obj_collision,1)
    selected_item=""
  end if
  setText(textbox_obj_sprite_name,selected_item)
end procedure
--======================================SPRITE WINDOW========================================
function sprite_exsist(sequence name)
  for i=1 to length(sprite_info) do
  	 if compare(sprite_info[i][SPR_NAME],name)=0 then
  	 	return i
  	 end if
  end for
return 0
end function

procedure add_sprite()
  sprite_info=append(sprite_info,
  {
  "sprite"&sprint(sprite_number),-- name
  {},-- images
  {},--filenames
  "0",
  "0",
  "0",
  "0",
  0,
  0,
  0,
  0,
  0,
  "0",
  "0"
  }
  )
  sprite_number+=1
  game_maker_save_changes=1
end procedure

procedure delete_sprite()
sequence name
integer temp
    name=getTVSelectedText( TreeView1 )
	temp=deleteItem( TreeView1, getTVIndex(TreeView1) )
	sprite_info=remove_sequence(sprite_info,sprite_exsist(name))
	updata_objects_sprite_name(sprite_window_index,name,2)
    updata_rooms_sprite_name(sprite_window_index,name,2)
    game_maker_save_changes=1
end procedure

procedure save_datafile_sprite(sequence fname)
integer fn
  fn=open(fname,"w")
  print(fn,length(sprite_info))
  puts(fn,'\n')
  print(fn,sprite_number)
  puts(fn,'\n')
  print(fn,SPR_DATA_LENGTH)
  puts(fn,'\n')
  for i=1 to length(sprite_info) do
  	for j=1 to SPR_DATA_LENGTH do
  	   if j=SPR_IMAGES then
  	   elsif j=SPR_FILENAMES then
	     for k=1 to length(sprite_info[i][j]) do
	     	puts(fn,sprite_info[i][j][k]&"#")
	     end for
	     puts(fn,'\n')
	   else
	     if sequence(sprite_info[i][j]) then
	       puts(fn,sprite_info[i][j]&'\n')
	     else
	       print(fn,sprite_info[i][j])
	       puts(fn,'\n')
	     end if
  	   end if
  	end for
  end for
  close(fn)
end procedure

function get_datafile_images_filenames(sequence filenames)
integer pos
sequence fpaths,images
fpaths={}
images={}
pos=1
	for i=1 to length(filenames) do
		if filenames[i]='#' then
	       fpaths=append(fpaths,filenames[pos..i-1])
	       pos=i+1  		
		end if
	end for
	
    for i=1 to length(fpaths) do
    	if file_exsist("c:\\windows\\temp\\"&get_file_fullname_part(fpaths[i]))=1 then
    	  delete_list=append(delete_list, get_file_fullname_part(fpaths[i]) )
    	  images=append(images,  loadBitmapFromFile( "c:\\windows\\temp\\"&get_file_fullname_part(fpaths[i]) ) )--loadBitmapFromFile(fpaths[i])) -- old
        else
          -- very bad error cant find images its not in the zip file
          ?0
    	end if
    end for

	return {fpaths,images}
end function

procedure sprite_window_load()
integer item
atom image
   for i=1 to length(sprite_info) do
      image= -1
      if length(sprite_info[i][SPR_IMAGES])>0 then
      setSize(Buffer,sprite_info[i][SPR_WIDTH],sprite_info[i][SPR_HEIGHT])
      stretchBlt( Buffer,  -- copy to TheWindow
                  0, 0,     -- put at {10,10} in TheWindow
                  16, 16,    -- cause it to be this size
                  sprite_info[i][SPR_IMAGES][1],       -- copy from loaded bitmap
                  0, 0,        -- upper left hand corner is {0,0}
                  sprite_info[i][SPR_WIDTH], sprite_info[i][SPR_HEIGHT],     -- copy a 40x40 pixel portion
                  SRCCOPY )   -- replace destination with image
      color_to_color(16, 16)
      image=copyToTrueColorBitmapFile( Buffer, "c:\\windows\\temp\\temp.bmp", 0, 0, 16, 16 )
      setTransparentColor( 0 )
      image=addDIB ( loadBitmapFromFile("c:\\windows\\temp\\temp.bmp") )
      end if
      item=addTVItem( TreeView1, image,image, sprite_info[i][SPR_NAME] , 1 )
   end for
end procedure

procedure load_datafile_sprite(sequence fname)
integer fn,sprite_length,data_length
sequence temp,sprite
sprite={}
temp={}
  fn=open(fname,"r")
  sprite_length=real(gets(fn))
  sprite_number=real(gets(fn))
  data_length=real(gets(fn))
  for i=1 to sprite_length do
  	for j=1 to data_length do
  	   if j=SPR_NAME then
  	     sprite=append(sprite,getd(fn))
  	   elsif j=SPR_IMAGES then
  	   elsif j=SPR_FILENAMES then
  	     temp=get_datafile_images_filenames(getd(fn))
  	     sprite=append(sprite,temp[1])
  	     sprite=append(sprite,temp[2])
  	   elsif j=SPR_BBOX_LEFT then
  	     sprite=append(sprite,getd(fn))
  	   elsif j=SPR_BBOX_TOP then
  	     sprite=append(sprite,getd(fn))
  	   elsif j=SPR_BBOX_RIGHT then
  	     sprite=append(sprite,getd(fn))
  	   elsif j=SPR_BBOX_BOTTOM then
  	     sprite=append(sprite,getd(fn))
  	   elsif j=SPR_OFFSETX then
  	     sprite=append(sprite,getd(fn))
  	   elsif j=SPR_OFFSETY then
  	     sprite=append(sprite,getd(fn))
  	   else
    	   sprite=append(sprite,real(gets(fn)))
  	   end if
  	end for
  	sprite_info=append(sprite_info,sprite)
  	sprite={}
  end for
  sprite_window_load()
  close(fn)
end procedure

procedure clear_sprite_window()
    sprite_window_index=0
    sprite_window_images={}
    sprite_window_filenames={}
    sprite_window_image_index=0
    sprite_window_image_width=0
    sprite_window_image_height=0
    sprite_window_transprant_color=rgb(255,255,255)
    sprite_window_closed=0
    sprite_window_save_changes=0
  	setText(textbox_spr_name,"")
  	setCheck(select_spr_automatic,1)
  	setCheck(select_spr_fullimage,0)
  	setCheck(select_spr_manual,0)
  	setCheck(select_spr_transprant,1)
  	setText(textbox_spr_number_of_subimages,"0")
  	setText(textbox_spr_width,"0")
  	setText(textbox_spr_height,"0")
  	setText(textbox_spr_show,"0")
  	setText(textbox_spr_left,"0")
  	setText(textbox_spr_right,"0")
  	setText(textbox_spr_top,"0")
  	setText(textbox_spr_bottom,"0")
  	setText(textbox_spr_x,"0")
  	setText(textbox_spr_y,"0")
  	setEnable(textbox_spr_left,0)
  	setEnable(textbox_spr_right,0)
  	setEnable(textbox_spr_top,0)
  	setEnable(textbox_spr_bottom,0)
  	setVisible(button_spr_delete,0)
  	setVisible(button_spr_next,0)
  	setVisible(button_spr_back,0)
  	setVisible(button_spr_add_sub_image,0)
  	setVisible(button_spr_save_sub_image,0)
    setVisible(group_spr_bounding_box,0)
  	setVisible(group_spr_transprant_image,0)
  	setVisible(group_spr_offset,0)
  	setVisible(group_spr_preview,0)
  	setText(label_spr_fname,"")
end procedure

procedure sprite_window_textbox_changed()
  if compare( sprite_info[sprite_window_index][SPR_NAME],getText(textbox_spr_name) )=0 then
  else
    sprite_window_save_changes=1
  end if
  if compare( sprite_info[sprite_window_index][SPR_BBOX_LEFT],getText(textbox_spr_left) )=0 then
  else
    sprite_window_save_changes=1
  end if
  if compare( sprite_info[sprite_window_index][SPR_BBOX_RIGHT],getText(textbox_spr_right) )=0 then
  else
    sprite_window_save_changes=1
  end if
  if compare( sprite_info[sprite_window_index][SPR_BBOX_TOP],getText(textbox_spr_top) )=0 then
  else
    sprite_window_save_changes=1
  end if
  if compare( sprite_info[sprite_window_index][SPR_BBOX_BOTTOM],getText(textbox_spr_bottom) )=0 then
  else
    sprite_window_save_changes=1
  end if
  if compare( sprite_info[sprite_window_index][SPR_OFFSETX],getText(textbox_spr_x) )=0 then
  else
    sprite_window_save_changes=1
  end if
  if compare( sprite_info[sprite_window_index][SPR_OFFSETY],getText(textbox_spr_y) )=0 then
  else
    sprite_window_save_changes=1
  end if
end procedure

procedure close_sprite_window()
sequence old_name
atom image

   setTVText( getTVIndex ( TreeView1), getText(textbox_spr_name))
   repaintFG( Window1 )
   old_name=sprite_info[sprite_window_index][SPR_NAME]
   sprite_info[sprite_window_index][SPR_NAME]=getText(textbox_spr_name)
   sprite_info[sprite_window_index][SPR_FILENAMES]=sprite_window_filenames
   sprite_info[sprite_window_index][SPR_IMAGES]=sprite_window_images
   sprite_info[sprite_window_index][SPR_BBOX_LEFT]=getText(textbox_spr_left)
   sprite_info[sprite_window_index][SPR_BBOX_RIGHT]=getText(textbox_spr_right)
   sprite_info[sprite_window_index][SPR_BBOX_TOP]=getText(textbox_spr_top)
   sprite_info[sprite_window_index][SPR_BBOX_BOTTOM]=getText(textbox_spr_bottom)
   if isChecked(select_spr_automatic)=1 then
     sprite_info[sprite_window_index][SPR_BBOX_MODE]=0
   elsif isChecked(select_spr_fullimage)=1 then
     sprite_info[sprite_window_index][SPR_BBOX_MODE]=1
   elsif isChecked(select_spr_manual)=1 then
     sprite_info[sprite_window_index][SPR_BBOX_MODE]=2
   end if
   sprite_info[sprite_window_index][SPR_WIDTH]=sprite_window_image_width
   sprite_info[sprite_window_index][SPR_HEIGHT]=sprite_window_image_height
   sprite_info[sprite_window_index][SPR_TRANSPRANT]=isChecked(select_spr_transprant)
   sprite_info[sprite_window_index][SPR_TRANSPRANT_COLOR]=sprite_window_transprant_color
   sprite_info[sprite_window_index][SPR_OFFSETX]=getText(textbox_spr_x)
   sprite_info[sprite_window_index][SPR_OFFSETY]=getText(textbox_spr_y)
   updata_objects_sprite_name(sprite_window_index,old_name,1)
   updata_rooms_sprite_name(sprite_window_index,old_name,1)
   game_maker_save_changes=1

   if length(sprite_info[sprite_window_index][SPR_IMAGES])>0 then
      setSize(Buffer,sprite_window_image_width,sprite_window_image_height)
      stretchBlt( Buffer,  -- copy to TheWindow
                  0, 0,     -- put at {10,10} in TheWindow
                  16, 16,    -- cause it to be this size
                  sprite_info[sprite_window_index][SPR_IMAGES][1],       -- copy from loaded bitmap
                  0, 0,        -- upper left hand corner is {0,0}
                  sprite_window_image_width, sprite_window_image_height,     -- copy a 40x40 pixel portion
                  SRCCOPY )   -- replace destination with image
      color_to_color(16, 16)
      image=copyToTrueColorBitmapFile( Buffer, "c:\\windows\\temp\\temp.bmp", 0, 0, 16, 16 )
      setTransparentColor( 0 )
      image=addDIB ( loadBitmapFromFile("c:\\windows\\temp\\temp.bmp") )
   	  setTVImages ( getTVIndex ( TreeView1), image, image )
   else
      setTVImages ( getTVIndex ( TreeView1), 0, 0 )
      --working on need to make a black dib
   end if
end procedure

procedure open_sprite_window(sequence name)
  integer index,item
  sprite_window_transprant_color=rgb(255,255,255)
  clear_sprite_window()
  openWindow(Window2,Modal)
  if length(name)>0 then
    index=sprite_exsist(name)
    sprite_window_index=index
    setText(textbox_spr_name,name)
    sprite_window_filenames=sprite_info[index][SPR_FILENAMES]
    sprite_window_images=sprite_info[index][SPR_IMAGES]
    setText(textbox_spr_left,sprite_info[index][SPR_BBOX_LEFT])
  	setText(textbox_spr_right,sprite_info[index][SPR_BBOX_RIGHT])
  	setText(textbox_spr_top,sprite_info[index][SPR_BBOX_TOP])
  	setText(textbox_spr_bottom,sprite_info[index][SPR_BBOX_BOTTOM])
    if length(sprite_window_images)>0 then
      sprite_window_image_index=1
      setVisible(button_spr_delete,1)
  	  setVisible(button_spr_next,1)
  	  setVisible(button_spr_back,1)
  	  setVisible(button_spr_add_sub_image,1)
  	  setVisible(button_spr_save_sub_image,1)
  	  setVisible(group_spr_bounding_box,1)
  	  setVisible(group_spr_transprant_image,1)
  	  setVisible(group_spr_offset,1)
  	  setVisible(group_spr_preview,1)
    end if
    if sprite_info[index][SPR_BBOX_MODE]=0 then
   	 setCheck(select_spr_automatic,1)
  	 setCheck(select_spr_fullimage,0)
  	 setCheck(select_spr_manual,0)
    elsif sprite_info[index][SPR_BBOX_MODE]=1 then
  	 setCheck(select_spr_automatic,0)
  	 setCheck(select_spr_fullimage,1)
  	 setCheck(select_spr_manual,0)
    elsif sprite_info[index][SPR_BBOX_MODE]=2 then
  	 setCheck(select_spr_automatic,0)
  	 setCheck(select_spr_fullimage,0)
  	 setCheck(select_spr_manual,1)
  	 setEnable(textbox_spr_left,1)
     setEnable(textbox_spr_right,1)
  	 setEnable(textbox_spr_top,1)
  	 setEnable(textbox_spr_bottom,1)
    end if
    sprite_window_image_width=sprite_info[index][SPR_WIDTH]
    sprite_window_image_height=sprite_info[index][SPR_HEIGHT]
    setCheck(select_spr_transprant,sprite_info[index][SPR_TRANSPRANT])
    sprite_window_transprant_color=sprite_info[index][SPR_TRANSPRANT_COLOR]
    setText(textbox_spr_x,sprite_info[index][SPR_OFFSETX])
  	setText(textbox_spr_y,sprite_info[index][SPR_OFFSETY])
  else
    add_sprite()
    item=addTVItem( TreeView1, -1,-1, sprite_info[length(sprite_info)][SPR_NAME] , 1 )
    expandItem ( 1 )
    setIndex( TreeView1,item )
    sprite_window_index=length(sprite_info)
  	setText(textbox_spr_name,sprite_info[length(sprite_info)][SPR_NAME])
  	updata_objects_sprite_name(sprite_window_index,sprite_info[length(sprite_info)][SPR_NAME],3)
  	updata_rooms_sprite_name(sprite_window_index,sprite_info[length(sprite_info)][SPR_NAME],3)
  end if	
end procedure

procedure draw_sprite_window()
  setPenColor( pb_spr_preview, rgb(255,255,255) )
  drawRectangle( pb_spr_preview, 1, 0, 0, 400, 400 )
  setText(textbox_spr_show, sprint(sprite_window_image_index))
  setText(textbox_spr_number_of_subimages,sprint(length(sprite_window_images)))
  setText(textbox_spr_width, sprint(sprite_window_image_width))
  setText(textbox_spr_height,sprint(sprite_window_image_height))
  setPenColor( pb_spr_transprant_color, sprite_window_transprant_color )
  drawRectangle( pb_spr_transprant_color, 1, 0, 0, 400, 400 )
  if length(sprite_window_images)>0 then
    setText(label_spr_fname,get_file_fullname_part(sprite_window_filenames[sprite_window_image_index]))
  	drawBitmap( pb_spr_preview, sprite_window_images[sprite_window_image_index] ,0, 0 )
  end if
  copyBlt ( group_spr_preview, 0, 20,  pb_spr_preview)
  copyBlt ( group_spr_transprant_image, 10, 40,  pb_spr_transprant_color)
end procedure

--=================================================================================

sequence zip_file_names
zip_file_names={"c:\\windows\\temp\\SET.dat",
      "c:\\windows\\temp\\SPR.dat",
      "c:\\windows\\temp\\OBJ.dat",
      "c:\\windows\\temp\\ROOM.dat",
      "c:\\windows\\temp\\SND.dat"}

procedure save_all_to_zip()
       zip_file_names={"c:\\windows\\temp\\SET.dat",
      "c:\\windows\\temp\\SPR.dat",
      "c:\\windows\\temp\\OBJ.dat",
      "c:\\windows\\temp\\ROOM.dat",
      "c:\\windows\\temp\\SND.dat"}
	for i=1 to length(sprite_info) do
		for k=1 to length(sprite_info[i][SPR_FILENAMES]) do
	     	zip_file_names=append(zip_file_names, "c:\\windows\\temp\\"&get_file_fullname_part(sprite_info[i][SPR_FILENAMES][k]) )
	     end for
	end for
	for i=1 to length(sound_info) do
	   if length(sound_info[i][SND_FILENAME])>0 then
	   	 zip_file_names=append(zip_file_names, "c:\\windows\\temp\\"&get_file_fullname_part( sound_info[i][SND_FILENAME] ))
	   end if
	end for
    for i=1 to length(room_info) do
    	if length(room_info[i][ROOM_BACKGROUND_FILENAME])>0 then
    	  zip_file_names=append(zip_file_names, "c:\\windows\\temp\\"&get_file_fullname_part( room_info[i][ROOM_BACKGROUND_FILENAME] ))
    	end if
    end for
end procedure

procedure game_maker_open()
sequence fname
	fname = getOpenFileName( Window1, "", {"GameMaker File","*.ggm"} )
    if length(fname)>0 then
    new_game_maker()
    delete_list=append(delete_list,"SET.dat")
    delete_list=append(delete_list,"OBJ.dat")
    delete_list=append(delete_list,"SPR.dat")
    delete_list=append(delete_list,"ROOM.dat")
    delete_list=append(delete_list,"SND.dat")
    game_maker_save_name=get_file_name_part(fname)
    game_maker_save_path=get_file_path_part(fname)
    unzip_file(game_maker_save_path&game_maker_save_name&".ggm","")
    load_datafile_game_maker("c:\\windows\\temp\\SET.dat")
    setScrollPos (pb_bar ,getScrollPos ( pb_bar)+1)
    doEvents(0)
    load_datafile_sprite("c:\\windows\\temp\\SPR.dat")
    setScrollPos (pb_bar ,getScrollPos ( pb_bar)+1)
    doEvents(0)
    load_datafile_object("c:\\windows\\temp\\OBJ.dat")
    setScrollPos (pb_bar ,getScrollPos ( pb_bar)+1)
    doEvents(0)
    load_datafile_room("c:\\windows\\temp\\ROOM.dat")
    setScrollPos (pb_bar ,getScrollPos ( pb_bar)+1)
    doEvents(0)
    load_datafile_sound("c:\\windows\\temp\\SND.dat")
    setText(Window1,"Gaz Game Maker - "&game_maker_save_name)
    doEvents(0)
    closeWindow(Window9)
    end if
end procedure

procedure game_maker_save_as()
	sequence fname
    fname = getSaveFileName(Window1,"",{"GameMaker File","*.ggm"})
    if length(fname)>0 then
      game_maker_save_changes=0
      game_maker_save_name=get_file_name_part(fname)
      game_maker_save_path=get_file_path_part(fname)
   	  save_datafile_game_maker("c:\\windows\\temp\\SET.dat")
   	  setScrollPos (pb_bar ,getScrollPos ( pb_bar)+1)
      save_datafile_sprite("c:\\windows\\temp\\SPR.dat")
      setScrollPos (pb_bar ,getScrollPos ( pb_bar)+1)
      save_datafile_object("c:\\windows\\temp\\OBJ.dat")
      setScrollPos (pb_bar ,getScrollPos ( pb_bar)+1)
      save_datafile_room("c:\\windows\\temp\\ROOM.dat")
      setScrollPos (pb_bar ,getScrollPos ( pb_bar)+1)
      save_datafile_sound("c:\\windows\\temp\\SND.dat")
      setScrollPos (pb_bar ,getScrollPos ( pb_bar)+1)
      save_all_to_zip()
      zip_file(game_maker_save_path&game_maker_save_name&".ggm",zip_file_names )
      setText(Window1,"Gaz Game Maker - "&game_maker_save_name)
    end if
end procedure

procedure game_maker_save()
  if length(game_maker_save_name)>0 then
    game_maker_save_changes=0
   	save_datafile_game_maker("c:\\windows\\temp\\SET.dat")
    save_datafile_sprite("c:\\windows\\temp\\SPR.dat")
    save_datafile_object("c:\\windows\\temp\\OBJ.dat")
    save_datafile_room("c:\\windows\\temp\\ROOM.dat")
    save_datafile_sound("c:\\windows\\temp\\SND.dat")
    save_all_to_zip()
    zip_file(game_maker_save_path&game_maker_save_name&".ggm",zip_file_names)
  else
    game_maker_save_as()
  end if
end procedure
-- Generated by IDE for Timer 
setTimer ( Window1, Timer1, 100 )
--------------------------------------------------------------------------------
procedure Window1_onClose (integer self, integer event, sequence params)--params is ()
integer response
sequence fname
if game_maker_save_changes=1 then
response = message_box("Do you wish to save changes?",
                       "Game Maker",
                       MB_YESNO)
  if response = IDNO then

  else
    game_maker_save()
  end if
end if
for i=1 to length(delete_list) do
	response=deleteFile("C:\\windows\\TEMP\\"&delete_list[i])	
end for
end procedure
setHandler( Window1, w32HClose, routine_id("Window1_onClose"))
--------------------------------------------------------------------------------
procedure Window1_onOpen (integer self, integer event, sequence params)--params is ()
centerwindow(Window1)
end procedure
setHandler( Window1, w32HOpen, routine_id("Window1_onOpen"))
--------------------------------------------------------------------------------
procedure Window1_onResize (integer self, integer event, sequence params)--params is ( int style, int cx, int cy )
sequence size1,size2
size1 = getCtlSize(CWindow1)
size2 = getCtlSize(Window1)
size2[2]-=90
setCtlPosition( CWindow1, 0, 0)
setCtlSize( CWindow1,  size1[1], size2[2] )
setCtlSize( TreeView1, size1[1]-15, size2[2]-15 )	
end procedure
setHandler( Window1, w32HResize, routine_id("Window1_onResize"))
--------------------------------------------------------------------------------
procedure Window1_onTimer (integer self, integer event, sequence params)--params is ( int timerId)
sequence arg,fname
  killTimer(Window1,Timer1)
  arg=command_line()
  new_game_maker()
  if length(arg)>2 then -- drag on to game maker exe file
    fname=arg[3]
    if length(arg)>3 then-- shell mouse click on game file
      fname=""
      for i=3 to length(arg) do
         if i!=length(arg) then
           fname&=arg[i]&" "
         else
           fname&=arg[i]
         end if
      end for
    end if
    delete_list=append(delete_list,"SET.dat")
    delete_list=append(delete_list,"OBJ.dat")
    delete_list=append(delete_list,"SPR.dat")
    delete_list=append(delete_list,"ROOM.dat")
    delete_list=append(delete_list,"SND.dat")
    game_maker_save_name=get_file_name_part(fname)
    game_maker_save_path=get_file_path_part(fname)
    unzip_file(game_maker_save_path&game_maker_save_name&".ggm","")
    load_datafile_game_maker("c:\\windows\\temp\\SET.dat")
    setScrollPos (pb_bar ,getScrollPos ( pb_bar)+1)
    load_datafile_sprite("c:\\windows\\temp\\SPR.dat")
    setScrollPos (pb_bar ,getScrollPos ( pb_bar)+1)
    load_datafile_object("c:\\windows\\temp\\OBJ.dat")
    setScrollPos (pb_bar ,getScrollPos ( pb_bar)+1)
    load_datafile_room("c:\\windows\\temp\\ROOM.dat")
    setScrollPos (pb_bar ,getScrollPos ( pb_bar)+1)
    load_datafile_sound("c:\\windows\\temp\\SND.dat")
    setScrollPos (pb_bar ,getScrollPos ( pb_bar)+1)
    setText(Window1,"Gaz Game Maker - "&game_maker_save_name)
    closeWindow(Window9)
  end if
end procedure
setHandler( Window1, w32HTimer, routine_id("Window1_onTimer"))
--------------------------------------------------------------------------------
procedure MenuItem_102_onClick (integer self, integer event, sequence params)--params is ()
integer response
sequence fname
if game_maker_save_changes=1 then
response = message_box("game has been change, save changes?",
                       "Game Maker",
                       MB_YESNOCANCEL)
  if response = IDNO then
    new_game_maker()
  elsif response = IDCANCEL then

  else
    game_maker_save()
    new_game_maker()
  end if
else
 new_game_maker()
end if
end procedure
setHandler( MenuItem_102, w32HClick, routine_id("MenuItem_102_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_104_onClick (integer self, integer event, sequence params)--params is ()
sequence fname
integer response
if game_maker_save_changes=1 then
  response = message_box("game has been change, save changes?",
                       "Game Maker",
                       MB_YESNOCANCEL)
  if response = IDNO then
     game_maker_open()
  elsif response = IDCANCEL then
  else
    game_maker_save()
    game_maker_open()
  end if
else
    game_maker_open()
end if
end procedure
setHandler( MenuItem_104, w32HClick, routine_id("MenuItem_104_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_108_onClick (integer self, integer event, sequence params)--params is ()
game_maker_save()
end procedure
setHandler( MenuItem_108, w32HClick, routine_id("MenuItem_108_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_110_onClick (integer self, integer event, sequence params)--params is ()
game_maker_save_as()
end procedure
setHandler( MenuItem_110, w32HClick, routine_id("MenuItem_110_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_111_onClick (integer self, integer event, sequence params)--params is ()
integer response
response = message_box("Do you wish to exit?",
                       "Game Maker",
                       MB_YESNO)
  if response = IDNO then

  else
    closeWindow(Window1)
  end if
end procedure
setHandler( MenuItem_111, w32HClick, routine_id("MenuItem_111_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_add_onClick (integer self, integer event, sequence params)--params is ()
  if equal(getText(self),"Add Sprite") then
  	open_sprite_window("")
    draw_sprite_window()
  elsif equal(getText(self),"Add Sound") then
    open_sound_window("")
  elsif equal(getText(self),"Add Object") then
    open_object_window("")
  elsif equal(getText(self),"Add Room") then
    open_room_window("")
  end if
end procedure
setHandler( MenuItem_add, w32HClick, routine_id("MenuItem_add_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_information_onClick (integer self, integer event, sequence params)--params is ()
  if equal(getText(self),"Sprite Information") then
    open_sprite_window(getTVSelectedText(TreeView1))
    draw_sprite_window()
  elsif equal(getText(self),"Sound Information") then
    open_sound_window(getTVSelectedText(TreeView1))
  elsif equal(getText(self),"Object Information") then
    open_object_window(getTVSelectedText(TreeView1))
  elsif equal(getText(self),"Room Information") then
    open_room_window(getTVSelectedText(TreeView1))
  end if
end procedure
setHandler( MenuItem_information, w32HClick, routine_id("MenuItem_information_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_delete_onClick (integer self, integer event, sequence params)--params is ()
integer response
  if equal(getText(self),"Delete Sprite") then
    response = message_box("Are You Sure Want To Delete "&"" &"?",
                      "Warning",
                       MB_ICONWARNING+MB_YESNO)
    if response = IDNO then
    else
      delete_sprite()
    end if
  elsif equal(getText(self),"Delete Sound") then
    response = message_box("Are You Sure Want To Delete "&"" &"?",
                       "Warning",
                       MB_ICONWARNING+MB_YESNO)
    if response = IDNO then
    else
      delete_sound()
    end if
  elsif equal(getText(self),"Delete Object") then
    response = message_box("Are You Sure Want To Delete "&"" &"?",
                       "Warning",
                       MB_ICONWARNING+MB_YESNO)
    if response = IDNO then
    else
      delete_object()
    end if
  elsif equal(getText(self),"Delete Room") then
    response = message_box("Are You Sure Want To Delete "&"" &"?",
                       "Warning",
                       MB_ICONWARNING+MB_YESNO)
    if response = IDNO then
    else
      delete_room()
    end if
  end if
end procedure
setHandler( MenuItem_delete, w32HClick, routine_id("MenuItem_delete_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_113_onClick (integer self, integer event, sequence params)--params is ()
 open_sprite_window("")
end procedure
setHandler( MenuItem_113, w32HClick, routine_id("MenuItem_113_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_114_onClick (integer self, integer event, sequence params)--params is ()
 open_sound_window("")
end procedure
setHandler( MenuItem_114, w32HClick, routine_id("MenuItem_114_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_115_onClick (integer self, integer event, sequence params)--params is ()
 open_object_window("")
end procedure
setHandler( MenuItem_115, w32HClick, routine_id("MenuItem_115_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_116_onClick (integer self, integer event, sequence params)--params is ()
open_room_window("")
end procedure
setHandler( MenuItem_116, w32HClick, routine_id("MenuItem_116_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_128_onClick (integer self, integer event, sequence params)--params is ()
  openWindow(Window19,Modal)
  setFocus(richedit_help)
  game_maker_save_changes=1
end procedure
setHandler( MenuItem_128, w32HClick, routine_id("MenuItem_128_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_118_onClick (integer self, integer event, sequence params)--params is ()
  openWindow(Window7,Modal)
  game_maker_save_changes=1
end procedure
setHandler( MenuItem_118, w32HClick, routine_id("MenuItem_118_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_120_onClick (integer self, integer event, sequence params)--params is ()
integer temp
  save_datafile_game_maker("c:\\windows\\temp\\SET.dat")
  doEvents(0)
  save_datafile_sprite("c:\\windows\\temp\\SPR.dat")
  doEvents(0)
  save_datafile_object("c:\\windows\\temp\\OBJ.dat")
  doEvents(0)
  save_datafile_room("c:\\windows\\temp\\ROOM.dat")
  doEvents(0)
  save_datafile_sound("c:\\windows\\temp\\SND.dat")
  doEvents(0)
  save_all_to_zip()
  doEvents(0)
  zip_file("c:\\windows\\temp\\temp.ggm",zip_file_names)
  doEvents(0)
  showWindow ( Window1, SW_SHOWMINIMIZED )
  temp=system_exec("runtime.exe", 2)
  doEvents(0)
  showWindow ( Window1, SW_NORMAL )
end procedure
setHandler( MenuItem_120, w32HClick, routine_id("MenuItem_120_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_121_onClick (integer self, integer event, sequence params)--params is ()
integer exit_code
sequence fname,files
  if registered=1 then
  fname = getSaveFileName(Window1,"",{"Exe File","*.exe"})
  if length(fname)>0 then
  files=dir(working_d&"\\bind")
  for i=3 to length(files) do
  	exit_code=copyFile(working_d&"\\bind\\"&files[i][1], "c:\\windows\\temp\\"&files[i][1],0)
  end for
  save_datafile_game_maker("c:\\windows\\temp\\SET.dat")
  save_datafile_sprite("c:\\windows\\temp\\SPR.dat")
  save_datafile_object("c:\\windows\\temp\\OBJ.dat")
  save_datafile_room("c:\\windows\\temp\\ROOM.dat")
  save_datafile_sound("c:\\windows\\temp\\SND.dat")
  save_all_to_zip()
  zip_file("c:\\windows\\temp\\temp.ggm",zip_file_names)
  file_to_sequence("c:\\windows\\temp\\temp.ggm","c:\\windows\\temp\\game.ew")
  showWindow ( Window1, SW_SHOWMINIMIZED )
  exit_code=system_exec("c:\\windows\\temp\\bind.exe -w32 c:\\windows\\temp\\runtime.exw -icon c:\\windows\\temp\\game.ico",1)
  exit_code=copyFile("c:\\windows\\temp\\runtime.exe", get_file_path_part(fname)&get_file_name_part(fname)&".exe",0)
  showWindow ( Window1, SW_NORMAL )
  show_message("Done building exe file "&get_file_name_part(fname)&" ")
  end if
  else
  openWindow(Window10,Modal)
  end if
end procedure
setHandler( MenuItem_121, w32HClick, routine_id("MenuItem_121_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_106_onClick (integer self, integer event, sequence params)--params is ()
integer temp
   temp= shellExecuteEx( "open",
    -- with the program to call:
    working_d&"help\\help.htm",
    -- the parameter to pass to application to run:
     "",
    -- in this directory:
    "",
    -- and last, the 'show' parameter:
    SW_SHOW, 0 )
end procedure
setHandler( MenuItem_106, w32HClick, routine_id("MenuItem_106_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_124_onClick (integer self, integer event, sequence params)--params is ()
integer temp
   temp= shellExecuteEx( "open",
    -- with the program to call:
    working_d&"help\\gaz game maker programming language help.htm",
    -- the parameter to pass to application to run:
     "",
    -- in this directory:
    "",
    -- and last, the 'show' parameter:
    SW_SHOW, 0 )
end procedure
setHandler( MenuItem_124, w32HClick, routine_id("MenuItem_124_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_123_onClick (integer self, integer event, sequence params)--params is ()
  openWindow(Window10,Modal)
end procedure
setHandler( MenuItem_123, w32HClick, routine_id("MenuItem_123_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_107_onClick (integer self, integer event, sequence params)--params is ()
openWindow(Window8,Modal)
end procedure
setHandler( MenuItem_107, w32HClick, routine_id("MenuItem_107_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_102_onClick (integer self, integer event, sequence params)--params is ()
  open_sprite_window(getTVSelectedText(TreeView1))
  draw_sprite_window()
end procedure
setHandler( PopupItem_102, w32HClick, routine_id("PopupItem_102_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_103_onClick (integer self, integer event, sequence params)--params is ()
integer response
response = message_box("Are You Sure Want To Delete "&"" &"?",
                       "Warning",
                       MB_ICONWARNING+MB_YESNO)
  if response = IDNO then
  else
    delete_sprite()
  end if
end procedure
setHandler( PopupItem_103, w32HClick, routine_id("PopupItem_103_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_103_onMouse (integer self, integer event, sequence params)--params is ( int event, int x, int y, int shift, int wheelmove )
integer temp,response
response = message_box("Are You Sure Want To Delete "&"" &"?",
                       "Warning",
                       MB_ICONWARNING+MB_YESNO)
  if response = IDNO then
  else
    delete_sprite()
  end if
end procedure
setHandler( PopupItem_103, w32HMouse, routine_id("PopupItem_103_onMouse"))
--------------------------------------------------------------------------------
procedure PopupItem_105_onClick (integer self, integer event, sequence params)--params is ()
  open_sprite_window("")
  draw_sprite_window()
end procedure
setHandler( PopupItem_105, w32HClick, routine_id("PopupItem_105_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_107_onClick (integer self, integer event, sequence params)--params is ()
    open_object_window(getTVSelectedText(TreeView1))
end procedure
setHandler( PopupItem_107, w32HClick, routine_id("PopupItem_107_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_108_onClick (integer self, integer event, sequence params)--params is ()
integer response
response = message_box("Are You Sure Want To Delete "&"" &"?",
                       "Warning",
                       MB_ICONWARNING+MB_YESNO)
  if response = IDNO then
  else
    delete_object()
  end if
end procedure
setHandler( PopupItem_108, w32HClick, routine_id("PopupItem_108_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_110_onClick (integer self, integer event, sequence params)--params is ()
  open_object_window("")
end procedure
setHandler( PopupItem_110, w32HClick, routine_id("PopupItem_110_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_112_onClick (integer self, integer event, sequence params)--params is ()
  open_room_window(getTVSelectedText(TreeView1))
end procedure
setHandler( PopupItem_112, w32HClick, routine_id("PopupItem_112_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_113_onClick (integer self, integer event, sequence params)--params is ()
integer response
response = message_box("Are You Sure Want To Delete "&"" &"?",
                       "Warning",
                       MB_ICONWARNING+MB_YESNO)
  if response = IDNO then
  else
    delete_room()
  end if
end procedure
setHandler( PopupItem_113, w32HClick, routine_id("PopupItem_113_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_114_onClick (integer self, integer event, sequence params)--params is ()
   open_room_window("")
end procedure
setHandler( PopupItem_114, w32HClick, routine_id("PopupItem_114_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_116_onClick (integer self, integer event, sequence params)--params is ()
  open_sound_window(getTVSelectedText(TreeView1))
end procedure
setHandler( PopupItem_116, w32HClick, routine_id("PopupItem_116_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_117_onClick (integer self, integer event, sequence params)--params is ()
integer response
response = message_box("Are You Sure Want To Delete "&"" &"?",
                       "Warning",
                       MB_ICONWARNING+MB_YESNO)
  if response = IDNO then
  else
    delete_sound()
  end if
end procedure
setHandler( PopupItem_117, w32HClick, routine_id("PopupItem_117_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_119_onClick (integer self, integer event, sequence params)--params is ()
  open_sound_window("")
end procedure
setHandler( PopupItem_119, w32HClick, routine_id("PopupItem_119_onClick"))
--------------------------------------------------------------------------------
procedure CWindow1_onResize (integer self, integer event, sequence params)--params is ( int style, int cx, int cy )
sequence size1,size2
size1 = getCtlSize(CWindow1)
size2 = getCtlSize(Window1)
size2[2]-=90
setCtlPosition( CWindow1, 0, 0)
if size1[1]<150 then
    set_limit_size(gaz,size2[2])
    setCtlSize( CWindow1,  150, size2[2] )
    setCtlSize( TreeView1, 135, size2[2]-15 )
else
	set_limit_size(gaz,size2[2])
	setCtlSize( CWindow1,  size1[1], size2[2] )
	setCtlSize( TreeView1, size1[1]-15, size2[2]-15 )	
end if
end procedure
setHandler( CWindow1, w32HResize, routine_id("CWindow1_onResize"))

--------------------------------------------------------------------------------
procedure PushButton198_onClick (integer self, integer event, sequence params)--params is ()
integer response
sequence fname
setEnable(self,0)
if game_maker_save_changes=1 then
response = message_box("game has been change, save changes?",
                       "Game Maker",
                       MB_YESNOCANCEL)
  if response = IDNO then
    new_game_maker()
  elsif response = IDCANCEL then

  else
    game_maker_save()
    new_game_maker()
  end if
else
 new_game_maker()
end if
setEnable(self,1)
repaintWindow(Window1)
end procedure
setHandler( PushButton198, w32HClick, routine_id("PushButton198_onClick"))
--------------------------------------------------------------------------------
procedure PushButton200_onClick (integer self, integer event, sequence params)--params is ()
sequence fname
integer response
setEnable(self,0)
setVisible(self,0)
if game_maker_save_changes=1 then
  response = message_box("game has been change, save changes?",
                       "Game Maker",
                       MB_YESNOCANCEL)
  if response = IDNO then
     game_maker_open()
  elsif response = IDCANCEL then
  else
    game_maker_save()
    game_maker_open()
  end if
else
    game_maker_open()
end if
setEnable(self,1)
setVisible(self,1)
repaintWindow(Window1)
end procedure
setHandler( PushButton200, w32HClick, routine_id("PushButton200_onClick"))
--------------------------------------------------------------------------------
procedure PushButton201_onClick (integer self, integer event, sequence params)--params is ()
  setEnable(self,0)
  game_maker_save()
  setEnable(self,1)
  repaintWindow(Window1)
end procedure
setHandler( PushButton201, w32HClick, routine_id("PushButton201_onClick"))
--------------------------------------------------------------------------------
procedure PushButton203_onClick (integer self, integer event, sequence params)--params is ()
  setEnable(self,0)
  game_maker_save_as()
  setEnable(self,1)
  repaintWindow(Window1)
end procedure
setHandler( PushButton203, w32HClick, routine_id("PushButton203_onClick"))
--------------------------------------------------------------------------------
procedure PushButton5_onClick (integer self, integer event, sequence params)--params is ()
  open_sprite_window("")
end procedure
setHandler( PushButton5, w32HClick, routine_id("PushButton5_onClick"))
--------------------------------------------------------------------------------
procedure PushButton189_onClick (integer self, integer event, sequence params)--params is ()
  open_sound_window("")
end procedure
setHandler( PushButton189, w32HClick, routine_id("PushButton189_onClick"))
--------------------------------------------------------------------------------
procedure PushButton106_onClick (integer self, integer event, sequence params)--params is ()
  open_object_window("")
end procedure
setHandler( PushButton106, w32HClick, routine_id("PushButton106_onClick"))
--------------------------------------------------------------------------------
procedure PushButton153_onClick (integer self, integer event, sequence params)--params is ()
  open_room_window("")
end procedure
setHandler( PushButton153, w32HClick, routine_id("PushButton153_onClick"))
--------------------------------------------------------------------------------
procedure PushButton549_onClick (integer self, integer event, sequence params)--params is ()
  openWindow(Window19,Modal)
  setFocus(richedit_help)
  game_maker_save_changes=1
end procedure
setHandler( PushButton549, w32HClick, routine_id("PushButton549_onClick"))
--------------------------------------------------------------------------------
procedure PushButton215_onClick (integer self, integer event, sequence params)--params is ()
  openWindow(Window7,Modal)
  game_maker_save_changes=1
end procedure
setHandler( PushButton215, w32HClick, routine_id("PushButton215_onClick"))
--------------------------------------------------------------------------------
procedure PushButton209_onClick (integer self, integer event, sequence params)--params is ()
integer temp
  save_datafile_game_maker("c:\\windows\\temp\\SET.dat")
  doEvents(0)
  save_datafile_sprite("c:\\windows\\temp\\SPR.dat")
  doEvents(0)
  save_datafile_object("c:\\windows\\temp\\OBJ.dat")
  doEvents(0)
  save_datafile_room("c:\\windows\\temp\\ROOM.dat")
  doEvents(0)
  save_datafile_sound("c:\\windows\\temp\\SND.dat")
  doEvents(0)
  save_all_to_zip()
  doEvents(0)
  zip_file("c:\\windows\\temp\\temp.ggm",zip_file_names)
  doEvents(0)
  showWindow ( Window1, SW_SHOWMINIMIZED )
  temp=system_exec("runtime.exe", 2)
  doEvents(0)
  showWindow ( Window1, SW_NORMAL )
end procedure
setHandler( PushButton209, w32HClick, routine_id("PushButton209_onClick"))
--------------------------------------------------------------------------------
procedure PushButton240_onClick (integer self, integer event, sequence params)--params is ()
integer exit_code
sequence fname,files
  if registered=1 then
  fname = getSaveFileName(Window1,"",{"Exe File","*.exe"})
  if length(fname)>0 then
  files=dir(working_d&"\\bind")
  for i=3 to length(files) do
  	exit_code=copyFile(working_d&"\\bind\\"&files[i][1], "c:\\windows\\temp\\"&files[i][1],0)
  end for
  save_datafile_game_maker("c:\\windows\\temp\\SET.dat")
  save_datafile_sprite("c:\\windows\\temp\\SPR.dat")
  save_datafile_object("c:\\windows\\temp\\OBJ.dat")
  save_datafile_room("c:\\windows\\temp\\ROOM.dat")
  save_datafile_sound("c:\\windows\\temp\\SND.dat")
  save_all_to_zip()
  zip_file("c:\\windows\\temp\\temp.ggm",zip_file_names)
  file_to_sequence("c:\\windows\\temp\\temp.ggm","c:\\windows\\temp\\game.ew")
  showWindow ( Window1, SW_SHOWMINIMIZED )
  exit_code=system_exec("c:\\windows\\temp\\bind.exe -w32 c:\\windows\\temp\\runtime.exw -icon c:\\windows\\temp\\game.ico",1)
  exit_code=copyFile("c:\\windows\\temp\\runtime.exe", get_file_path_part(fname)&get_file_name_part(fname)&".exe",0)
  showWindow ( Window1, SW_NORMAL )
  show_message("Done building exe file "&get_file_name_part(fname)&" ")
  end if
  else
  openWindow(Window10,Modal)
  end if
end procedure
setHandler( PushButton240, w32HClick, routine_id("PushButton240_onClick"))
--------------------------------------------------------------------------------
procedure PushButton233_onClick (integer self, integer event, sequence params)--params is ()
  openWindow(Window8,Modal)
end procedure
setHandler( PushButton233, w32HClick, routine_id("PushButton233_onClick"))
--------------------------------------------------------------------------------
procedure TreeView1_onChange (integer self, integer event, sequence params)--params is ()
  -- add new bit for the edit menu
  -- create right hand menu for items inside the groups
  if getTVParent(getTVIndex(TreeView1))=1 then
    setText(MenuItem_information,"Sprite Information")
    setText(MenuItem_delete,"Delete Sprite")
    setText(MenuItem_add,"Add")
    setEnable(MenuItem_add,0)
  elsif getTVParent(getTVIndex(TreeView1))=2 then
    setText(MenuItem_information,"Sound Information")
    setText(MenuItem_delete,"Delete Sound")
    setText(MenuItem_add,"Add")
    setEnable(MenuItem_add,0)
  elsif getTVParent(getTVIndex(TreeView1))=3 then
    setText(MenuItem_information,"Object Information")
    setText(MenuItem_delete,"Delete Object")
    setText(MenuItem_add,"Add")
    setEnable(MenuItem_add,0)
  elsif getTVParent(getTVIndex(TreeView1))=4 then
    setText(MenuItem_information,"Room Information")
    setText(MenuItem_delete,"Delete Room")
    setText(MenuItem_add,"Add")
    setEnable(MenuItem_add,0)
  end if
  -- create right hand menu for the groups
  if getTVIndex(TreeView1)=1 then
    setText(MenuItem_add,"Add Sprite")
    setText(MenuItem_information,"Information")
    setText(MenuItem_delete,"Delete")
    setEnable(MenuItem_information,0)
    setEnable(MenuItem_delete,0)
  elsif getTVIndex(TreeView1)=2 then
    setText(MenuItem_add,"Add Sound")
    setText(MenuItem_information,"Information")
    setText(MenuItem_delete,"Delete")
    setEnable(MenuItem_information,0)
    setEnable(MenuItem_delete,0)
  elsif getTVIndex(TreeView1)=3 then
    setText(MenuItem_add,"Add Object")
    setText(MenuItem_information,"Information")
    setText(MenuItem_delete,"Delete")
    setEnable(MenuItem_information,0)
    setEnable(MenuItem_delete,0)
  elsif getTVIndex(TreeView1)=4 then
    setText(MenuItem_add,"Add Room")
    setText(MenuItem_information,"Information")
    setText(MenuItem_delete,"Delete")
    setEnable(MenuItem_information,0)
    setEnable(MenuItem_delete,0)
  elsif getTVIndex(TreeView1)=5 then
    setText(MenuItem_add,"Add")
    setText(MenuItem_information,"Information")
    setText(MenuItem_delete,"Delete")
    setEnable(MenuItem_add,0)
    setEnable(MenuItem_information,0)
    setEnable(MenuItem_delete,0)
  elsif getTVIndex(TreeView1)=6 then
    setText(MenuItem_add,"Add")
    setText(MenuItem_information,"Information")
    setText(MenuItem_delete,"Delete")
    setEnable(MenuItem_add,0)
    setEnable(MenuItem_information,0)
    setEnable(MenuItem_delete,0)
  end if
end procedure
setHandler( TreeView1, w32HChange, routine_id("TreeView1_onChange"))
--------------------------------------------------------------------------------
procedure TreeView1_onMouse (integer self, integer event, sequence params)--params is ( int event, int x, int y, int shift, int wheelmove )
-- it takes three click insted of two clicks to open windows need to fix this

if params[1]=LeftUp then
  newclicktime=time()
  temp_index=hitTestTV ( TreeView1 )
end if

if params[1]=LeftUp and (newclicktime - clicktime) < .50 and item_index=temp_index then
  if getTVParent(getTVIndex(TreeView1))=1 then
    open_sprite_window(getTVSelectedText(TreeView1))
    draw_sprite_window()
  elsif getTVParent(getTVIndex(TreeView1))=3 then
    open_object_window(getTVSelectedText(TreeView1))
  elsif getTVParent(getTVIndex(TreeView1))=4 then
    open_room_window(getTVSelectedText(TreeView1))
  elsif getTVParent(getTVIndex(TreeView1))=2 then
    open_sound_window(getTVSelectedText(TreeView1))
  end if
  if getTVIndex(TreeView1)=5 then
    openWindow(Window19,Modal)
    setFocus(richedit_help)
    game_maker_save_changes=1
  elsif getTVIndex(TreeView1)=6 then
    openWindow(Window7,Modal)
    game_maker_save_changes=1
  end if
end if

if hitTestTV ( TreeView1 )>0 and params[1]=RightDown then
  -- set the selete item in treeview when right mouse button is pressed
  setIndex( TreeView1, hitTestTV ( TreeView1 ))
  item_index=hitTestTV ( TreeView1 )
end if

if hitTestTV ( TreeView1 )>0 and params[1]=RightUp then
  -- create right hand menu for items inside the groups
  if getTVParent(getTVIndex(TreeView1))=1 then
    popup({Popup_1,TreeView1},params[2]-5,params[3]+40)
  elsif getTVParent(getTVIndex(TreeView1))=3 then
    popup({Popup_3,TreeView1},params[2]-5,params[3]+40)
  elsif getTVParent(getTVIndex(TreeView1))=4 then
    popup({Popup_5,TreeView1},params[2]-5,params[3]+40)
  elsif getTVParent(getTVIndex(TreeView1))=2 then
    popup({Popup_7,TreeView1},params[2]-5,params[3]+40)
  end if
  -- create right hand menu for the groups
  if getTVIndex(TreeView1)=1 then
    popup({Popup_2,TreeView1},params[2]-5,params[3]+40)
  elsif getTVIndex(TreeView1)=3 then
    popup({Popup_4,TreeView1},params[2]-5,params[3]+40)
  elsif getTVIndex(TreeView1)=4 then
    popup({Popup_6,TreeView1},params[2]-5,params[3]+40)
  elsif getTVIndex(TreeView1)=2 then
    popup({Popup_8,TreeView1},params[2]-5,params[3]+40)
  end if
end if

if params[1]=LeftUp and temp_index!=0 then
  clicktime=newclicktime
  item_index=hitTestTV ( TreeView1 )
end if

end procedure
setHandler( TreeView1, w32HMouse, routine_id("TreeView1_onMouse"))
setBuddy( UpDown473, EditText69 )
--------------------------------------------------------------------------------
procedure Window2_onClose (integer self, integer event, sequence params)--params is ()
integer response
   sprite_window_textbox_changed()
if sprite_window_save_changes=1 then
  if sprite_window_closed=1 then
    close_sprite_window()
  else
    response = message_box("Save The Changes to "&getText(textbox_spr_name)&"?",
                       "Warning",
                       MB_ICONWARNING+MB_YESNO)
    if response = IDYES then
      close_sprite_window()
    else

    end if
  end if
end if
setFocus(Window1)
end procedure
setHandler( Window2, w32HClose, routine_id("Window2_onClose"))
--------------------------------------------------------------------------------
procedure Window2_onOpen (integer self, integer event, sequence params)--params is ()
  centerwindow(self)
end procedure
setHandler( Window2, w32HOpen, routine_id("Window2_onOpen"))
--------------------------------------------------------------------------------
procedure Window2_onPaint (integer self, integer event, sequence params)--params is ( int x1, int y1, int x2, int y2 )
  draw_sprite_window()
end procedure
setHandler( Window2, w32HPaint, routine_id("Window2_onPaint"))
--------------------------------------------------------------------------------
procedure select_spr_automatic_onClick (integer self, integer event, sequence params)--params is ()
    setEnable(textbox_spr_left,0)
  	setEnable(textbox_spr_right,0)
  	setEnable(textbox_spr_top,0)
  	setEnable(textbox_spr_bottom,0)
  	setText(textbox_spr_left,"0")
  	setText(textbox_spr_right,"0")
  	setText(textbox_spr_top,"0")
  	setText(textbox_spr_bottom,"0")
  	sprite_window_save_changes=1
end procedure
setHandler( select_spr_automatic, w32HClick, routine_id("select_spr_automatic_onClick"))
--------------------------------------------------------------------------------
procedure select_spr_fullimage_onClick (integer self, integer event, sequence params)--params is ()
    setEnable(textbox_spr_left,0)
  	setEnable(textbox_spr_right,0)
  	setEnable(textbox_spr_top,0)
  	setEnable(textbox_spr_bottom,0)
  	setText(textbox_spr_left,"0")
  	setText(textbox_spr_right,"0")
  	setText(textbox_spr_top,"0")
  	setText(textbox_spr_bottom,"0")
  	sprite_window_save_changes=1
end procedure
setHandler( select_spr_fullimage, w32HClick, routine_id("select_spr_fullimage_onClick"))
--------------------------------------------------------------------------------
procedure select_spr_manual_onClick (integer self, integer event, sequence params)--params is ()
    setEnable(textbox_spr_left,1)
  	setEnable(textbox_spr_right,1)
  	setEnable(textbox_spr_top,1)
  	setEnable(textbox_spr_bottom,1)
  	sprite_window_save_changes=1
end procedure
setHandler( select_spr_manual, w32HClick, routine_id("select_spr_manual_onClick"))
--------------------------------------------------------------------------------
procedure button_spr_back_onClick (integer self, integer event, sequence params)--params is ()

  if sprite_window_image_index>1 then
	sprite_window_image_index-=1
	draw_sprite_window()
  end if

end procedure
setHandler( button_spr_back, w32HClick, routine_id("button_spr_back_onClick"))
--------------------------------------------------------------------------------
procedure button_spr_next_onClick (integer self, integer event, sequence params)--params is ()
  if sprite_window_image_index<length(sprite_window_images) then
	sprite_window_image_index+=1
	draw_sprite_window()
  end if
end procedure
setHandler( button_spr_next, w32HClick, routine_id("button_spr_next_onClick"))
--------------------------------------------------------------------------------
procedure PushButton8_onClick (integer self, integer event, sequence params)--params is ()
sequence fname,size
integer cop1
  fname = getOpenFileName( Window2, "", {"Bmp Files","*.bmp"} )
  if length(fname)>0 then
     sprite_window_save_changes=1
     sprite_window_images={loadBitmapFromFile( fname )}
     sprite_window_filenames={fname}
     size=getExtent( sprite_window_images[1] )
     sprite_window_image_width=size[1]
     sprite_window_image_height=size[2]
     sprite_window_image_index=1
     setVisible(button_spr_delete,1)
  	 setVisible(button_spr_next,1)
  	 setVisible(button_spr_back,1)
  	 setVisible(button_spr_add_sub_image,1)
  	 setVisible(button_spr_save_sub_image,1)
  	 setVisible(group_spr_bounding_box,1)
  	 setVisible(group_spr_transprant_image,1)
     setVisible(group_spr_offset,1)
  	 setVisible(group_spr_preview,1)
     draw_sprite_window()
     cop1=copyFile(fname, "c:\\windows\\temp\\"&get_file_fullname_part(fname),0)
     delete_list=append(delete_list,get_file_fullname_part(fname))
  end if
end procedure
setHandler( PushButton8, w32HClick, routine_id("PushButton8_onClick"))
--------------------------------------------------------------------------------
procedure select_spr_transprant_onClick (integer self, integer event, sequence params)--params is ()
  sprite_window_save_changes=1
end procedure
setHandler( select_spr_transprant, w32HClick, routine_id("select_spr_transprant_onClick"))
--------------------------------------------------------------------------------
procedure pb_spr_transprant_color_onClick (integer self, integer event, sequence params)--params is ()
  if isChecked(select_spr_transprant) then
    sprite_window_save_changes=1
  	sprite_window_transprant_color=getColorDialog( Window2, sprite_window_transprant_color )
  	draw_sprite_window()
  end if
end procedure
setHandler( pb_spr_transprant_color, w32HClick, routine_id("pb_spr_transprant_color_onClick"))
--------------------------------------------------------------------------------
procedure PushButton440_onClick (integer self, integer event, sequence params)--params is ()
sequence dib
  if length(sprite_window_filenames)>0 then
    killDib(images[1])
    images={}
    for i=1 to length(sprite_window_filenames) do
  	  dib= loadDib("c:\\windows\\temp\\"&get_file_fullname_part(sprite_window_filenames[i]))
  	  images=append(images,dib)
    end for
    select_image=1
    image_width=dib[DibWidth]
    image_height=dib[DibHeight]
  end if
  openWindow(Window11,Modal)
end procedure
setHandler( PushButton440, w32HClick, routine_id("PushButton440_onClick"))
--------------------------------------------------------------------------------
procedure PushButton7_onClick (integer self, integer event, sequence params)--params is ()
  sprite_window_closed=1
  closeWindow(Window2)
end procedure
setHandler( PushButton7, w32HClick, routine_id("PushButton7_onClick"))
--------------------------------------------------------------------------------
procedure button_spr_delete_onClick (integer self, integer event, sequence params)--params is ()
  if length(sprite_window_images)=1 then
    sprite_window_save_changes=1
    sprite_window_images={}
    sprite_window_image_index=0
    sprite_window_image_width=0
    sprite_window_image_height=0
    sprite_window_filenames={}
    setVisible(button_spr_delete,0)
  	setVisible(button_spr_next,0)
  	setVisible(button_spr_back,0)
  	setVisible(button_spr_add_sub_image,0)
  	setVisible(group_spr_bounding_box,0)
  	setVisible(group_spr_transprant_image,0)
  	setVisible(group_spr_offset,0)
  	setVisible(group_spr_preview,0)
  	setText(label_spr_fname,"")
    draw_sprite_window()
  else
    sprite_window_save_changes=1
    sprite_window_images=remove_sequence(sprite_window_images,sprite_window_image_index)
    sprite_window_filenames=remove_sequence(sprite_window_filenames,sprite_window_image_index)
    sprite_window_image_index-=1
    if sprite_window_image_index<1 then
      sprite_window_image_index=1
    end if
    draw_sprite_window()
  end if
end procedure
setHandler( button_spr_delete, w32HClick, routine_id("button_spr_delete_onClick"))
--------------------------------------------------------------------------------
procedure button_spr_add_sub_image_onClick (integer self, integer event, sequence params)--params is ()
sequence fname,size
atom temp_image
integer cop1
  fname = getOpenFileName( Window2, "", {"Bmp Files","*.bmp"} )
  if length(fname)>0 then
     sprite_window_save_changes=1
     temp_image=loadBitmapFromFile( fname )
     size=getExtent( temp_image )
     if size[1]=sprite_window_image_width and size[2]=sprite_window_image_height then
     	sprite_window_images=append(sprite_window_images,temp_image)
     	sprite_window_filenames=append(sprite_window_filenames,fname)
     	sprite_window_image_index=length(sprite_window_images)
     	draw_sprite_window()
     	cop1=copyFile(fname, "c:\\windows\\temp\\"&get_file_fullname_part(fname),0)
     	delete_list=append(delete_list,get_file_fullname_part(fname))
     end if
  end if
end procedure
setHandler( button_spr_add_sub_image, w32HClick, routine_id("button_spr_add_sub_image_onClick"))
--------------------------------------------------------------------------------
procedure button_spr_save_sub_image_onClick (integer self, integer event, sequence params)--params is ()
sequence fname
integer temp
    fname = getSaveFileName(Window2,"",{"Bitmap File","*.bmp"})
    if length(fname)>0 then
        setSize(Buffer,sprite_info[sprite_window_index][SPR_WIDTH],sprite_info[sprite_window_index][SPR_HEIGHT])
        drawBitmap( Buffer,sprite_info[sprite_window_index][SPR_IMAGES][sprite_window_image_index] , 0, 0 )
        if find(".bmp",fname)=0 then
          fname&=".bmp"	
        end if
    	temp=copyToTrueColorBitmapFile( Buffer, fname, 0, 0, sprite_info[sprite_window_index][SPR_WIDTH]-1, sprite_info[sprite_window_index][SPR_HEIGHT]-1 )
    end if
end procedure
setHandler( button_spr_save_sub_image, w32HClick, routine_id("button_spr_save_sub_image_onClick"))
--------------------------------------------------------------------------------
procedure Window3_onClose (integer self, integer event, sequence params)--params is ()
integer response
if object_window_closed=1 then
  close_object_window()
else
response = message_box("Save The Changes to "&getText(textbox_obj_name)&"?",
                       "Warning",
                       MB_ICONWARNING+MB_YESNO)
  if response = IDYES then
    close_object_window()
  else

  end if
end if
setFocus(Window1)
end procedure
setHandler( Window3, w32HClose, routine_id("Window3_onClose"))
--------------------------------------------------------------------------------
procedure Window3_onOpen (integer self, integer event, sequence params)--params is ()
  setTimer(Window3,Timer3,100)
  centerwindow(self)
end procedure
setHandler( Window3, w32HOpen, routine_id("Window3_onOpen"))
--------------------------------------------------------------------------------
procedure Window3_onPaint (integer self, integer event, sequence params)--params is ( int x1, int y1, int x2, int y2 )
  draw_sprite_preview()
end procedure
setHandler( Window3, w32HPaint, routine_id("Window3_onPaint"))
--------------------------------------------------------------------------------
procedure Window3_onResize (integer self, integer event, sequence params)--params is ( int style, int cx, int cy )
  draw_sprite_preview()
end procedure
setHandler( Window3, w32HResize, routine_id("Window3_onResize"))
--------------------------------------------------------------------------------
procedure Window3_onTimer (integer self, integer event, sequence params)--params is ( int timerId)
  killTimer(Window3,Timer3)
  draw_sprite_preview()
end procedure
setHandler( Window3, w32HTimer, routine_id("Window3_onTimer"))
--------------------------------------------------------------------------------
procedure button_object_create_onClick (integer self, integer event, sequence params)--params is ()
  open_object_window_code(OBJ_CREATE)
end procedure
setHandler( button_object_create, w32HClick, routine_id("button_object_create_onClick"))
--------------------------------------------------------------------------------
procedure button_obj_sprite_select_onClick (integer self, integer event, sequence params)--params is ()
 popup({popup_menu,button_obj_sprite_select},1,-30)
end procedure
setHandler( button_obj_sprite_select, w32HClick, routine_id("button_obj_sprite_select_onClick"))
--------------------------------------------------------------------------------
procedure button_object_destroy_onClick (integer self, integer event, sequence params)--params is ()
open_object_window_code(OBJ_DESTORY)
end procedure
setHandler( button_object_destroy, w32HClick, routine_id("button_object_destroy_onClick"))
--------------------------------------------------------------------------------
procedure button_object_step_onClick (integer self, integer event, sequence params)--params is ()
open_object_window_code(OBJ_STEP)
end procedure
setHandler( button_object_step, w32HClick, routine_id("button_object_step_onClick"))
--------------------------------------------------------------------------------
procedure button_object_keyboard_onClick (integer self, integer event, sequence params)--params is ()
open_object_window_code(OBJ_KEYBOARD)
end procedure
setHandler( button_object_keyboard, w32HClick, routine_id("button_object_keyboard_onClick"))
--------------------------------------------------------------------------------
procedure button_object_keyboard_up_onClick (integer self, integer event, sequence params)--params is ()
open_object_window_code(OBJ_KEYBOARD_UP)
end procedure
setHandler( button_object_keyboard_up, w32HClick, routine_id("button_object_keyboard_up_onClick"))
--------------------------------------------------------------------------------
procedure button_object_keyboard_down_onClick (integer self, integer event, sequence params)--params is ()
open_object_window_code(OBJ_KEYBOARD_DOWN)
end procedure
setHandler( button_object_keyboard_down, w32HClick, routine_id("button_object_keyboard_down_onClick"))
--------------------------------------------------------------------------------
procedure button_object_collision_onClick (integer self, integer event, sequence params)--params is ()
open_object_window_code(OBJ_COLLISION)
end procedure
setHandler( button_object_collision, w32HClick, routine_id("button_object_collision_onClick"))
--------------------------------------------------------------------------------
procedure PushButton91_onClick (integer self, integer event, sequence params)--params is ()
  object_window_closed=1
  closeWindow(Window3)
end procedure
setHandler( PushButton91, w32HClick, routine_id("PushButton91_onClick"))
--------------------------------------------------------------------------------
procedure button_object_draw_onClick (integer self, integer event, sequence params)--params is ()
open_object_window_code(OBJ_DRAW)
end procedure
setHandler( button_object_draw, w32HClick, routine_id("button_object_draw_onClick"))
--------------------------------------------------------------------------------
procedure RE_w32HMouse(integer self, integer event, sequence params )
    if params[1] = RightDown then
        popup( Popup_401, params[2], params[3] )
    end if
end procedure
setHandler(edittext_code,w32HMouse,routine_id("RE_w32HMouse") )

procedure RE_w32HKeyDown(integer self, integer event, sequence params )
-- i can't get this to work becuase i need the change event but that dose
-- not work for the richeditor control. the changes to the richedit don't
-- happen yet for this event
integer index,pos,line
sequence text,temp
    temp=""
    pos=1
    line=1
    index=getIndex (edittext_code)
    index-=1
    text=getRichText(edittext_code,{0,0})
    text&=params[1]
    for i=1 to length(text) do
      if text[i]=13 then
        temp=append(temp,text[pos..i-1])
        pos=i+1
      end if
      if i=index then
      	line=length(temp)+1
      end if
    end for
    for i=1 to length(temp) do
       for j=1 to length(temp[i]) do
       end for
    end for
    --setText(lable_code_editor_info,sprint(line)&"   "&sprint(length(temp)+1)&"   "&sprint(index) )
end procedure
setHandler(edittext_code,w32HKeyDown,routine_id("RE_w32HKeyDown") )

--------------------------------------------------------------------------------
procedure Window4_onClose (integer self, integer event, sequence params)--params is ()
integer response
if code_editor_save_changes=1 then
response = message_box("Do you wish to save changes?",
                       "Code Editor",
                       MB_YESNO)
  if response = IDNO then

  else
    close_object_window_code()
  end if
end if
setFocus(Window1)
end procedure
setHandler( Window4, w32HClose, routine_id("Window4_onClose"))
--------------------------------------------------------------------------------
procedure Window4_onOpen (integer self, integer event, sequence params)--params is ()
  centerwindow(self)
  code_editor_save_changes=1
end procedure
setHandler( Window4, w32HOpen, routine_id("Window4_onOpen"))
--------------------------------------------------------------------------------
procedure Window4_onResize (integer self, integer event, sequence params)--params is ( int style, int cx, int cy )
sequence size1
size1= getCtlSize(Window4)
setCtlPosition( edittext_code, 0, 0)
setCtlSize( edittext_code,size1[1]-10 , size1[2]-90 )

end procedure
setHandler( Window4, w32HResize, routine_id("Window4_onResize"))
--------------------------------------------------------------------------------
procedure PopupItem_402_onClick (integer self, integer event, sequence params)--params is ()
  undo( edittext_code )
end procedure
setHandler( PopupItem_402, w32HClick, routine_id("PopupItem_402_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_404_onClick (integer self, integer event, sequence params)--params is ()
   cut( edittext_code )
end procedure
setHandler( PopupItem_404, w32HClick, routine_id("PopupItem_404_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_405_onClick (integer self, integer event, sequence params)--params is ()
  copy( edittext_code )
end procedure
setHandler( PopupItem_405, w32HClick, routine_id("PopupItem_405_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_406_onClick (integer self, integer event, sequence params)--params is ()
   paste( edittext_code )
end procedure
setHandler( PopupItem_406, w32HClick, routine_id("PopupItem_406_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_408_onClick (integer self, integer event, sequence params)--params is ()
sequence text
integer len
    text = getStream(edittext_code,StreamText)
    len = length(text)
    if len>0 then
    if text[len] != '\n' then
        len +=1
    end if
    setIndex(edittext_code, {1, len} )
    end if
end procedure
setHandler( PopupItem_408, w32HClick, routine_id("PopupItem_408_onClick"))
--------------------------------------------------------------------------------
procedure PushButton451_onClick (integer self, integer event, sequence params)--params is ()
close_object_window_code()
end procedure
setHandler( PushButton451, w32HClick, routine_id("PushButton451_onClick"))
--------------------------------------------------------------------------------
procedure PushButton454_onClick (integer self, integer event, sequence params)--params is ()
sequence fname,temp
object line
integer fn
  temp={}
  fname = getOpenFileName( Window4, "", {"Text File","*.txt"} )
  if length(fname)>0 then
    fn=open(fname,"r")
    while 1 do
    	line=gets(fn)
    	if atom(line) then
    	  exit
    	end if
    	temp&=line
    end while
    close(fn)
    setText(edittext_code,temp)
  end if
  setFocus(edittext_code)
end procedure
setHandler( PushButton454, w32HClick, routine_id("PushButton454_onClick"))
--------------------------------------------------------------------------------
procedure PushButton455_onClick (integer self, integer event, sequence params)--params is ()
  	sequence fname,temp
  	integer fn
    fname = getSaveFileName(Window4,"",{"Text File","*.txt"})
    if length(fname)>0 then
      temp=getrichtext()
      if find(".txt",fname)=0 then
        fname&=".txt"	
      end if
      fn=open(fname,"w")
      for i=1 to length(temp) do
      	puts(fn,temp[i])
      end for
      close(fn)
    end if
    setFocus(edittext_code)
end procedure
setHandler( PushButton455, w32HClick, routine_id("PushButton455_onClick"))
--------------------------------------------------------------------------------
procedure PushButton457_onClick (integer self, integer event, sequence params)--params is ()
  undo( edittext_code )
  setFocus(edittext_code)
end procedure
setHandler( PushButton457, w32HClick, routine_id("PushButton457_onClick"))
--------------------------------------------------------------------------------
procedure PushButton459_onClick (integer self, integer event, sequence params)--params is ()
   cut( edittext_code )
   setFocus(edittext_code)
end procedure
setHandler( PushButton459, w32HClick, routine_id("PushButton459_onClick"))
--------------------------------------------------------------------------------
procedure PushButton460_onClick (integer self, integer event, sequence params)--params is ()
  copy( edittext_code )
  setFocus(edittext_code)
end procedure
setHandler( PushButton460, w32HClick, routine_id("PushButton460_onClick"))
--------------------------------------------------------------------------------
procedure PushButton461_onClick (integer self, integer event, sequence params)--params is ()
   paste( edittext_code )
   setFocus(edittext_code)
end procedure
setHandler( PushButton461, w32HClick, routine_id("PushButton461_onClick"))
--------------------------------------------------------------------------------
procedure PushButton553_onClick (integer self, integer event, sequence params)--params is ()
integer temp
   temp= shellExecuteEx( "open",
    -- with the program to call:
    working_d&"help\\gaz game maker programming language help.htm",
    -- the parameter to pass to application to run:
     "",
    -- in this directory:
    "",
    -- and last, the 'show' parameter:
    SW_SHOW, 0 )
end procedure
setHandler( PushButton553, w32HClick, routine_id("PushButton553_onClick"))
--------------------------------------------------------------------------------
procedure Window5_onClose (integer self, integer event, sequence params)--params is ()
integer response
if room_window_closed=1 then
  close_room_window()
else
response = message_box("Save The Changes to "&getText(textbox_room_name)&"?",
                       "Warning",
                       MB_ICONWARNING+MB_YESNO)
  if response = IDYES then
    close_room_window()
  else

  end if
end if
setFocus(Window1)
end procedure
setHandler( Window5, w32HClose, routine_id("Window5_onClose"))
--------------------------------------------------------------------------------
procedure Window5_onOpen (integer self, integer event, sequence params)--params is ()
  setTimer(Window5,Timer4,100)
  centerwindow(self)
end procedure
setHandler( Window5, w32HOpen, routine_id("Window5_onOpen"))
--------------------------------------------------------------------------------
procedure Window5_onPaint (integer self, integer event, sequence params)--params is ( int x1, int y1, int x2, int y2 )
  draw_room_object_preview()
  draw_room_window()
end procedure
setHandler( Window5, w32HPaint, routine_id("Window5_onPaint"))
--------------------------------------------------------------------------------
procedure Window5_onResize (integer self, integer event, sequence params)--params is ( int style, int cx, int cy )
  draw_room_object_preview()
end procedure
setHandler( Window5, w32HResize, routine_id("Window5_onResize"))
--------------------------------------------------------------------------------
procedure Window5_onTimer (integer self, integer event, sequence params)--params is ( int timerId)
  killTimer(Window5,Timer4)
  draw_room_object_preview()
end procedure
setHandler( Window5, w32HTimer, routine_id("Window5_onTimer"))
--------------------------------------------------------------------------------
procedure CWindow2_onKeyDown (integer self, integer event, sequence params)--params is ( atom scanCode, atom shift )
  key_add(params[1])
end procedure
setHandler( CWindow2, w32HKeyDown, routine_id("CWindow2_onKeyDown"))
--------------------------------------------------------------------------------
procedure CWindow2_onKeyUp (integer self, integer event, sequence params)--params is ( int scanCode, int shift )
  key_remove(params[1])
end procedure
setHandler( CWindow2, w32HKeyUp, routine_id("CWindow2_onKeyUp"))
--------------------------------------------------------------------------------
procedure CWindow2_onMouse (integer self, integer event, sequence params)--params is ( int event, int x, int y, int shift, int wheelmove )
  mouse_room_window(params[2],params[3],params[1])
end procedure
setHandler( CWindow2, w32HMouse, routine_id("CWindow2_onMouse"))
--------------------------------------------------------------------------------
procedure CWindow2_onPaint (integer self, integer event, sequence params)--params is ( int x1, int y1, int x2, int y2 )
  draw_room_window()
end procedure
setHandler( CWindow2, w32HPaint, routine_id("CWindow2_onPaint"))
--------------------------------------------------------------------------------
procedure PushButton556_onClick (integer self, integer event, sequence params)--params is ()
  room_window_closed=1
  closeWindow(Window5)
end procedure
setHandler( PushButton556, w32HClick, routine_id("PushButton556_onClick"))
--------------------------------------------------------------------------------
procedure PushButton521_onClick (integer self, integer event, sequence params)--params is ()
room_window_pack={}
draw_room_window()
end procedure
setHandler( PushButton521, w32HClick, routine_id("PushButton521_onClick"))
--------------------------------------------------------------------------------
procedure PushButton523_onClick (integer self, integer event, sequence params)--params is ()
  room_window_move_mode=1
  openWindow(Window20,Modal)
end procedure
setHandler( PushButton523, w32HClick, routine_id("PushButton523_onClick"))
--------------------------------------------------------------------------------
procedure PushButton524_onClick (integer self, integer event, sequence params)--params is ()
  room_window_move_mode=2
  openWindow(Window20,Modal)
end procedure
setHandler( PushButton524, w32HClick, routine_id("PushButton524_onClick"))
--------------------------------------------------------------------------------
procedure PushButton525_onClick (integer self, integer event, sequence params)--params is ()
  room_window_move_mode=3
  openWindow(Window20,Modal)
end procedure
setHandler( PushButton525, w32HClick, routine_id("PushButton525_onClick"))
--------------------------------------------------------------------------------
procedure PushButton526_onClick (integer self, integer event, sequence params)--params is ()
  room_window_move_mode=4
  openWindow(Window20,Modal)
end procedure
setHandler( PushButton526, w32HClick, routine_id("PushButton526_onClick"))
--------------------------------------------------------------------------------
procedure button_room_grid_onClick (integer self, integer event, sequence params)--params is ()
  draw_room_window()
end procedure
setHandler( button_room_grid, w32HClick, routine_id("button_room_grid_onClick"))
--------------------------------------------------------------------------------
procedure textbox_room_snapx_onChange (integer self, integer event, sequence params)--params is ()
  room_window_snapx=real(getText(self))
  draw_room_window()
end procedure
setHandler( textbox_room_snapx, w32HChange, routine_id("textbox_room_snapx_onChange"))
--------------------------------------------------------------------------------
procedure textbox_room_snapy_onChange (integer self, integer event, sequence params)--params is ()
  room_window_snapy=real(getText(self))
  draw_room_window()
end procedure
setHandler( textbox_room_snapy, w32HChange, routine_id("textbox_room_snapy_onChange"))
--------------------------------------------------------------------------------
procedure bar_room_height_onScroll (integer self, integer event, sequence params)--params is ( int pos )
  change_bar_room_window()
  draw_room_window()
end procedure
setHandler( bar_room_height, w32HScroll, routine_id("bar_room_height_onScroll"))
--------------------------------------------------------------------------------
procedure textbox_room_width_onChange (integer self, integer event, sequence params)--params is ()
  change_size_room_window()
  draw_room_window()
end procedure
setHandler( textbox_room_width, w32HChange, routine_id("textbox_room_width_onChange"))
--------------------------------------------------------------------------------
procedure textbox_room_height_onChange (integer self, integer event, sequence params)--params is ()
  change_size_room_window()
  draw_room_window()
end procedure
setHandler( textbox_room_height, w32HChange, routine_id("textbox_room_height_onChange"))
--------------------------------------------------------------------------------
procedure select_room_background_color_onClick (integer self, integer event, sequence params)--params is ()
  setVisible(group_room_background_style,0)
  refreshWindow(group_room_background)
  draw_room_window()
end procedure
setHandler( select_room_background_color, w32HClick, routine_id("select_room_background_color_onClick"))
--------------------------------------------------------------------------------
procedure bitmap_room_background_color_onClick (integer self, integer event, sequence params)--params is ()
  if isChecked(select_room_background_color) then
  	room_window_background_color=getColorDialog( Window5, room_window_background_color )
  	draw_room_window()
  end if
end procedure
setHandler( bitmap_room_background_color, w32HClick, routine_id("bitmap_room_background_color_onClick"))
--------------------------------------------------------------------------------
procedure select_room_background_image_onClick (integer self, integer event, sequence params)--params is ()
  setVisible(group_room_background_style,1)
  load_room_image()
  draw_room_window()
end procedure
setHandler( select_room_background_image, w32HClick, routine_id("select_room_background_image_onClick"))
--------------------------------------------------------------------------------
procedure bitmap_room_background_image_onClick (integer self, integer event, sequence params)--params is ()
sequence fname
integer cop1
if isChecked(select_room_background_image) then
    room_buffer_can_focus=0
    fname = getOpenFileName( Window2, "", {"Bmp Files","*.bmp"} )
    room_buffer_can_focus=1
    if length(fname)>0 then
     room_window_background_image=loadBitmapFromFile( fname )
     room_window_background_filename=fname
     cop1=copyFile(fname, "c:\\windows\\temp\\"&get_file_fullname_part(fname),0)
     delete_list=append(delete_list,get_file_fullname_part(fname))
    end if
  	draw_room_window()
 end if
end procedure
setHandler( bitmap_room_background_image, w32HClick, routine_id("bitmap_room_background_image_onClick"))
--------------------------------------------------------------------------------
procedure select_room_background_style_normal_onClick (integer self, integer event, sequence params)--params is ()
  draw_room_window()
end procedure
setHandler( select_room_background_style_normal, w32HClick, routine_id("select_room_background_style_normal_onClick"))
--------------------------------------------------------------------------------
procedure select_room_background_style_tile_onClick (integer self, integer event, sequence params)--params is ()
  draw_room_window()
end procedure
setHandler( select_room_background_style_tile, w32HClick, routine_id("select_room_background_style_tile_onClick"))
--------------------------------------------------------------------------------
procedure select_room_view_enable_onClick (integer self, integer event, sequence params)--params is ()
  if isChecked(self)=1 then
  	setVisible(group_room_view,1)
  else
    setVisible(group_room_view,0)
  end if
end procedure
setHandler( select_room_view_enable, w32HClick, routine_id("select_room_view_enable_onClick"))
--------------------------------------------------------------------------------
procedure button_room_object_select_onClick (integer self, integer event, sequence params)--params is ()
  popup({room_popup_menu,button_room_object_select},1,-30)
end procedure
setHandler( button_room_object_select, w32HClick, routine_id("button_room_object_select_onClick"))
--------------------------------------------------------------------------------
procedure PushButton158_onClick (integer self, integer event, sequence params)--params is ()
  room_window_closed=1
  closeWindow(Window5)
end procedure
setHandler( PushButton158, w32HClick, routine_id("PushButton158_onClick"))
--------------------------------------------------------------------------------
procedure bar_room_width_onScroll (integer self, integer event, sequence params)--params is ( int pos )
  change_bar_room_window()
  draw_room_window()
end procedure
setHandler( bar_room_width, w32HScroll, routine_id("bar_room_width_onScroll"))
--------------------------------------------------------------------------------
procedure Window6_onClose (integer self, integer event, sequence params)--params is ()
integer response
if sound_window_closed=1 then
  close_sound_window()
else
response = message_box("Save The Changes to "&getText(textbox_snd_name)&"?",
                       "Warning",
                       MB_ICONWARNING+MB_YESNO)
  if response = IDYES then
    close_sound_window()
  else

  end if
end if
setFocus(Window1)
end procedure
setHandler( Window6, w32HClose, routine_id("Window6_onClose"))
--------------------------------------------------------------------------------
procedure Window6_onOpen (integer self, integer event, sequence params)--params is ()
  centerwindow(self)
end procedure
setHandler( Window6, w32HOpen, routine_id("Window6_onOpen"))
--------------------------------------------------------------------------------
procedure PushButton184_onClick (integer self, integer event, sequence params)--params is ()
sequence fname
integer cop1
  fname = getOpenFileName( Window6, "", {"Sound Files","*.wav"} )
  if length(fname)>0 then
     sound_window_filename=fname
     setVisible(group_snd_sound,1)
     setVisible(button_snd_save,1)
     setText(lable_snd_filename,get_file_fullname_part(fname))
     cop1=copyFile(fname, "c:\\windows\\temp\\"&get_file_fullname_part(fname),0)
     delete_list=append(delete_list,get_file_fullname_part(fname))
  end if
end procedure
setHandler( PushButton184, w32HClick, routine_id("PushButton184_onClick"))
--------------------------------------------------------------------------------
procedure button_snd_save_onClick (integer self, integer event, sequence params)--params is ()
sequence fname
integer temp
  fname = getSaveFileName( Window6, "", {"Sound Files","*.wav"} )
  if length(fname)>0 then
    if find(".wav",fname)=0 then
       fname&=".wav"	
    end if
    temp=copyFile("c:\\windows\\temp\\"&get_file_fullname_part(sound_window_filename),fname,0)
  end if
end procedure
setHandler( button_snd_save, w32HClick, routine_id("button_snd_save_onClick"))
--------------------------------------------------------------------------------
procedure PushButton185_onClick (integer self, integer event, sequence params)--params is ()
integer temp
  temp = playSound(sound_window_filename)
end procedure
setHandler( PushButton185, w32HClick, routine_id("PushButton185_onClick"))
--------------------------------------------------------------------------------
procedure PushButton187_onClick (integer self, integer event, sequence params)--params is ()
integer temp
  temp = playSound("")
end procedure
setHandler( PushButton187, w32HClick, routine_id("PushButton187_onClick"))
--------------------------------------------------------------------------------
procedure PushButton183_onClick (integer self, integer event, sequence params)--params is ()
  sound_window_closed=1
  closeWindow(Window6)
end procedure
setHandler( PushButton183, w32HClick, routine_id("PushButton183_onClick"))
--------------------------------------------------------------------------------
procedure Window7_onClose (integer self, integer event, sequence params)--params is ()
setFocus(Window1)
end procedure
setHandler( Window7, w32HClose, routine_id("Window7_onClose"))
--------------------------------------------------------------------------------
procedure Window7_onOpen (integer self, integer event, sequence params)--params is ()
   centerwindow(self)
end procedure
setHandler( Window7, w32HOpen, routine_id("Window7_onOpen"))
--------------------------------------------------------------------------------
procedure PushButton216_onClick (integer self, integer event, sequence params)--params is ()
closeWindow(Window7)
end procedure
setHandler( PushButton216, w32HClick, routine_id("PushButton216_onClick"))
--------------------------------------------------------------------------------
procedure Window8_onClose (integer self, integer event, sequence params)--params is ()
setFocus(Window1)
end procedure
setHandler( Window8, w32HClose, routine_id("Window8_onClose"))
--------------------------------------------------------------------------------
procedure Window8_onMouse (integer self, integer event, sequence params)--params is ( int event, int x, int y, int shift, int wheelmove )
  if params[1]=LeftDown then
  	
  end if
end procedure
setHandler( Window8, w32HMouse, routine_id("Window8_onMouse"))
--------------------------------------------------------------------------------
procedure Window8_onOpen (integer self, integer event, sequence params)--params is ()
  centerwindow(self)
  if registered=1 then
    setText(LText539,"About Gaz Game Maker Registered to "&registered_name)
  else
    setText(LText539,"About Gaz Game Maker Not Registered")
  end if
  setMousePointer( LText310, NoPointer)
end procedure
setHandler( Window8, w32HOpen, routine_id("Window8_onOpen"))
--------------------------------------------------------------------------------
procedure Icon228_onClick (integer self, integer event, sequence params)--params is ()
closeWindow(Window8)
end procedure
setHandler( Icon228, w32HClick, routine_id("Icon228_onClick"))
--------------------------------------------------------------------------------
procedure LText310_onMouse (integer self, integer event, sequence params)--params is ( int event, int x, int y, int shift, int wheelmove )
integer temp
  if params[1]=LeftUp then
   temp= shellExecuteEx( "open",
    -- with the program to call:
    "IEXPLORE",
    -- the parameter to pass to application to run:
    "www.bioware.freewebsitehosting.com",
    -- in this directory:
    "",
    -- and last, the 'show' parameter:
    SW_SHOW, 0 )
  end if
end procedure
setHandler( LText310, w32HMouse, routine_id("LText310_onMouse"))
--------------------------------------------------------------------------------
procedure PushButton299_onClick (integer self, integer event, sequence params)--params is ()
  closeWindow(Window8)
end procedure
setHandler( PushButton299, w32HClick, routine_id("PushButton299_onClick"))
--------------------------------------------------------------------------------
procedure Window9_onClose (integer self, integer event, sequence params)--params is ()
setFocus(Window1)
end procedure
setHandler( Window9, w32HClose, routine_id("Window9_onClose"))
--------------------------------------------------------------------------------
procedure Window9_onOpen (integer self, integer event, sequence params)--params is ()
  centerwindow(self)
end procedure
setHandler( Window9, w32HOpen, routine_id("Window9_onOpen"))
--------------------------------------------------------------------------------
procedure Window10_onClose (integer self, integer event, sequence params)--params is ()
setFocus(Window1)
end procedure
setHandler( Window10, w32HClose, routine_id("Window10_onClose"))
--------------------------------------------------------------------------------
procedure Window10_onOpen (integer self, integer event, sequence params)--params is ()
  setText(register_name,"")
  setText(register_key,"")
  centerwindow(self)
-- Generated by IDE for Timer 
setTimer ( Window10, Timer2, 0 )
end procedure
setHandler( Window10, w32HOpen, routine_id("Window10_onOpen"))
--------------------------------------------------------------------------------
procedure Window10_onTimer (integer self, integer event, sequence params)--params is ( int timerId)
  killTimer(Window10,Timer2)
  if registered=1 then
  	show_message("You Have All Ready Registered")
  	closeWindow(Window10)
  end if
end procedure
setHandler( Window10, w32HTimer, routine_id("Window10_onTimer"))
--------------------------------------------------------------------------------
procedure PushButton272_onClick (integer self, integer event, sequence params)--params is ()
sequence name,key
if length(lower(getText(register_name)))>3 then
key=""
count+=1
name=lower(getText(register_name))
 for i=1 to length(name) do
     if name[i]='z' or name[i]+i+floor(name[i]/i) >'z' then
       key&='a'+i+floor(name[i]/i)
     else
       key&=name[i]+i+floor(name[i]/i)
     end if
  end for
  if compare(getText(register_key), key )=0 then
    registered=regSetValue(app_key,"registered","ggmyesreg")
    registered=regSetValue(app_key,"key",key)
    registered=regSetValue(app_key,"name",name)
    registered=1
    setText(register_key,"")
    show_message("Thank You For Registering Your Copy Of Game Maker")
    registered_name=name
    setText(register_name,"")
    closeWindow(Window10)
  else
    setText(register_name,"")
    setText(register_key,"")
    show_message("The Registered Information is Not Right!")
    if count>3 then
      count=0
      closeWindow(Window10)
    end if
  end if
else
  setText(register_name,"")
  setText(register_key,"")
  show_message("The name must be four or moor charters long")
end if
end procedure
setHandler( PushButton272, w32HClick, routine_id("PushButton272_onClick"))
--------------------------------------------------------------------------------
procedure PushButton273_onClick (integer self, integer event, sequence params)--params is ()
  closeWindow(Window10)
end procedure
setHandler( PushButton273, w32HClick, routine_id("PushButton273_onClick"))
--------------------------------------------------------------------------------
integer strip_mode
strip_mode=0

integer sprite_window_focus,sprite_editor_save_changes
sprite_editor_save_changes=1
sprite_window_focus=1
constant limit1=limitsize("", Window11, 500, 400, 1200, 1200, 0, 0 )
constant limit2=limitsize("", Window12, 300, 300, 500, 470, 0, 0 )

function rgbs(atom rgb)
	return ( {and_bits(#000000FF, rgb),
	          and_bits(#0000FF00, rgb) / #100,
	          and_bits(#00FF0000, rgb) / #10000 } )
end function

integer timer
timer=0
preview_image_single=1
background_color=rgb(255,255,255)

sequence backup_images,undo_images
integer backup,backup2,backup_work,backup_work2
backup=0
backup2=0
backup_images={}
undo_images={}
backup_work=0
backup_work2=0

procedure set_bar_range()
  integer left_number,x,y,count
  --sprite_window_top=0
  setWindowScrollRange ( bar_height, SB_VERT, 0, sprite_window_height , sprite_window_height )
  if image_height>sprite_window_height then
    setWindowScrollRange ( bar_height, SB_VERT, 0, image_height , sprite_window_height )
  end if
  x=0
  y=0
  count=0
    left_number=floor(sprite_window_width/(image_width+10))
  	for i=1 to length(images) do
      if count>=left_number then
       y+=image_height+5
       x=5
       if (y+image_height) > sprite_window_height then
          if left_number=0 then
            setWindowScrollRange ( bar_height, SB_VERT, 0, y+10 , sprite_window_height )
          else
	        setWindowScrollRange ( bar_height, SB_VERT, 0, y+image_height+10 , sprite_window_height )
          end if
       end if
       count=0
      end if
  	  x+=image_width+5
      count+=1
    end for
end procedure

procedure draw_image_list()
integer x,y,left_number,count
  x=5
  y=5
  count=0
  left_number=floor(sprite_window_width/(image_width+10))
  for i=1 to length(images) do
    if count>=left_number and sprite_window_width>image_width then
       y+=image_height+5
       x=5
       count=0
    end if
    if y>-sprite_window_top and y-sprite_window_top<sprite_window_height then
      drawDib(buffer_sprite_editor, images[i], x, y-sprite_window_top, 0, 0, images[i][DibWidth], images[i][DibHeight])
    end if
  	if select_image=i then
  	   setPenColor(buffer_sprite_editor,rgb(0,0,0))
  	   drawRectangle(buffer_sprite_editor,0,x-3,(y-3)-sprite_window_top, x+images[i][DibWidth]+3, (y+images[i][DibHeight]+3)-sprite_window_top )
  	end if
  	x+=image_width+5
    count+=1
  end for
end procedure

procedure draw_preview_window()
  setPenColor(buffer_sprite_editor_preview,background_color)
  drawRectangle(buffer_sprite_editor_preview,1,0,0,preview_window_width,preview_window_height)
  if length(images)>0 then
    if preview_image_single>length(images) then
  	  preview_image_single=1
    end if
    if images[preview_image_single][DibWidth]>preview_window_width and images[preview_image_single][DibHeight]>preview_window_height then
      --stretchBlt( Buffer_preview,0,0,preview_window_width,preview_window_height,images[preview_image_single][DibHandle],0,0,images[preview_image_single][DibWidth],images[preview_image_single][DibHeight],SRCCOPY )
    elsif images[preview_image_single][DibWidth]>preview_window_width then
      --stretchBlt( Buffer_preview,0,0,preview_window_width,preview_window_height,images[preview_image_single][DibHandle],0,0,images[preview_image_single][DibWidth],images[preview_image_single][DibHeight],SRCCOPY )	
    elsif images[preview_image_single][DibHeight]>preview_window_height then
      --stretchBlt( Buffer_preview,0,0,preview_window_width,preview_window_height,images[preview_image_single][DibHandle],0,0,images[preview_image_single][DibWidth],images[preview_image_single][DibHeight],SRCCOPY )
    else
	  --drawDib(Buffer_preview, images[preview_image_single], 0, 0, 0, 0, images[preview_image_single][DibWidth], images[preview_image_single][DibHeight])
    end if
    drawDib(buffer_sprite_editor_preview, images[preview_image_single], 0, 0, 0, 0, images[preview_image_single][DibWidth], images[preview_image_single][DibHeight])
  	preview_image_single+=1
  end if
  copyBlt ( CWindow4, 0, 0, buffer_sprite_editor_preview )
end procedure

procedure draw_sprite_editor_window()
  setPenColor(buffer_sprite_editor,rgb(255,255,255))
  drawRectangle(buffer_sprite_editor,1,0,0,sprite_window_width,sprite_window_height)
  draw_image_list()
  copyBlt ( CWindow3, 0, 0, buffer_sprite_editor )
end procedure

procedure mouse_sprite_window(integer mousex, integer mousey, integer event)
integer x,y,left_number,count
x=5
y=5
count=0
left_number=floor(sprite_window_width/(image_width+10))
if event=LeftDown then
  for i=1 to length(images) do
    if count>=left_number then
       y+=image_height+5
       x=5
       count=0
    end if
  	if mousex>= x and mousex <= x+images[i][DibWidth] and mousey+sprite_window_top >= y and mousey+sprite_window_top <= y+images[i][DibHeight] then
  	  select_image=i
  	  draw_sprite_editor_window()
  	  exit
  	end if
  	x+=image_width+5
    count+=1
  end for
end if
end procedure

procedure make_backup()
    backup_work=1
    if backup=1 then
       for i=1 to length(backup_images) do
       	  --killDib(backup_images[i])
       end for 	
    end if
    backup2=1
    for i=1 to length(undo_images) do
    	--killDib(undo_images[i])
    end for
    backup_images={}
    backup=1
	for i=1 to length(images) do
		backup_images=append(backup_images, extractDib(images[i],0,0,images[i][DibWidth]-1,images[i][DibHeight]-1 ) )
	end for
	set_bar_range()
	draw_sprite_editor_window()
end procedure

procedure restore_backup()
    backup_work2=1
    if backup2=1 then
      undo_images={}
      for i=1 to length(images) do
    	undo_images=append(undo_images,extractDib(images[i],0,0,images[i][DibWidth]-1,images[i][DibHeight]-1 ))
    	--killDib(images[i])
      end for
      backup2=0
    end if
    backup=0
    images={}
	for i=1 to length(backup_images) do
		images=append(images,backup_images[i])
	end for
	select_image=length(images)
	set_bar_range()
	draw_sprite_editor_window()
end procedure

procedure undo_backup()
    --backup=1
    images={}
	for i=1 to length(undo_images) do
		images=append(images,undo_images[i])
	end for
	select_image=length(images)
	set_bar_range()
	draw_sprite_editor_window()
end procedure
--------------------------------------------------------------------------------
procedure Window11_onClose (integer self, integer event, sequence params)--params is ()
integer response
sequence fname
integer result
if sprite_editor_save_changes=1 then
    response = message_box("Save the changes to the sprite",
                       "Warning",
                       MB_ICONWARNING+MB_YESNO)
    if response = IDYES then
      sprite_window_images={}
      sprite_window_filenames={}
      sprite_window_image_width=image_width
      sprite_window_image_height=image_height
      if length(images)>0 then
  	    sprite_window_image_index=1
  	         setVisible(button_spr_delete,1)
  	 setVisible(button_spr_next,1)
  	 setVisible(button_spr_back,1)
  	 setVisible(button_spr_add_sub_image,1)
  	 setVisible(button_spr_save_sub_image,1)
  	 setVisible(group_spr_bounding_box,1)
  	 setVisible(group_spr_transprant_image,1)
     setVisible(group_spr_offset,1)
  	 setVisible(group_spr_preview,1)
  	 else
  	 setVisible(button_spr_delete,0)
  	setVisible(button_spr_next,0)
  	setVisible(button_spr_back,0)
  	setVisible(button_spr_add_sub_image,0)
  	setVisible(group_spr_bounding_box,0)
  	setVisible(group_spr_transprant_image,0)
  	setVisible(group_spr_offset,0)
  	setVisible(group_spr_preview,0)
  	setText(label_spr_fname,"")
      end if
      for i=1 to length(images) do
        fname="c:\\windows\\temp\\"&sprite_info[sprite_window_index][SPR_NAME]&sprint(i)&".bmp"
        result=saveDib(images[i], fname , 0, 0, image_width, image_height)
        sprite_window_images=append(sprite_window_images,loadBitmapFromFile( fname ))
        sprite_window_filenames=append(sprite_window_filenames,fname)
        delete_list=append(delete_list,get_file_fullname_part(fname))
       end for
    end if	
end if
sprite_editor_save_changes=1
for i=1 to length(images) do
killDib(images[i])
end for
image_width=32
image_height=32
images=
{
newDib(image_width,image_height)
}
select_image=1
sprite_window_save_changes=1
setFocus(Window2)
end procedure
setHandler( Window11, w32HClose, routine_id("Window11_onClose"))
--------------------------------------------------------------------------------
procedure Window11_onOpen (integer self, integer event, sequence params)--params is ()
sequence size,size2
size=getCtlSize(Window11)
setCtlSize(CWindow3,size[1]-170,size[2]-110)

setCtlSize(CWindow4,140,size[2]-140)
size2=getCtlSize(CWindow4)
setCtlSize(buffer_sprite_editor_preview,140,size2[2]-80)
preview_window_width=140
preview_window_height=size2[2]-80
setCtlPosition(button_sprite_editor_background,20,size[2]-180)
setCtlPosition(lable_sprite_editor_speed,10,size[2]-200)
setCtlPosition(textbox_sprite_editor_speed,60,size[2]-200)

setCtlSize(buffer_sprite_editor,size[1]-170,size[2]-110)
--setCtlPosition(bar_height,size[1]-30,0) cause the scroll bar to get position wronge
setCtlSize(bar_height,20,size[2]-110)

sprite_window_width=size[1]-170
sprite_window_height=size[2]-110
setWindowScrollRange ( bar_height, SB_VERT, 0,sprite_window_height ,sprite_window_height )
sprite_window_top=0
set_bar_range()
draw_sprite_editor_window()
setVisible(CWindow4,0)
background_color=rgb(255,255,255)
setCheck(checkbox_sprite_editor_preview,0)
centerwindow(Window11)
end procedure
setHandler( Window11, w32HOpen, routine_id("Window11_onOpen"))
--------------------------------------------------------------------------------
procedure Window11_onPaint (integer self, integer event, sequence params)--params is ( int x1, int y1, int x2, int y2 )
  draw_sprite_editor_window()
end procedure
setHandler( Window11, w32HPaint, routine_id("Window11_onPaint"))
--------------------------------------------------------------------------------
procedure Window11_onResize (integer self, integer event, sequence params)--params is ( int style, int cx, int cy )
sequence size,size2
size=getCtlSize(Window11)
setCtlSize(CWindow3,size[1]-170,size[2]-110)
setCtlSize(buffer_sprite_editor,size[1]-170,size[2]-110)
setCtlPosition(bar_height,size[1]-30,0)
setCtlSize(bar_height,20,size[2]-110)

setCtlSize(CWindow4,140,size[2]-140)
size2=getCtlSize(CWindow4)
setCtlSize(buffer_sprite_editor_preview,140,size2[2]-80)
preview_window_width=140
preview_window_height=size2[2]-80
setCtlPosition(button_sprite_editor_background,20,size[2]-180)
setCtlPosition(lable_sprite_editor_speed,10,size[2]-200)
setCtlPosition(textbox_sprite_editor_speed,60,size[2]-200)

sprite_window_width=size[1]-170
sprite_window_height=size[2]-110
set_bar_range()
sprite_window_top=0
draw_sprite_editor_window()
repaintWindow( CWindow4 )
draw_preview_window()
end procedure
setHandler( Window11, w32HResize, routine_id("Window11_onResize"))
--------------------------------------------------------------------------------
procedure MenuItem_1102_onClick (integer self, integer event, sequence params)--params is ()
  openWindow(Window13,Modal)
end procedure
setHandler( MenuItem_1102, w32HClick, routine_id("MenuItem_1102_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1103_onClick (integer self, integer event, sequence params)--params is ()
sequence fname
  fname = getOpenFileName( Window11, "", {"Bitmap File","*.bmp"} )
  if length(fname)>0 then
    make_backup()
  	dib = loadDib (fname) -- loads the bitmap
    images={dib}
    image_width=dib[DibWidth]
    image_height=dib[DibHeight]
    select_image=1
    sprite_window_top=0
    set_bar_range()
    draw_sprite_editor_window()
  end if
end procedure
setHandler( MenuItem_1103, w32HClick, routine_id("MenuItem_1103_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1107_onClick (integer self, integer event, sequence params)--params is ()
  sequence fname
  fname = getOpenFileName( Window11, "", {"Bitmap File","*.bmp"} )
  if length(fname)>0 then
    make_backup()
  	dib = loadDib (fname)
  	if dib[DibWidth]=image_width and dib[DibHeight]=image_height then
  	  images=append(images,dib)
      select_image=length(images)
      set_bar_range()
      draw_sprite_editor_window()
    else
	  openWindow(Window15,Modal)
  	end if
  end if
end procedure
setHandler( MenuItem_1107, w32HClick, routine_id("MenuItem_1107_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1109_onClick (integer self, integer event, sequence params)--params is ()
sequence fname
integer temp
  if length(images)>1 then
    fname = getSaveFileName(Window12,"",{"Bitmap File","*.bmp"})
    if length(fname)>0 then
	  setSize(Buffer,image_width*length(images),image_height)
	  for i=1 to length(images) do
	  	drawDib(Buffer, images[i], (image_width*i)-image_width, 0, 0, 0, image_width, image_height)
	  end for
	  if find(".bmp",fname)=0 then
        fname&=".bmp"	
      end if
	  temp=copyToTrueColorBitmapFile( Buffer, fname, 0, 0, image_width*length(images)-1, image_height-1 )
	end if
  end if
end procedure
setHandler( MenuItem_1109, w32HClick, routine_id("MenuItem_1109_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1111_onClick (integer self, integer event, sequence params)--params is ()
  sequence fname
  fname = getOpenFileName( Window1, "", {"Bitmap File","*.bmp"} )
  if length(fname)>0 then
  	dib = loadDib (fname) -- loads the bitmap
  	setEnable(textbox_image_width,1)
  	setEnable(textbox_image_height,1)
  	strip_mode=1
    openWindow(Window16,Modal)
  end if
end procedure
setHandler( MenuItem_1111, w32HClick, routine_id("MenuItem_1111_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1112_onClick (integer self, integer event, sequence params)--params is ()
  sequence fname
  fname = getOpenFileName( Window1, "", {"Bitmap File","*.bmp"} )
  if length(fname)>0 then
  	dib = loadDib (fname) -- loads the bitmap
  	setEnable(textbox_image_width,0)
  	setEnable(textbox_image_height,0)
  	strip_mode=0
    openWindow(Window16,Modal)
  end if
end procedure
setHandler( MenuItem_1112, w32HClick, routine_id("MenuItem_1112_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1113_onClick (integer self, integer event, sequence params)--params is ()
sequence fname
integer result
sprite_editor_save_changes=0
  sprite_window_images={}
  sprite_window_filenames={}
  sprite_window_image_width=image_width
  sprite_window_image_height=image_height
  if length(images)>0 then
  	sprite_window_image_index=1
  	 setVisible(button_spr_delete,1)
  	 setVisible(button_spr_next,1)
  	 setVisible(button_spr_back,1)
  	 setVisible(button_spr_add_sub_image,1)
  	 setVisible(button_spr_save_sub_image,1)
  	 setVisible(group_spr_bounding_box,1)
  	 setVisible(group_spr_transprant_image,1)
     setVisible(group_spr_offset,1)
  	 setVisible(group_spr_preview,1)
  else
  setVisible(button_spr_delete,0)
  	setVisible(button_spr_next,0)
  	setVisible(button_spr_back,0)
  	setVisible(button_spr_add_sub_image,0)
  	setVisible(group_spr_bounding_box,0)
  	setVisible(group_spr_transprant_image,0)
  	setVisible(group_spr_offset,0)
  	setVisible(group_spr_preview,0)
  	setText(label_spr_fname,"")
  end if
  for i=1 to length(images) do
    fname="c:\\windows\\temp\\"&sprite_info[sprite_window_index][SPR_NAME]&sprint(i)&".bmp"
    result=saveDib(images[i], fname , 0, 0, image_width, image_height)
    sprite_window_images=append(sprite_window_images,loadBitmapFromFile( fname ))
    sprite_window_filenames=append(sprite_window_filenames,fname)
    delete_list=append(delete_list,get_file_fullname_part(fname))
  end for
  closeWindow(Window11)
end procedure
setHandler( MenuItem_1113, w32HClick, routine_id("MenuItem_1113_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1105_onClick (integer self, integer event, sequence params)--params is ()
  make_backup()
  for i=1 to length(images) do
  	 flipDibHor(images[i])
  end for
  draw_sprite_editor_window()
end procedure
setHandler( MenuItem_1105, w32HClick, routine_id("MenuItem_1105_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1106_onClick (integer self, integer event, sequence params)--params is ()
  make_backup()
  for i=1 to length(images) do
  	 flipDibVert(images[i])
  end for
  draw_sprite_editor_window()
end procedure
setHandler( MenuItem_1106, w32HClick, routine_id("MenuItem_1106_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1115_onClick (integer self, integer event, sequence params)--params is ()
  integer x,y,width,height
  make_backup()
  for i=1 to length(images) do
  	 dib=rotateDib(images[i], 90 ,0)
  	 clearDib(images[i], getDibPixel(images[i],0,0))
  	 if dib[DibWidth] = image_width and dib[DibHeight] = image_height then
  	   x=0
  	   y=0
  	   width=image_width
  	   height=image_height
  	   drawDibToDib(images[i],dib,0,0,x,y,width,height,{},255)
  	 elsif dib[DibWidth] > image_width then
      x=floor((dib[DibWidth]-image_width)/2)
      y=floor((dib[DibHeight]-image_height)/2)
      width=dib[DibWidth]-x
      height=dib[DibHeight]-y
      drawDibToDib(images[i],dib,0,0,x,y,width,height,{},255)
  	 elsif dib[DibWidth] < image_width then
	   x=floor((image_width-dib[DibWidth])/2)
       y=floor((dib[DibHeight]-image_height)/2)
       width=dib[DibWidth]+x
       height=dib[DibHeight]-y
       drawDibToDib(images[i],dib,x,0,0,y,width,height,{},255)
     else
       puts(1,"erorr")
  	 end if
  	
  	 killDib(dib)
  end for
  draw_sprite_editor_window()
end procedure
setHandler( MenuItem_1115, w32HClick, routine_id("MenuItem_1115_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1116_onClick (integer self, integer event, sequence params)--params is ()
  integer x,y,width,height
  make_backup()
  for i=1 to length(images) do
  	 dib=rotateDib(images[i], -90, 0)
  	 clearDib(images[i], getDibPixel(images[i],0,0))
  	 if dib[DibWidth] = image_width and dib[DibHeight] = image_height then
  	   x=0
  	   y=0
  	   width=image_width
  	   height=image_height
  	   drawDibToDib(images[i],dib,0,0,x,y,width,height,{},255)
  	 elsif dib[DibWidth] > image_width then
      x=floor((dib[DibWidth]-image_width)/2)
      y=floor((dib[DibHeight]-image_height)/2)
      width=dib[DibWidth]-x
      height=dib[DibHeight]-y
      drawDibToDib(images[i],dib,0,0,x,y,width,height,{},255)
  	 elsif dib[DibWidth] < image_width then
	   x=floor((image_width-dib[DibWidth])/2)
       y=floor((dib[DibHeight]-image_height)/2)
       width=dib[DibWidth]+x
       height=dib[DibHeight]-y
       drawDibToDib(images[i],dib,x,0,0,y,width,height,{},255)
     else
       puts(1,"erorr")
  	 end if
  	 killDib(dib)
  end for
  draw_sprite_editor_window()
end procedure
setHandler( MenuItem_1116, w32HClick, routine_id("MenuItem_1116_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1117_onClick (integer self, integer event, sequence params)--params is ()
  integer x,y,width,height
  make_backup()
  for i=1 to length(images) do
  	 dib=rotateDib(images[i], 180, 0)
  	 clearDib(images[i], getDibPixel(images[i],0,0))
  	 if dib[DibWidth] = image_width and dib[DibHeight] = image_height then
  	   x=0
  	   y=0
  	   width=image_width
  	   height=image_height
  	   drawDibToDib(images[i],dib,0,0,x,y,width,height,{},255)
  	 elsif dib[DibWidth] > image_width then
      x=floor((dib[DibWidth]-image_width)/2)
      y=floor((dib[DibHeight]-image_height)/2)
      width=dib[DibWidth]-x
      height=dib[DibHeight]-y
      drawDibToDib(images[i],dib,0,0,x,y,width,height,{},255)
  	 elsif dib[DibWidth] < image_width then
	   x=floor((image_width-dib[DibWidth])/2)
       y=floor((dib[DibHeight]-image_height)/2)
       width=dib[DibWidth]+x
       height=dib[DibHeight]-y
       drawDibToDib(images[i],dib,x,0,0,y,width,height,{},255)
     else
       puts(1,"erorr")
  	 end if
  	 killDib(dib)
  end for
  draw_sprite_editor_window()
end procedure
setHandler( MenuItem_1117, w32HClick, routine_id("MenuItem_1117_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1128_onClick (integer self, integer event, sequence params)--params is ()
  openWindow(Window17, Modal)
end procedure
setHandler( MenuItem_1128, w32HClick, routine_id("MenuItem_1128_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1119_onClick (integer self, integer event, sequence params)--params is ()
sequence colors,color
atom col
 make_backup()
 col=getColorDialog (Window11, 0)
 if col>0 then
   colors=rgbs( col )
   color=dibColor(colors[1],colors[2],colors[3])
   for i=1 to length(images) do
  	 colorizeDib(images[i],color)
   end for
 end if
 draw_sprite_editor_window()
end procedure
setHandler( MenuItem_1119, w32HClick, routine_id("MenuItem_1119_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1120_onClick (integer self, integer event, sequence params)--params is ()
  make_backup()
  for i=1 to length(images) do
  	 blurDib(images[i])
  end for
  draw_sprite_editor_window()
end procedure
setHandler( MenuItem_1120, w32HClick, routine_id("MenuItem_1120_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1121_onClick (integer self, integer event, sequence params)--params is ()
  make_backup()
  for i=1 to length(images) do
  	 invertDib(images[i])
  end for
  draw_sprite_editor_window()
end procedure
setHandler( MenuItem_1121, w32HClick, routine_id("MenuItem_1121_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1122_onClick (integer self, integer event, sequence params)--params is ()
  make_backup()
  for i=1 to length(images) do
  	 sharpenDib(images[i])
  end for
  draw_sprite_editor_window()
end procedure
setHandler( MenuItem_1122, w32HClick, routine_id("MenuItem_1122_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1123_onClick (integer self, integer event, sequence params)--params is ()
  make_backup()
  for i=1 to length(images) do
  	 makeDibGray(images[i])
  end for
  draw_sprite_editor_window()
end procedure
setHandler( MenuItem_1123, w32HClick, routine_id("MenuItem_1123_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1126_onClick (integer self, integer event, sequence params)--params is ()
  openWindow(Window14,Modal)
end procedure
setHandler( MenuItem_1126, w32HClick, routine_id("MenuItem_1126_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1127_onClick (integer self, integer event, sequence params)--params is ()
  openWindow(Window18,Modal)
end procedure
setHandler( MenuItem_1127, w32HClick, routine_id("MenuItem_1127_onClick"))
--------------------------------------------------------------------------------
procedure CWindow3_onMouse (integer self, integer event, sequence params)--params is ( int event, int x, int y, int shift, int wheelmove )
  mouse_sprite_window(params[2],params[3],params[1])
  if sprite_window_focus=1 then
  	setFocus(self)
  end if
end procedure
setHandler( CWindow3, w32HMouse, routine_id("CWindow3_onMouse"))
--------------------------------------------------------------------------------
procedure CWindow3_onPaint (integer self, integer event, sequence params)--params is ( int x1, int y1, int x2, int y2 )
  draw_sprite_editor_window()
end procedure
setHandler( CWindow3, w32HPaint, routine_id("CWindow3_onPaint"))
--------------------------------------------------------------------------------
procedure CWindow4_onPaint (integer self, integer event, sequence params)--params is ( int x1, int y1, int x2, int y2 )
    draw_preview_window()
end procedure
setHandler( CWindow4, w32HPaint, routine_id("CWindow4_onPaint"))
--------------------------------------------------------------------------------
procedure CWindow4_onTimer (integer self, integer event, sequence params)--params is ( int timerId)
timer+=5
  if timer>preview_speed then
    draw_preview_window()
  	timer=0
  end if
end procedure
setHandler( CWindow4, w32HTimer, routine_id("CWindow4_onTimer"))
--------------------------------------------------------------------------------
procedure PushButton563_onClick (integer self, integer event, sequence params)--params is ()
sequence fname
integer result
sprite_editor_save_changes=0
  sprite_window_images={}
  sprite_window_filenames={}
  sprite_window_image_width=image_width
  sprite_window_image_height=image_height
  if length(images)>0 then
  	sprite_window_image_index=1
  	 setVisible(button_spr_delete,1)
  	 setVisible(button_spr_next,1)
  	 setVisible(button_spr_back,1)
  	 setVisible(button_spr_add_sub_image,1)
  	 setVisible(button_spr_save_sub_image,1)
  	 setVisible(group_spr_bounding_box,1)
  	 setVisible(group_spr_transprant_image,1)
     setVisible(group_spr_offset,1)
  	 setVisible(group_spr_preview,1)
  else
  setVisible(button_spr_delete,0)
  	setVisible(button_spr_next,0)
  	setVisible(button_spr_back,0)
  	setVisible(button_spr_add_sub_image,0)
  	setVisible(group_spr_bounding_box,0)
  	setVisible(group_spr_transprant_image,0)
  	setVisible(group_spr_offset,0)
  	setVisible(group_spr_preview,0)
  	setText(label_spr_fname,"")
  end if
  for i=1 to length(images) do
    fname="c:\\windows\\temp\\"&sprite_info[sprite_window_index][SPR_NAME]&sprint(i)&".bmp"
    result=saveDib(images[i], fname , 0, 0, image_width, image_height)
    sprite_window_images=append(sprite_window_images,loadBitmapFromFile( fname ))
    sprite_window_filenames=append(sprite_window_filenames,fname)
    delete_list=append(delete_list,get_file_fullname_part(fname))
  end for
  closeWindow(Window11)
end procedure
setHandler( PushButton563, w32HClick, routine_id("PushButton563_onClick"))
--------------------------------------------------------------------------------
procedure PushButton417_onClick (integer self, integer event, sequence params)--params is ()
sequence temp
  if select_image>1 then
    temp=images[select_image-1]
  	images[select_image-1]=images[select_image]
  	images[select_image]=temp
  	select_image-=1
  	draw_sprite_editor_window()
  end if
end procedure
setHandler( PushButton417, w32HClick, routine_id("PushButton417_onClick"))
--------------------------------------------------------------------------------
procedure PushButton418_onClick (integer self, integer event, sequence params)--params is ()
sequence temp
  if select_image<length(images) then
    temp=images[select_image+1]
  	images[select_image+1]=images[select_image]
  	images[select_image]=temp
  	select_image+=1
  	draw_sprite_editor_window()
  end if
end procedure
setHandler( PushButton418, w32HClick, routine_id("PushButton418_onClick"))
--------------------------------------------------------------------------------
procedure PushButton420_onClick (integer self, integer event, sequence params)--params is ()
--still need to sort out the sprite_window_top bit
  if length(images)>0 then
    make_backup()
    killDib(images[select_image])
  	images=remove_sequence(images,select_image)
  	if select_image>1  then
  	  select_image-=1
	else
	  --setEnable()
  	end if
  	draw_sprite_editor_window()
  	set_bar_range()
  end if
end procedure
setHandler( PushButton420, w32HClick, routine_id("PushButton420_onClick"))
--------------------------------------------------------------------------------
procedure PushButton422_onClick (integer self, integer event, sequence params)--params is ()
  if backup_work=1 then
  	restore_backup()
  end if
end procedure
setHandler( PushButton422, w32HClick, routine_id("PushButton422_onClick"))
--------------------------------------------------------------------------------
procedure PushButton423_onClick (integer self, integer event, sequence params)--params is ()
  if backup_work2=1 then
  	undo_backup()
  end if
end procedure
setHandler( PushButton423, w32HClick, routine_id("PushButton423_onClick"))
--------------------------------------------------------------------------------
procedure PushButton425_onClick (integer self, integer event, sequence params)--params is ()
  if length(images)>0 then
  	dib=images[select_image]
    openWindow(Window12,Modal)
  end if
end procedure
setHandler( PushButton425, w32HClick, routine_id("PushButton425_onClick"))
--------------------------------------------------------------------------------
procedure bar_height_onChange (integer self, integer event, sequence params)--params is ()
sprite_window_top=getScrollPos ( bar_height)
draw_sprite_editor_window()
end procedure
setHandler( bar_height, w32HChange, routine_id("bar_height_onChange"))
--------------------------------------------------------------------------------
procedure bar_height_onScroll (integer self, integer event, sequence params)--params is ( int pos )
sprite_window_top=getScrollPos ( bar_height)
draw_sprite_editor_window()
end procedure
setHandler( bar_height, w32HScroll, routine_id("bar_height_onScroll"))
--------------------------------------------------------------------------------
procedure checkbox_sprite_editor_preview_onClick (integer self, integer event, sequence params)--params is ()
sequence size
size=getCtlSize(CWindow4)
  if isChecked(checkbox_sprite_editor_preview) then
    setCtlSize(buffer_sprite_editor_preview,140,size[2]-80)
    preview_window_width=140
    preview_window_height=size[2]-80
  	setVisible(CWindow4,1)
  	setTimer(CWindow4,Timer6,preview_speed)
  	setText(textbox_sprite_editor_speed,sprint(preview_speed))
  	draw_preview_window()
  else
    setVisible(CWindow4,0)
    killTimer(CWindow4,Timer6)
  end if
end procedure
setHandler( checkbox_sprite_editor_preview, w32HClick, routine_id("checkbox_sprite_editor_preview_onClick"))
--------------------------------------------------------------------------------
procedure textbox_sprite_editor_speed_onChange (integer self, integer event, sequence params)--params is ()
  preview_speed=real(getText(self))
  setTimer(CWindow2,Timer6,preview_speed)
end procedure
setHandler( textbox_sprite_editor_speed, w32HChange, routine_id("textbox_sprite_editor_speed_onChange"))
--------------------------------------------------------------------------------
procedure button_sprite_editor_background_onClick (integer self, integer event, sequence params)--params is ()
   background_color=getColorDialog (Window11, background_color)
end procedure
setHandler( button_sprite_editor_background, w32HClick, routine_id("button_sprite_editor_background_onClick"))
--------------------------------------------------------------------------------
--image editor
--pen mode
--fill mode
--spray mode
--for useing the drawing commands
constant Buffer_temp=create(Pixmap,"",0,0,0,32,32,0)
integer image_editor_save_changes
image_editor_save_changes=1
integer real_width, real_height,zoom,pos1,pos2,mouse_button,image_top,image_left,image_mode
real_width=0
real_height=0
zoom=4
pos1=0
pos2=0
mouse_button=0
image_top=0
image_left=0
image_mode=1
sequence s_image
s_image={}
atom color1,color2
integer mode_while
color1=rgb(255,255,255)
color2=0
mode_while=0


sequence Buffer_dib
Buffer_dib=newDib( 1 , 1 )

procedure image_bar_range()
  sequence size
  size=getCtlSize(bar_height_image)
  setWindowScrollRange ( bar_height_image, SB_VERT, 0, real_height*zoom, size[2])
  size=getCtlSize(bar_width_image)
  setWindowScrollRange ( bar_width_image, SB_HORZ, 0, real_width*zoom, size[1])
  image_top=0
  image_left=0
end procedure

procedure draw_dib_blook(sequence temp,integer x,integer y,integer size,sequence color)
    for i=y to y+size do
    	for j=x to x+size do
    		poke(temp[DibMemory] + i * temp[DibBytesPerLine] + j * 3, color)
    	end for
    end for	
end procedure

procedure fill(atom fill_color)
integer px,py,line,count
atom timer
atom sel_color
sequence temp,pos,cols
mode_while=1
temp=s_image
pos={}
cols=s_image[floor(image_top/zoom)+(pos2+1)][floor(image_left/zoom)+(pos1+1)]
sel_color=rgb(cols[3],cols[2],cols[1])
py=floor(image_top/zoom)+(pos2+1)
px=floor(image_left/zoom)+(pos1+1)
timer=time()+0.10
count=0
pos=append(pos,{py,px})
line=1
s_image[py][px]=rgbs(fill_color)
  while 1 do
    doEvents(0)
    if line<=length(pos) then
      px=pos[line][2]
      py=pos[line][1]
      if px>0 and px<=real_width and py>0 and py<=real_height then
        -- one line up
        if py-1 >0 then
          cols=s_image[py-1][px]
          if rgb(cols[3],cols[2],cols[1])=sel_color then
            pos=append(pos,{py-1,px})
            s_image[py-1][px]=rgbs(fill_color)
          end if
        end if
        -- one line down
        if py+1 <=real_height then
          cols=s_image[py+1][px]
          if rgb(cols[3],cols[2],cols[1])=sel_color then
            pos=append(pos,{py+1,px})
            s_image[py+1][px]=rgbs(fill_color)
          end if
        end if
        -- one row left
        if px-1 >0 then
          cols=s_image[py][px-1]
          if rgb(cols[3],cols[2],cols[1])=sel_color then
            pos=append(pos,{py,px-1})
            --cols=
            s_image[py][px-1]=rgbs(fill_color)
          end if
        end if
        -- one row right
        if px+1 <=real_width  then
          cols=s_image[py][px+1]
          if rgb(cols[3],cols[2],cols[1])=sel_color then
            pos=append(pos,{py,px+1})
            s_image[py][px+1]=rgbs(fill_color)
          end if
        end if
      end if
      line+=1
    else
      line=1
      count+=1
    end if
   if count>10 or time()>timer then
      exit
    end if
  end while
  if zoom>1 then
  	for i=0 to real_height-1 do
  	  for j=0 to real_width-1 do
        draw_dib_blook(Buffer_dib,j*zoom, i*zoom, zoom ,s_image[i+1][j+1])
  	  end for
    end for
  else
    for i=0 to real_height-1 do
  	  for j=0 to real_width-1 do
        poke(Buffer_dib[DibMemory] + i * Buffer_dib[DibBytesPerLine] + j * 3,s_image[i+1][j+1]  )
  	  end for
    end for
  end if
  mode_while=0
end procedure

procedure spray(sequence color)
-- place 6 random pixels at position fill a square
integer pixel_number,x,y,count,size,px,py
atom timer
pixel_number=6
count=0
mode_while=1
size=10
px=0
py=0
x=floor(image_left/zoom)+(pos1+1)-5
y=floor(image_top/zoom)+(pos2+1)-5
timer=time()+.10
  while 1 do
    doEvents(0)
  	px=x+rand(size)
  	py=y+rand(size)
  	if px>=0 and px<real_width and py>=0 and py<real_height then
  	  s_image[py+1][px+1]=color
      count+=1	
  	end if
  	if count>=pixel_number or time()>timer then
  		exit
  	end if
  end while
  if zoom>1 then
  	for i=0 to real_height-1 do
  	  for j=0 to real_width-1 do
        draw_dib_blook(Buffer_dib,j*zoom, i*zoom, zoom ,s_image[i+1][j+1])
  	  end for
    end for
  else
    for i=0 to real_height-1 do
  	  for j=0 to real_width-1 do
        poke(Buffer_dib[DibMemory] + i * Buffer_dib[DibBytesPerLine] + j * 3,s_image[i+1][j+1]  )
  	  end for
    end for
  end if
  mode_while=0
end procedure

procedure image_bar_change()
	image_top=getScrollPos( bar_height_image )
    image_left=getScrollPos( bar_width_image )
end procedure

procedure zoom_draw()
  sequence col
  killDib(Buffer_dib)
  Buffer_dib=newDib( (real_width*zoom)+zoom , (real_height*zoom)+zoom )
  if zoom>1 then
  	for i=0 to real_height-1 do
  	  for j=0 to real_width-1 do
        draw_dib_blook(Buffer_dib,j*zoom, i*zoom, zoom ,s_image[i+1][j+1])
  	  end for
    end for
  else
    for i=0 to real_height-1 do
  	  for j=0 to real_width-1 do
        poke(Buffer_dib[DibMemory] + i * Buffer_dib[DibBytesPerLine] + j * 3,s_image[i+1][j+1]  )
  	  end for
    end for
  end if
  repaintWindow(CWindow5)
end procedure

procedure load_dib_image()
sequence col
  image_mode=1
  real_width=dib[DibWidth]
  real_height=dib[DibHeight]
  zoom=1
  image_top=0
  image_left=0
  s_image={}
  for i=0 to real_height-1 do
  	 s_image=append(s_image, repeat(0, real_width ))
  end for
  Buffer_dib=newDib(real_width+zoom,real_height+zoom)
  for i=0 to real_height-1 do
  	for j=0 to real_width-1 do
  	  col=peek({dib[DibMemory] + i * dib[DibBytesPerLine] + j * 3, 3})
  	  s_image[i+1][j+1]=col
      draw_dib_blook(Buffer_dib, j*zoom, i*zoom, zoom ,col)
  	end for
  end for
  image_bar_range()
end procedure

procedure save_dib_image()
make_backup()
	for i=0 to real_height-1 do
      for j=0 to real_width-1 do
       poke(images[select_image][DibMemory] + i * images[select_image][DibBytesPerLine] + j * 3, s_image[i+1][j+1]  )
  	  end for
    end for
end procedure

function get_dib()
sequence dib2
     dib2=newDib(real_width,real_height)
	for i=0 to real_height-1 do
  	  for j=0 to real_width-1 do
  	    poke(dib2[DibMemory] + i * dib2[DibBytesPerLine] + j * 3,s_image[i+1][j+1]  )
  	  end for
    end for
	return dib2
end function

procedure put_dib(sequence dib2)
sequence col
	for i=0 to real_height-1 do
  	  for j=0 to real_width-1 do
  	    col=peek({dib2[DibMemory] + i * dib2[DibBytesPerLine] + j * 3, 3})
  	    s_image[i+1][j+1]=col
  	    draw_dib_blook(Buffer_dib, j*zoom, i*zoom, zoom ,col)
  	  end for
    end for
end procedure

procedure move_image(integer mode)
sequence dib2,dib3
    dib2=get_dib()
    dib3=newDib(real_width,real_height)
	if mode=1 then--left
	  drawDibToDib(dib3,dib2,-1,0,0,0,real_width,real_height,{},255)
	elsif mode=2 then--right
	  drawDibToDib(dib3,dib2,1,0,0,0,real_width,real_height,{},255)
    elsif mode=3 then--up
	  drawDibToDib(dib3,dib2,0,-1,0,0,real_width,real_height,{},255)
	elsif mode=4 then--down
	  drawDibToDib(dib3,dib2,0,1,0,0,real_width,real_height,{},255)
	end if
	put_dib(dib3)
	killDib(dib2)
	killDib(dib3)
end procedure

procedure draw_bitmap_buttons()
	setPenColor( bitmap_color1 , color1)
	drawRectangle( bitmap_color1 ,1 ,0,0 ,30,30)
	setPenColor( bitmap_color2 , color2)
	drawRectangle( bitmap_color2 ,1 ,0,0 ,30,30)
end procedure

procedure draw_image_editor()
  draw_bitmap_buttons()
  drawDib(CWindow5, Buffer_dib, 0, 0, image_left, image_top, real_width*zoom, real_height*zoom)
end procedure
--------------------------------------------------------------------------------
procedure Window12_onClose (integer self, integer event, sequence params)--params is ()
integer response
if image_editor_save_changes=1 then
    response = message_box("Save the changes to the image",
                       "Warning",
                       MB_ICONWARNING+MB_YESNO)
    if response = IDYES then
      save_dib_image()
    end if
end if
image_editor_save_changes=1
  sprite_window_focus=1
  draw_sprite_window()
end procedure
setHandler( Window12, w32HClose, routine_id("Window12_onClose"))
--------------------------------------------------------------------------------
procedure Window12_onMouse (integer self, integer event, sequence params)--params is ( int event, int x, int y, int shift, int wheelmove )
  if params[1]=LeftUp then
  	 mouse_button=0
  elsif params[1]=RightUp then
  	mouse_button=0
  end if
  mouse_button=0
end procedure
setHandler( Window12, w32HMouse, routine_id("Window12_onMouse"))
--------------------------------------------------------------------------------
procedure Window12_onOpen (integer self, integer event, sequence params)--params is ()
  sprite_window_focus=0
  setCheck(button_pen_mode,1)
  setCheck(button_fill_mode,0)
  setCheck(button_pick_mode,0)
  setCheck(button_spray_mode,0)
  setCheck(Window12,0)
  repaintWindow( CWindow5 )
  centerwindow(Window12)
  load_dib_image()
end procedure
setHandler( Window12, w32HOpen, routine_id("Window12_onOpen"))
--------------------------------------------------------------------------------
procedure Window12_onResize (integer self, integer event, sequence params)--params is ( int style, int cx, int cy )
sequence size
size=getCtlSize(Window12)
setCtlPosition(CWindow5,100,0)
setCtlSize(CWindow5,size[1]-130,size[2]-130)
setCtlPosition(bar_height_image,size[1]-30,0)
setCtlPosition(bar_width_image,100, size[2]-130)
setCtlSize(bar_height_image, 20 , size[2]-130)
setCtlSize(bar_width_image,size[1]-130, 20)
image_left=0
image_top=0
setScrollPos ( bar_height_image, 0 )
setScrollPos ( {bar_width_image,SB_HORZ},0 )
draw_image_editor()
end procedure
setHandler( Window12, w32HResize, routine_id("Window12_onResize"))
--------------------------------------------------------------------------------
procedure MenuItem_1202_onClick (integer self, integer event, sequence params)--params is ()
sequence fname,dib2
integer result
    fname = getSaveFileName(Window12,"",{"Bitmap File","*.bmp"})
    if length(fname)>0 then
      dib2=newDib(real_width,real_height)
      for i=0 to real_height-1 do
      for j=0 to real_width-1 do
       poke(dib2[DibMemory] + i * dib2[DibBytesPerLine] + j * 3, s_image[i+1][j+1]  )
  	  end for
      end for
      result = saveDib(dib2, get_file_path_part(fname)&get_file_name_part(fname)&".bmp", 0, 0, real_width, real_height)
      killDib(dib2)
    end if
end procedure
setHandler( MenuItem_1202, w32HClick, routine_id("MenuItem_1202_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1207_onClick (integer self, integer event, sequence params)--params is ()
  save_dib_image()
  image_editor_save_changes=0
  closeWindow(Window12)
end procedure
setHandler( MenuItem_1207, w32HClick, routine_id("MenuItem_1207_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1205_onClick (integer self, integer event, sequence params)--params is ()
  move_image(1)
  draw_image_editor()
end procedure
setHandler( MenuItem_1205, w32HClick, routine_id("MenuItem_1205_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1206_onClick (integer self, integer event, sequence params)--params is ()
  move_image(2)
  draw_image_editor()
end procedure
setHandler( MenuItem_1206, w32HClick, routine_id("MenuItem_1206_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1208_onClick (integer self, integer event, sequence params)--params is ()
  move_image(3)
  draw_image_editor()
end procedure
setHandler( MenuItem_1208, w32HClick, routine_id("MenuItem_1208_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1209_onClick (integer self, integer event, sequence params)--params is ()
  move_image(4)
  draw_image_editor()
end procedure
setHandler( MenuItem_1209, w32HClick, routine_id("MenuItem_1209_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1211_onClick (integer self, integer event, sequence params)--params is ()
sequence dib2
    dib2=get_dib()
    flipDibHor(dib2)
    put_dib(dib2)
    killDib(dib2)
    draw_image_editor()
end procedure
setHandler( MenuItem_1211, w32HClick, routine_id("MenuItem_1211_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1212_onClick (integer self, integer event, sequence params)--params is ()
sequence dib2
    dib2=get_dib()
    flipDibVert(dib2)
    put_dib(dib2)
    killDib(dib2)
    draw_image_editor()
end procedure
setHandler( MenuItem_1212, w32HClick, routine_id("MenuItem_1212_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1214_onClick (integer self, integer event, sequence params)--params is ()
sequence dib2,col
    dib2=get_dib()
    col=rgbs(color1)
    clearDib(dib2,{col[3],col[2],col[1]})
    put_dib(dib2)
    killDib(dib2)
    draw_image_editor()
end procedure
setHandler( MenuItem_1214, w32HClick, routine_id("MenuItem_1214_onClick"))
--------------------------------------------------------------------------------
procedure CWindow5_onMouse (integer self, integer event, sequence params)--params is ( int event, int x, int y, int shift, int wheelmove )
sequence cols
  pos1=floor(params[2]/zoom)
  pos2=floor(params[3]/zoom)
  setFocus(CWindow5)
  if params[1]=LeftDown then
    mouse_button=1
  elsif params[1]=LeftUp then
  	mouse_button=2
  elsif params[1]=RightDown then
  	mouse_button=3
  elsif params[1]=RightUp then
  	mouse_button=4
  end if

    if pos1>=0 and floor(image_left/zoom)+pos1<real_width and pos2>=0 and floor(image_top/zoom)+pos2<real_height then
      if image_mode=1 then
        if mouse_button=1 then
          cols=rgbs(color1)
          draw_dib_blook(Buffer_dib, image_left+pos1*zoom, image_top+pos2*zoom, zoom , {cols[3],cols[2],cols[1]} )
          s_image[floor(image_top/zoom)+(pos2+1)][floor(image_left/zoom)+(pos1+1)]={cols[3],cols[2],cols[1]}
          draw_image_editor()
        elsif mouse_button=3 then
      	  cols=rgbs(color2)
          draw_dib_blook(Buffer_dib, image_left+pos1*zoom, image_top+pos2*zoom, zoom , {cols[3],cols[2],cols[1]} )
          s_image[floor(image_top/zoom)+(pos2+1)][floor(image_left/zoom)+(pos1+1)]={cols[3],cols[2],cols[1]}
          draw_image_editor()
        end if
      elsif image_mode=2 and mode_while=0 then
      	if mouse_button=1 then
      	  cols=rgbs(color1)
          fill( rgb(cols[3],cols[2],cols[1]) )
          draw_image_editor()
        elsif mouse_button=3 then
      	  cols=rgbs(color2)
          fill( rgb(cols[3],cols[2],cols[1]) )
          draw_image_editor()
        end if
      elsif image_mode=3 then
        if mouse_button=1 then
          cols=s_image[floor(image_top/zoom)+(pos2+1)][floor(image_left/zoom)+(pos1+1)]
      	  color1=rgb( cols[3],cols[2],cols[1] )
          draw_image_editor()
          setCheck(button_pen_mode,1)
          setCheck(button_fill_mode,0)
          setCheck(button_pick_mode,0)
          image_mode=1
        elsif mouse_button=3 then
      	  cols=s_image[floor(image_top/zoom)+(pos2+1)][floor(image_left/zoom)+(pos1+1)]
      	  color2=rgb( cols[3],cols[2],cols[1] )
          draw_image_editor()
          setCheck(button_pen_mode,1)
          setCheck(button_fill_mode,0)
          setCheck(button_pick_mode,0)
          image_mode=1
        end if
      elsif image_mode=4 then
        if mouse_button=1 then
          cols=rgbs(color1)
          spray( {cols[3],cols[2],cols[1]} )
          draw_image_editor()
        elsif mouse_button=3 then
          cols=rgbs(color2)
      	  spray( {cols[3],cols[2],cols[1]} )
          draw_image_editor( )
        end if
      end if
      setText(lable_mouse_pos,"("& sprint( floor( image_left/zoom ) +pos1 )&","&sprint(floor(image_top/zoom)+pos2)&")")
    end if
end procedure
setHandler( CWindow5, w32HMouse, routine_id("CWindow5_onMouse"))
--------------------------------------------------------------------------------
procedure CWindow5_onPaint (integer self, integer event, sequence params)--params is ( int x1, int y1, int x2, int y2 )
  draw_image_editor()
end procedure
setHandler( CWindow5, w32HPaint, routine_id("CWindow5_onPaint"))
--------------------------------------------------------------------------------
procedure PushButton434_onClick (integer self, integer event, sequence params)--params is ()
  save_dib_image()
  image_editor_save_changes=0
  closeWindow(Window12)
end procedure
setHandler( PushButton434, w32HClick, routine_id("PushButton434_onClick"))
--------------------------------------------------------------------------------
procedure PushButton436_onClick (integer self, integer event, sequence params)--params is ()
  move_image(1)
  draw_image_editor()
end procedure
setHandler( PushButton436, w32HClick, routine_id("PushButton436_onClick"))
--------------------------------------------------------------------------------
procedure PushButton437_onClick (integer self, integer event, sequence params)--params is ()
  move_image(2)
  draw_image_editor()
end procedure
setHandler( PushButton437, w32HClick, routine_id("PushButton437_onClick"))
--------------------------------------------------------------------------------
procedure PushButton438_onClick (integer self, integer event, sequence params)--params is ()
  move_image(3)
  draw_image_editor()
end procedure
setHandler( PushButton438, w32HClick, routine_id("PushButton438_onClick"))
--------------------------------------------------------------------------------
procedure PushButton439_onClick (integer self, integer event, sequence params)--params is ()
  move_image(4)
  draw_image_editor()
end procedure
setHandler( PushButton439, w32HClick, routine_id("PushButton439_onClick"))
--------------------------------------------------------------------------------
procedure bar_height_image_onScroll (integer self, integer event, sequence params)--params is ( int pos )
  image_bar_change()
  draw_image_editor()
  mouse_button=0
end procedure
setHandler( bar_height_image, w32HScroll, routine_id("bar_height_image_onScroll"))
--------------------------------------------------------------------------------
procedure bitmap_color1_onMouse (integer self, integer event, sequence params)--params is ( int event, int x, int y, int shift, int wheelmove )
  if params[1]=LeftDown then
  	color1=getColorDialog(Window12,color1)
  	draw_bitmap_buttons()
  	mouse_button=0
  end if
end procedure
setHandler( bitmap_color1, w32HMouse, routine_id("bitmap_color1_onMouse"))
--------------------------------------------------------------------------------
procedure bitmap_color2_onMouse (integer self, integer event, sequence params)--params is ( int event, int x, int y, int shift, int wheelmove )
  if params[1]=LeftDown then
  	color2=getColorDialog(Window12,color2)
  	draw_bitmap_buttons()
  	mouse_button=0
  end if
end procedure
setHandler( bitmap_color2, w32HMouse, routine_id("bitmap_color2_onMouse"))
--------------------------------------------------------------------------------
procedure PushButton349_onClick (integer self, integer event, sequence params)--params is ()
  if zoom=1 then
    zoom=2
    zoom_draw()
    draw_image_editor()
    image_bar_range()
  else
   if zoom<10 then
   	 zoom+=2
   	 zoom_draw()
     draw_image_editor()
     image_bar_range()
   end if	
  end if
  mouse_button=0
end procedure
setHandler( PushButton349, w32HClick, routine_id("PushButton349_onClick"))
--------------------------------------------------------------------------------
procedure PushButton352_onClick (integer self, integer event, sequence params)--params is ()
  if zoom>2 then
  	zoom-=2
  	zoom_draw()
  	image_top=0
    image_left=0
    draw_image_editor()
    image_bar_range()
  else
    zoom=1
    zoom_draw()
    image_top=0
    image_left=0
    draw_image_editor()
    image_bar_range()
  end if
end procedure
setHandler( PushButton352, w32HClick, routine_id("PushButton352_onClick"))
--------------------------------------------------------------------------------
procedure button_pen_mode_onClick (integer self, integer event, sequence params)--params is ()
  setCheck(button_pen_mode,1)
  setCheck(button_fill_mode,0)
  setCheck(button_pick_mode,0)
  setCheck(button_spray_mode,0)
  image_mode=1
end procedure
setHandler( button_pen_mode, w32HClick, routine_id("button_pen_mode_onClick"))
--------------------------------------------------------------------------------
procedure button_fill_mode_onClick (integer self, integer event, sequence params)--params is ()
  setCheck(button_pen_mode,0)
  setCheck(button_fill_mode,1)
  setCheck(button_pick_mode,0)
  setCheck(button_spray_mode,0)
  image_mode=2
end procedure
setHandler( button_fill_mode, w32HClick, routine_id("button_fill_mode_onClick"))
--------------------------------------------------------------------------------
procedure button_pick_mode_onClick (integer self, integer event, sequence params)--params is ()
  setCheck(button_pen_mode,0)
  setCheck(button_fill_mode,0)
  setCheck(button_pick_mode,1)
  setCheck(button_spray_mode,0)
  image_mode=3
end procedure
setHandler( button_pick_mode, w32HClick, routine_id("button_pick_mode_onClick"))
--------------------------------------------------------------------------------
procedure button_spray_mode_onClick (integer self, integer event, sequence params)--params is ()
  setCheck(button_pen_mode,0)
  setCheck(button_fill_mode,0)
  setCheck(button_pick_mode,0)
  setCheck(button_spray_mode,1)
  image_mode=4
end procedure
setHandler( button_spray_mode, w32HClick, routine_id("button_spray_mode_onClick"))
--------------------------------------------------------------------------------
procedure bar_width_image_onScroll (integer self, integer event, sequence params)--params is ( int pos )
  image_bar_change()
  draw_image_editor()
  mouse_button=0
end procedure
setHandler( bar_width_image, w32HScroll, routine_id("bar_width_image_onScroll"))
--------------------------------------------------------------------------------
procedure Window13_onClose (integer self, integer event, sequence params)--params is ()
  sprite_window_focus=1
end procedure
setHandler( Window13, w32HClose, routine_id("Window13_onClose"))
--------------------------------------------------------------------------------
procedure Window13_onOpen (integer self, integer event, sequence params)--params is ()
  sprite_window_focus=0
  centerwindow(Window13)
  setText(textbox_width,"32")
  setText(textbox_height,"32")
end procedure
setHandler( Window13, w32HOpen, routine_id("Window13_onOpen"))
--------------------------------------------------------------------------------
procedure PushButton365_onClick (integer self, integer event, sequence params)--params is ()
  if real( getText(textbox_width) )>0 and real( getText(textbox_height) )>0 then
  make_backup()
  image_width=real( getText(textbox_width) )
  image_height=real( getText(textbox_height) )
  select_image=1
  for i=1 to length(images) do
	killDib(images[i])
  end for
  images=
  {
  newDib(image_width,image_height)
  }
  setWindowScrollRange ( bar_height, SB_VERT, 0, sprite_window_height , sprite_window_height )
  draw_sprite_editor_window()
  end if
  closeWindow(Window13)
end procedure
setHandler( PushButton365, w32HClick, routine_id("PushButton365_onClick"))
--------------------------------------------------------------------------------
procedure PushButton366_onClick (integer self, integer event, sequence params)--params is ()
  closeWindow(Window13)
end procedure
setHandler( PushButton366, w32HClick, routine_id("PushButton366_onClick"))
--------------------------------------------------------------------------------
procedure Window14_onClose (integer self, integer event, sequence params)--params is ()
  sprite_window_focus=1
end procedure
setHandler( Window14, w32HClose, routine_id("Window14_onClose"))
--------------------------------------------------------------------------------
procedure Window14_onOpen (integer self, integer event, sequence params)--params is ()
  setText(textbox_info,sprint(length(images)))
  sprite_window_focus=0
  centerwindow(Window14)
end procedure
setHandler( Window14, w32HOpen, routine_id("Window14_onOpen"))
--------------------------------------------------------------------------------
procedure PushButton369_onClick (integer self, integer event, sequence params)--params is ()
  make_backup()
  for i=length(images)+1 to real(getText(textbox_info)) do
  	images=append(images, extractDib(images[1], 0, 0, images[1][DibWidth]-1, images[1][DibHeight]-1))
  end for
  set_bar_range()
  draw_sprite_editor_window()
  closeWindow(Window14)
end procedure
setHandler( PushButton369, w32HClick, routine_id("PushButton369_onClick"))
--------------------------------------------------------------------------------
procedure PushButton370_onClick (integer self, integer event, sequence params)--params is ()
   closeWindow(Window14)
end procedure
setHandler( PushButton370, w32HClick, routine_id("PushButton370_onClick"))
--------------------------------------------------------------------------------
procedure Window15_onClose (integer self, integer event, sequence params)--params is ()
  sprite_window_focus=1
  draw_sprite_editor_window()
end procedure
setHandler( Window15, w32HClose, routine_id("Window15_onClose"))
--------------------------------------------------------------------------------
procedure Window15_onOpen (integer self, integer event, sequence params)--params is ()
  sprite_window_focus=0
  centerwindow(Window15)
end procedure
setHandler( Window15, w32HOpen, routine_id("Window15_onOpen"))
--------------------------------------------------------------------------------
procedure PushButton372_onClick (integer self, integer event, sequence params)--params is ()
object dib2
  make_backup()
  if dib[DibWidth]<image_width or dib[DibHeight]<image_height then
  --elsif dib[DibWidth]<image_width then
  --elsif	dib[DibHeight]<image_height then
    dib2=newDib(image_width, image_height)
    drawDibToDib(dib2,dib,0,0,0,0,dib[DibWidth],dib[DibHeight],{},255)
    images=append(images,dib2)
    select_image=length(images)
    killDib(dib)
    set_bar_range()
  else
    dib = extractDib(dib, 0, 0, image_width, image_height)
    images=append(images,dib)
    select_image=length(images)
    set_bar_range()
  end if
  closeWindow(Window15)
end procedure
setHandler( PushButton372, w32HClick, routine_id("PushButton372_onClick"))
--------------------------------------------------------------------------------
procedure PushButton373_onClick (integer self, integer event, sequence params)--params is ()
  killDib(dib)
  closeWindow(Window15)
end procedure
setHandler( PushButton373, w32HClick, routine_id("PushButton373_onClick"))
--------------------------------------------------------------------------------
integer strip_number_images,strip_images_per_row,strip_width,strip_height
strip_number_images=0
strip_images_per_row=0
strip_width=32
strip_height=32

procedure draw_boxes()
  integer width,height,count,y
  width=dib[DibWidth]
  height=dib[DibHeight]
  y=0
  count=1
  setPenMode( room_buffer, R2_NOT )
  if strip_mode=0 then
  	for i=1 to strip_number_images do
  	if count>strip_images_per_row then
  		count=1
  		y+=image_height
  	end if
  	if (image_width*count)<=width and y<=height then
  	   	 setPenColor(Buffer_strip,rgb(255,255,255))
         drawRectangle(Buffer_strip,0, (image_width*count)-image_width , y , (image_width*count) , y+image_height  )
  	end if
  	count+=1
    end for
  elsif strip_mode=1 then
  	for i=1 to strip_number_images do
  	if count>strip_images_per_row then
  		count=1
  		y+=strip_height
  	end if
  	if (strip_width*count)<=width and y<=height then
  	   	 setPenColor(Buffer_strip,rgb(255,255,255))
         drawRectangle(Buffer_strip,0, (strip_width*count)-strip_width , y , (strip_width*count) , y+strip_height  )
  	end if
  	count+=1
    end for
  end if
  setPenMode( room_buffer, R2_COPYPEN )
end procedure

procedure draw_strip_window()
  setPenColor(Buffer_strip,rgb(64,64,0))
  drawRectangle(Buffer_strip,1,0,0,1000,1000)
  drawDib(Buffer_strip, dib, 1, 1, 0, 0, dib[DibWidth], dib[DibHeight])
  draw_boxes()
  copyBlt ( Window16, 180, 0, Buffer_strip)
end procedure
--------------------------------------------------------------------------------
procedure Window16_onClose (integer self, integer event, sequence params)--params is ()
  sprite_window_focus=1
  set_bar_range()
  draw_sprite_editor_window()
end procedure
setHandler( Window16, w32HClose, routine_id("Window16_onClose"))
--------------------------------------------------------------------------------
procedure Window16_onOpen (integer self, integer event, sequence params)--params is ()
  sprite_window_focus=0
  setText(textbox_image_width,sprint(image_width))
  setText(textbox_image_height,sprint(image_height))
  setText(textbox_image_number,"1")
  setText(textbox_images_per_row,"1")
  strip_width=image_width
  strip_height=image_height
  strip_number_images=1
  strip_images_per_row=1
  centerwindow(Window16)
  draw_strip_window()
end procedure
setHandler( Window16, w32HOpen, routine_id("Window16_onOpen"))
--------------------------------------------------------------------------------
procedure Window16_onPaint (integer self, integer event, sequence params)--params is ( int x1, int y1, int x2, int y2 )
  draw_strip_window()
end procedure
setHandler( Window16, w32HPaint, routine_id("Window16_onPaint"))
--------------------------------------------------------------------------------
procedure Window16_onResize (integer self, integer event, sequence params)--params is ( int style, int cx, int cy )
 sequence size
  size=getCtlSize(Window16)
  setCtlSize(Buffer_strip,size[1]-180,size[2]-30)
  draw_strip_window()
end procedure
setHandler( Window16, w32HResize, routine_id("Window16_onResize"))
--------------------------------------------------------------------------------
procedure textbox_image_number_onChange (integer self, integer event, sequence params)--params is ()
  strip_number_images=real(getText(textbox_image_number))
  draw_strip_window()
end procedure
setHandler( textbox_image_number, w32HChange, routine_id("textbox_image_number_onChange"))
--------------------------------------------------------------------------------
procedure textbox_images_per_row_onChange (integer self, integer event, sequence params)--params is ()
  strip_images_per_row=real(getText(textbox_images_per_row))
  draw_strip_window()
end procedure
setHandler( textbox_images_per_row, w32HChange, routine_id("textbox_images_per_row_onChange"))
--------------------------------------------------------------------------------
procedure textbox_image_width_onChange (integer self, integer event, sequence params)--params is ()
  strip_width=real(getText(textbox_image_width))
  draw_strip_window()
end procedure
setHandler( textbox_image_width, w32HChange, routine_id("textbox_image_width_onChange"))
--------------------------------------------------------------------------------
procedure textbox_image_height_onChange (integer self, integer event, sequence params)--params is ()
  strip_height=real(getText(textbox_image_height))
  draw_strip_window()
end procedure
setHandler( textbox_image_height, w32HChange, routine_id("textbox_image_height_onChange"))
--------------------------------------------------------------------------------
procedure PushButton376_onClick (integer self, integer event, sequence params)--params is ()
  integer width,height,count,y
  object dib2
  width=dib[DibWidth]
  height=dib[DibHeight]
  y=0
  count=1
  make_backup()
  if strip_mode=0 then
  	for i=1 to strip_number_images do
  	if count>strip_images_per_row then
  		count=1
  		y+=image_height
  	end if
  	dib2=newDib(image_width,image_height)
  	drawDibToDib(dib2, dib, 0, 0, (image_width*count)-image_width , y , (image_width*count) , y+image_height, {}, 255)
  	images=append(images,dib2)
  	count+=1
    end for
  elsif strip_mode=1 then
    for i=1 to length(images) do
    	killDib(images[i])
    end for
    images={}
  	for i=1 to strip_number_images do
  	if count>strip_images_per_row then
  		count=1
  		y+=strip_height
  	end if
  	dib2=newDib(strip_width,strip_height)
  	drawDibToDib(dib2, dib, 0, 0, (strip_width*count)-strip_width , y , (strip_width*count) , y+strip_height, {}, 255)
  	images=append(images,dib2)
  	count+=1
    end for
    image_width=strip_width
    image_height=strip_height
    select_image=1
  end if
  killDib(dib)
  closeWindow(Window16)
end procedure
setHandler( PushButton376, w32HClick, routine_id("PushButton376_onClick"))
--------------------------------------------------------------------------------
procedure PushButton377_onClick (integer self, integer event, sequence params)--params is ()
    closeWindow(Window16)
end procedure
setHandler( PushButton377, w32HClick, routine_id("PushButton377_onClick"))
--------------------------------------------------------------------------------
procedure Window17_onClose (integer self, integer event, sequence params)--params is ()
  sprite_window_focus=1
  draw_sprite_editor_window()
end procedure
setHandler( Window17, w32HClose, routine_id("Window17_onClose"))
--------------------------------------------------------------------------------
procedure Window17_onOpen (integer self, integer event, sequence params)--params is ()
  sprite_window_focus=0
  centerwindow(Window17)
  setText(textbox_rotate,"45")
end procedure
setHandler( Window17, w32HOpen, routine_id("Window17_onOpen"))
--------------------------------------------------------------------------------
procedure PushButton388_onClick (integer self, integer event, sequence params)--params is ()
object dib2
integer x,y,width,height,rotate
  rotate=real(getText(textbox_rotate))
  make_backup()
  if rotate>0 and rotate<=360 then
    for i=1 to length(images) do
      dib2 = rotateDibFree(images[i], rotate, getDibPixel(images[i], 0, 0), 0)
      clearDib(images[i], getDibPixel(images[i],0,0))
  	 if dib2[DibWidth] = image_width and dib2[DibHeight] = image_height then
  	   x=0
  	   y=0
  	   width=image_width
  	   height=image_height
  	   drawDibToDib(images[i],dib2,0,0,x,y,width,height,{},255)
  	 elsif dib2[DibWidth] > image_width then
      x=floor((dib2[DibWidth]-image_width)/2)
      y=floor((dib2[DibHeight]-image_height)/2)
      width=dib2[DibWidth]-x
      height=dib2[DibHeight]-y
      drawDibToDib(images[i],dib2,0,0,x,y,width,height,{},255)
  	 elsif dib2[DibWidth] < image_width then
	   x=floor((image_width-dib[DibWidth])/2)
       y=floor((dib2[DibHeight]-image_height)/2)
       width=dib2[DibWidth]+x
       height=dib2[DibHeight]-y
       drawDibToDib(images[i],dib2,x,0,0,y,width,height,{},255)
     else
       puts(1,"erorr")
  	 end if
    end for
  end if

  closeWindow(Window17)
end procedure
setHandler( PushButton388, w32HClick, routine_id("PushButton388_onClick"))
--------------------------------------------------------------------------------
procedure PushButton389_onClick (integer self, integer event, sequence params)--params is ()
  closeWindow(Window17)
end procedure
setHandler( PushButton389, w32HClick, routine_id("PushButton389_onClick"))
--------------------------------------------------------------------------------
procedure Window18_onClose (integer self, integer event, sequence params)--params is ()
  sprite_window_focus=1
  sprite_window_top=0
  set_bar_range()
end procedure
setHandler( Window18, w32HClose, routine_id("Window18_onClose"))
--------------------------------------------------------------------------------
procedure Window18_onOpen (integer self, integer event, sequence params)--params is ()
  sprite_window_focus=0
  setText(textbox_ainimation_number,length(images))
  setText(textbox_ainimation_angle,"360")
  centerwindow(Window18)
  draw_sprite_editor_window()
end procedure
setHandler( Window18, w32HOpen, routine_id("Window18_onOpen"))
--------------------------------------------------------------------------------
procedure PushButton394_onClick (integer self, integer event, sequence params)--params is ()
object dib2,dib3
integer x,y,width,height,rotate,number,angle
  number=real(getText(textbox_ainimation_number))
  rotate=real(getText(textbox_ainimation_angle))
  make_backup()
  if number>1 then
  	 if rotate>0 and rotate<=360 then
  	    for i=2 to length(images) do
  	      	killDib(images[i])
  	    end for
  	    images={images[1]}
  	    angle=0
  	    angle=floor(rotate/number)
  	    rotate=angle
  	    for i=2 to number do
  	       dib2 = rotateDibFree(images[1], rotate, getDibPixel(images[1], 0, 0), 0)
  	       dib3=newDib(image_width,image_height)
  	       clearDib(dib3, getDibPixel(images[1],0,0))
  	       images=append(images,dib3)
           if dib2[DibWidth] = image_width and dib2[DibHeight] = image_height then
  	         x=0
   	         y=0
  	         width=image_width
  	         height=image_height
  	         drawDibToDib(images[i],dib,0,0,x,y,width,height,{},255)
  	       elsif dib2[DibWidth] > image_width then
             x=floor((dib2[DibWidth]-image_width)/2)
             y=floor((dib2[DibHeight]-image_height)/2)
             width=dib2[DibWidth]-x
             height=dib2[DibHeight]-y
             drawDibToDib(images[i],dib2,0,0,x,y,width,height,{},255)
  	       elsif dib2[DibWidth] < image_width then
	         x=floor((image_width-dib2[DibWidth])/2)
             y=floor((dib2[DibHeight]-image_height)/2)
             width=dib2[DibWidth]+x
             height=dib2[DibHeight]-y
             drawDibToDib(images[i],dib2,x,0,0,y,width,height,{},255)
           else
             puts(1,"erorr")
  	       end if
           rotate+=angle
           killDib(dib2)
  	    end for
     end if
  elsif number=1  then
  	for i=2 to length(images) do
  	    killDib(images[i])
  	 end for
  end if
  closeWindow(Window18)
end procedure
setHandler( PushButton394, w32HClick, routine_id("PushButton394_onClick"))
--------------------------------------------------------------------------------
procedure PushButton395_onClick (integer self, integer event, sequence params)--params is ()
  closeWindow(Window18)
end procedure
setHandler( PushButton395, w32HClick, routine_id("PushButton395_onClick"))
--------------------------------------------------------------------------------
atom temp2_background_color,temp2_font_color
integer game_information_save_changes
game_information_save_changes=1
sequence temp_doc
temp_doc={}
constant limit99=limitsize("", Window19, 500, 400, 1200, 1200, 0, 0 )
--------------------------------------------------------------------------------
procedure Window19_onClose (integer self, integer event, sequence params)--params is ()
integer response
if game_information_save_changes=1 then
    response = message_box("Save the changes to the game information",
                       "Warning",
                       MB_ICONWARNING+MB_YESNO)
    if response = IDYES then

    else
      putStream( richedit_help, StreamRTF, temp_doc )
      temp_background_color=temp2_background_color
      response=sendMessage( richedit_help,1091,0, temp_background_color )
      temp_font_color=temp2_font_color
    end if
end if
setFocus(Window1)
end procedure
setHandler( Window19, w32HClose, routine_id("Window19_onClose"))
--------------------------------------------------------------------------------
procedure Window19_onOpen (integer self, integer event, sequence params)--params is ()
  centerwindow(Window19)
  setFocus(richedit_help)
  setCheck(PushButton71,0)
  setCheck(PushButton72,0)
  setCheck(PushButton73,0)
  setCheck(PushButton77,0)
  setCheck(PushButton78,0)
  setCheck(PushButton79,0)
  setText(EditText69,"8")
  game_information_save_changes=1
  setFont( richedit_help, {temp_font_color,"Arial"} , 8 ,Normal)
  temp_doc=getStream(richedit_help,StreamRTF)
  temp2_background_color=temp_background_color
  temp2_font_color=temp_font_color
  setFocus(richedit_help)
end procedure
setHandler( Window19, w32HOpen, routine_id("Window19_onOpen"))
--------------------------------------------------------------------------------
procedure Window19_onResize (integer self, integer event, sequence params)--params is ( int style, int cx, int cy )
sequence rect
    rect = getClientRect( Window19 )
    moveWindow( richedit_help, rect[1], rect[2]-33,
                    rect[3]-rect[1], rect[4]-rect[2]+34, True )
end procedure
setHandler( Window19, w32HResize, routine_id("Window19_onResize"))
--------------------------------------------------------------------------------
procedure MenuItem_1905_onClick (integer self, integer event, sequence params)--params is ()
  sequence rich,fname
  atom fn, c
  fname = getOpenFileName( Window19, "", {"Richedit File","*.rtf"} )
  if length(fname)>0 then
    fn = open( fname, "r" )
    if fn != -1 then
        rich = {}
        c = 0
        while c != -1 do
            c = getc( fn )
            rich &= c
        end while
        close( fn )
        rich = rich[1..length(rich)-1]
        -- Select all the existing text
        setIndex(richedit_help, {1,0})
        -- Replace the selection with the file data.
        putStream( richedit_help, StreamRTF , rich )
        for i=length(rich) to 1 by -1 do
           if rich[i]=0 then
             if length(rich[i+1..length( rich)])>0 then
               rich= value ( rich[i+1..length( rich)]  )
           	   temp_background_color= rich[2]
           	   fn=sendMessage( richedit_help,1091,0, temp_background_color )
             else
               temp_background_color=16777215
               fn=sendMessage( richedit_help,1091,0, temp_background_color )
             end if
           	 exit
           end if
        end for
    end if
  end if
end procedure
setHandler( MenuItem_1905, w32HClick, routine_id("MenuItem_1905_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1906_onClick (integer self, integer event, sequence params)--params is ()
sequence fname,temp
  	integer fn
    fname = getSaveFileName(Window4,"",{"RichEdit File","*.rtf"})
    if length(fname)>0 then
      temp=getStream( richedit_help, StreamRTF)
      if find(".rtf",fname)=0 then
        fname&=".rtf"	
      end if
      fn=open(fname,"w")
      for i=1 to length(temp) do
      	puts(fn,temp[i])
      end for
      puts(fn,sprint(temp_background_color))
      close(fn)
    end if
end procedure
setHandler( MenuItem_1906, w32HClick, routine_id("MenuItem_1906_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1913_onClick (integer self, integer event, sequence params)--params is ()
  game_information_save_changes=0
  setIndex( richedit_help, 0 )
  closeWindow(Window19)
end procedure
setHandler( MenuItem_1913, w32HClick, routine_id("MenuItem_1913_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1903_onClick (integer self, integer event, sequence params)--params is ()
  undo( richedit_help )
end procedure
setHandler( MenuItem_1903, w32HClick, routine_id("MenuItem_1903_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1907_onClick (integer self, integer event, sequence params)--params is ()
  cut( richedit_help )
end procedure
setHandler( MenuItem_1907, w32HClick, routine_id("MenuItem_1907_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1908_onClick (integer self, integer event, sequence params)--params is ()
  copy( richedit_help )
end procedure
setHandler( MenuItem_1908, w32HClick, routine_id("MenuItem_1908_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1909_onClick (integer self, integer event, sequence params)--params is ()
    paste( richedit_help )
end procedure
setHandler( MenuItem_1909, w32HClick, routine_id("MenuItem_1909_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1911_onClick (integer self, integer event, sequence params)--params is ()
sequence text
integer len
    text = getStream(richedit_help,StreamText)
    len = length(text)
    if len>0 then
    if text[len] != '\n' then
        len +=1
    end if
    setIndex(richedit_help, {1, len} )
    end if
end procedure
setHandler( MenuItem_1911, w32HClick, routine_id("MenuItem_1911_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1915_onClick (integer self, integer event, sequence params)--params is ()
integer b1,b2,b3
sequence select
  b1=isChecked(PushButton71)
  if b1=0 then
    b1=1
    setCheck(PushButton71,1)
  else
    b1=0
    setCheck(PushButton71,0)	
  end if
  b2=isChecked(PushButton72)
  b3=isChecked(PushButton73)
  if b1=0 and b2=0 and b3=0 then
  	setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Normal)
  elsif b1=1 and b2=0 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold)
  elsif b1=0 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic)
  elsif b1=0 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Underline)
  elsif b1=1 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic)
  elsif b1=1 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic+Underline)
  elsif b1=0 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic+Underline)
  elsif b1=1 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Underline)
  end if
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( MenuItem_1915, w32HClick, routine_id("MenuItem_1915_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1916_onClick (integer self, integer event, sequence params)--params is ()
integer b1,b2,b3
sequence select
  b1=isChecked(PushButton71)
  b2=isChecked(PushButton72)
  if b2=0 then
    b2=1
    setCheck(PushButton72,1)
  else
    b2=0
    setCheck(PushButton72,0)	
  end if
  b3=isChecked(PushButton73)
  if b1=0 and b2=0 and b3=0 then
  	setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Normal)
  elsif b1=1 and b2=0 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold)
  elsif b1=0 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic)
  elsif b1=0 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Underline)
  elsif b1=1 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic)
  elsif b1=1 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic+Underline)
  elsif b1=0 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic+Underline)
  elsif b1=1 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Underline)
  end if
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( MenuItem_1916, w32HClick, routine_id("MenuItem_1916_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1917_onClick (integer self, integer event, sequence params)--params is ()
integer b1,b2,b3
sequence select
  b1=isChecked(PushButton71)
  b2=isChecked(PushButton72)
  b3=isChecked(PushButton73)
  if b3=0 then
    b3=1
    setCheck(PushButton73,1)
  else
    b3=0
    setCheck(PushButton73,0)	
  end if
  if b1=0 and b2=0 and b3=0 then
  	setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Normal)
  elsif b1=1 and b2=0 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold)
  elsif b1=0 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic)
  elsif b1=0 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Underline)
  elsif b1=1 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic)
  elsif b1=1 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic+Underline)
  elsif b1=0 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic+Underline)
  elsif b1=1 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Underline)
  end if
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( MenuItem_1917, w32HClick, routine_id("MenuItem_1917_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1919_onClick (integer self, integer event, sequence params)--params is ()
  integer b1,b2,b3
  sequence select
  b1=isChecked(PushButton71)
  b2=isChecked(PushButton72)
  b3=isChecked(PushButton73)
  temp_font_color=getColorDialog( Window19,  temp_font_color )
  if b1=0 and b2=0 and b3=0 then
  	setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Normal)
  elsif b1=1 and b2=0 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold)
  elsif b1=0 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic)
  elsif b1=0 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Underline)
  elsif b1=1 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic)
  elsif b1=1 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic+Underline)
  elsif b1=0 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic+Underline)
  elsif b1=1 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Underline)
  end if
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( MenuItem_1919, w32HClick, routine_id("MenuItem_1919_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1920_onClick (integer self, integer event, sequence params)--params is ()
integer temp
sequence select
temp_background_color=getColorDialog( Window19,  temp_background_color)
temp=sendMessage( richedit_help,1091,0, temp_background_color )
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( MenuItem_1920, w32HClick, routine_id("MenuItem_1920_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1922_onClick (integer self, integer event, sequence params)--params is ()
sequence select
  if isChecked(PushButton77)=0 then
    setCheck(PushButton77,1)
  else
    setCheck(PushButton77,0)	
  end if
setCheck(PushButton78,0)
setCheck(PushButton79,0)
setAlignment ( richedit_help, AlignLeft )
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( MenuItem_1922, w32HClick, routine_id("MenuItem_1922_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1923_onClick (integer self, integer event, sequence params)--params is ()
sequence select
  if isChecked(PushButton78)=0 then
    setCheck(PushButton78,1)
  else
    setCheck(PushButton78,0)	
  end if
setCheck(PushButton77,0)
setCheck(PushButton79,0)
setAlignment ( richedit_help, AlignCenter  )
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( MenuItem_1923, w32HClick, routine_id("MenuItem_1923_onClick"))
--------------------------------------------------------------------------------
procedure MenuItem_1924_onClick (integer self, integer event, sequence params)--params is ()
sequence select
  if isChecked(PushButton79)=0 then
    setCheck(PushButton79,1)
  else
    setCheck(PushButton79,0)	
  end if
setCheck(PushButton77,0)
setCheck(PushButton78,0)
setAlignment ( richedit_help, AlignRight  )
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( MenuItem_1924, w32HClick, routine_id("MenuItem_1924_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_1902_onClick (integer self, integer event, sequence params)--params is ()
  undo( richedit_help )
end procedure
setHandler( PopupItem_1902, w32HClick, routine_id("PopupItem_1902_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_1904_onClick (integer self, integer event, sequence params)--params is ()
  cut( richedit_help )
end procedure
setHandler( PopupItem_1904, w32HClick, routine_id("PopupItem_1904_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_1905_onClick (integer self, integer event, sequence params)--params is ()
  copy( richedit_help )
end procedure
setHandler( PopupItem_1905, w32HClick, routine_id("PopupItem_1905_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_1906_onClick (integer self, integer event, sequence params)--params is ()
  paste( richedit_help )
end procedure
setHandler( PopupItem_1906, w32HClick, routine_id("PopupItem_1906_onClick"))
--------------------------------------------------------------------------------
procedure PopupItem_1908_onClick (integer self, integer event, sequence params)--params is ()
sequence text
integer len
    text = getStream(richedit_help,StreamText)
    len = length(text)
    if len>0 then
    if text[len] != '\n' then
        len +=1
    end if
    setIndex(richedit_help, {1, len} )
    end if
end procedure
setHandler( PopupItem_1908, w32HClick, routine_id("PopupItem_1908_onClick"))
--------------------------------------------------------------------------------
procedure PushButton464_onClick (integer self, integer event, sequence params)--params is ()
  game_information_save_changes=0
  setIndex( richedit_help, 0 )
  closeWindow(Window19)
end procedure
setHandler( PushButton464, w32HClick, routine_id("PushButton464_onClick"))
--------------------------------------------------------------------------------
procedure PushButton468_onClick (integer self, integer event, sequence params)--params is ()
  cut( richedit_help )
  setFocus(richedit_help)
end procedure
setHandler( PushButton468, w32HClick, routine_id("PushButton468_onClick"))
--------------------------------------------------------------------------------
procedure PushButton469_onClick (integer self, integer event, sequence params)--params is ()
  copy( richedit_help )
  setFocus(richedit_help)
end procedure
setHandler( PushButton469, w32HClick, routine_id("PushButton469_onClick"))
--------------------------------------------------------------------------------
procedure PushButton471_onClick (integer self, integer event, sequence params)--params is ()
  paste( richedit_help )
  setFocus(richedit_help)
end procedure
setHandler( PushButton471, w32HClick, routine_id("PushButton471_onClick"))
--------------------------------------------------------------------------------
procedure EditText69_onChange (integer self, integer event, sequence params)--params is ()
  integer b1,b2,b3
  sequence select
  b1=isChecked(PushButton71)
  b2=isChecked(PushButton72)
  b3=isChecked(PushButton73)
  if b1=0 and b2=0 and b3=0 then
  	setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Normal)
  elsif b1=1 and b2=0 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold)
  elsif b1=0 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic)
  elsif b1=0 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Underline)
  elsif b1=1 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic)
  elsif b1=1 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic+Underline)
  elsif b1=0 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic+Underline)
  elsif b1=1 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Underline)
  end if
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( EditText69, w32HChange, routine_id("EditText69_onChange"))
--------------------------------------------------------------------------------
procedure PushButton71_onClick (integer self, integer event, sequence params)--params is ()
integer b1,b2,b3
sequence select
  b1=isChecked(PushButton71)
  b2=isChecked(PushButton72)
  b3=isChecked(PushButton73)
  if b1=0 and b2=0 and b3=0 then
  	setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Normal)
  elsif b1=1 and b2=0 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold)
  elsif b1=0 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic)
  elsif b1=0 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Underline)
  elsif b1=1 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic)
  elsif b1=1 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic+Underline)
  elsif b1=0 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic+Underline)
  elsif b1=1 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Underline)
  end if
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( PushButton71, w32HClick, routine_id("PushButton71_onClick"))
--------------------------------------------------------------------------------
procedure PushButton72_onClick (integer self, integer event, sequence params)--params is ()
integer b1,b2,b3
sequence select
  b1=isChecked(PushButton71)
  b2=isChecked(PushButton72)
  b3=isChecked(PushButton73)
  if b1=0 and b2=0 and b3=0 then
  	setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Normal)
  elsif b1=1 and b2=0 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold)
  elsif b1=0 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic)
  elsif b1=0 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Underline)
  elsif b1=1 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic)
  elsif b1=1 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic+Underline)
  elsif b1=0 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic+Underline)
  elsif b1=1 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Underline)
  end if
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( PushButton72, w32HClick, routine_id("PushButton72_onClick"))
--------------------------------------------------------------------------------
procedure PushButton73_onClick (integer self, integer event, sequence params)--params is ()
integer b1,b2,b3
sequence select
  b1=isChecked(PushButton71)
  b2=isChecked(PushButton72)
  b3=isChecked(PushButton73)
  if b1=0 and b2=0 and b3=0 then
  	setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Normal)
  elsif b1=1 and b2=0 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold)
  elsif b1=0 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic)
  elsif b1=0 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Underline)
  elsif b1=1 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic)
  elsif b1=1 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic+Underline)
  elsif b1=0 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic+Underline)
  elsif b1=1 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Underline)
  end if
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( PushButton73, w32HClick, routine_id("PushButton73_onClick"))
--------------------------------------------------------------------------------
procedure PushButton77_onClick (integer self, integer event, sequence params)--params is ()
sequence select
setCheck(PushButton78,0)
setCheck(PushButton79,0)
setAlignment ( richedit_help, AlignLeft )
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( PushButton77, w32HClick, routine_id("PushButton77_onClick"))
--------------------------------------------------------------------------------
procedure PushButton78_onClick (integer self, integer event, sequence params)--params is ()
sequence select
setCheck(PushButton77,0)
setCheck(PushButton79,0)
setAlignment ( richedit_help, AlignCenter  )
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( PushButton78, w32HClick, routine_id("PushButton78_onClick"))
--------------------------------------------------------------------------------
procedure PushButton79_onClick (integer self, integer event, sequence params)--params is ()
sequence select
setCheck(PushButton77,0)
setCheck(PushButton78,0)
setAlignment ( richedit_help, AlignRight  )
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( PushButton79, w32HClick, routine_id("PushButton79_onClick"))
--------------------------------------------------------------------------------
procedure PushButton485_onClick (integer self, integer event, sequence params)--params is ()
  integer b1,b2,b3
  sequence select
  b1=isChecked(PushButton71)
  b2=isChecked(PushButton72)
  b3=isChecked(PushButton73)
  temp_font_color=getColorDialog( Window19,  temp_font_color )
  if b1=0 and b2=0 and b3=0 then
  	setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Normal)
  elsif b1=1 and b2=0 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold)
  elsif b1=0 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic)
  elsif b1=0 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Underline)
  elsif b1=1 and b2=1 and b3=0 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic)
  elsif b1=1 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Italic+Underline)
  elsif b1=0 and b2=1 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Italic+Underline)
  elsif b1=1 and b2=0 and b3=1 then
    setFont( richedit_help, {temp_font_color,"Arial"} , real(getText(EditText69)) ,Bold+Underline)
  end if
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( PushButton485, w32HClick, routine_id("PushButton485_onClick"))
--------------------------------------------------------------------------------
procedure PushButton486_onClick (integer self, integer event, sequence params)--params is ()
integer temp
sequence select
temp_background_color=getColorDialog( Window19,  temp_background_color)
temp=sendMessage( richedit_help,1091,0, temp_background_color )
  select=getSelection( richedit_help )
  setFocus(richedit_help)
  setIndex( richedit_help, select )
end procedure
setHandler( PushButton486, w32HClick, routine_id("PushButton486_onClick"))
--------------------------------------------------------------------------------
procedure richedit_help_onMouse (integer self, integer event, sequence params)--params is ( int event, int x, int y, int shift, int wheelmove )
    if params[1] = RightDown then
        popup( Popup_1901, params[2], params[3] )
    end if
end procedure
setHandler( richedit_help, w32HMouse, routine_id("richedit_help_onMouse"))
--------------------------------------------------------------------------------
procedure Window20_onClose (integer self, integer event, sequence params)--params is ()
  draw_room_window()
end procedure
setHandler( Window20, w32HClose, routine_id("Window20_onClose"))
--------------------------------------------------------------------------------
procedure Window20_onOpen (integer self, integer event, sequence params)--params is ()
  centerwindow(self)
  setText(EditText538,"16")
end procedure
setHandler( Window20, w32HOpen, routine_id("Window20_onOpen"))
--------------------------------------------------------------------------------
procedure PushButton536_onClick (integer self, integer event, sequence params)--params is ()
  for i=1 to length(room_window_pack) do
    if room_window_move_mode=1 then
       room_window_pack[i][3]-=real(getText(EditText538))
    elsif room_window_move_mode=2 then
       room_window_pack[i][3]+=real(getText(EditText538))
    elsif room_window_move_mode=3 then
       room_window_pack[i][4]-=real(getText(EditText538))
    elsif room_window_move_mode=4 then
       room_window_pack[i][4]+=real(getText(EditText538))
    end if
  end for
  closeWindow(Window20)
end procedure
setHandler( PushButton536, w32HClick, routine_id("PushButton536_onClick"))
--------------------------------------------------------------------------------
procedure PushButton537_onClick (integer self, integer event, sequence params)--params is ()
  closeWindow(Window20)
end procedure
setHandler( PushButton537, w32HClick, routine_id("PushButton537_onClick"))


WinMain( Window1,Normal )
--this program has 7648 lines without including this line. If there is a discrepancy please send this file zipped to Judith.
